{"ast":null,"code":"import _classCallCheck from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _get from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/get\";\nimport _inherits from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport * as arrays from '../common/arrays.js';\nimport { Disposable } from '../common/lifecycle.js';\nimport * as DomUtils from './dom.js';\nimport { memoize } from '../common/decorators.js';\nexport var EventType;\n\n(function (EventType) {\n  EventType.Tap = '-monaco-gesturetap';\n  EventType.Change = '-monaco-gesturechange';\n  EventType.Start = '-monaco-gesturestart';\n  EventType.End = '-monaco-gesturesend';\n  EventType.Contextmenu = '-monaco-gesturecontextmenu';\n})(EventType || (EventType = {}));\n\nexport var Gesture = /*#__PURE__*/function (_Disposable) {\n  _inherits(Gesture, _Disposable);\n\n  var _super = _createSuper(Gesture);\n\n  function Gesture() {\n    var _this;\n\n    _classCallCheck(this, Gesture);\n\n    _this = _super.call(this);\n    _this.dispatched = false;\n    _this.activeTouches = {};\n    _this.handle = null;\n    _this.targets = [];\n    _this.ignoreTargets = [];\n    _this._lastSetTapCountTime = 0;\n\n    _this._register(DomUtils.addDisposableListener(document, 'touchstart', function (e) {\n      return _this.onTouchStart(e);\n    }, {\n      passive: false\n    }));\n\n    _this._register(DomUtils.addDisposableListener(document, 'touchend', function (e) {\n      return _this.onTouchEnd(e);\n    }));\n\n    _this._register(DomUtils.addDisposableListener(document, 'touchmove', function (e) {\n      return _this.onTouchMove(e);\n    }, {\n      passive: false\n    }));\n\n    return _this;\n  }\n\n  _createClass(Gesture, [{\n    key: \"dispose\",\n    value: function dispose() {\n      if (this.handle) {\n        this.handle.dispose();\n        this.handle = null;\n      }\n\n      _get(_getPrototypeOf(Gesture.prototype), \"dispose\", this).call(this);\n    }\n  }, {\n    key: \"onTouchStart\",\n    value: function onTouchStart(e) {\n      var timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\n\n      if (this.handle) {\n        this.handle.dispose();\n        this.handle = null;\n      }\n\n      for (var i = 0, len = e.targetTouches.length; i < len; i++) {\n        var touch = e.targetTouches.item(i);\n        this.activeTouches[touch.identifier] = {\n          id: touch.identifier,\n          initialTarget: touch.target,\n          initialTimeStamp: timestamp,\n          initialPageX: touch.pageX,\n          initialPageY: touch.pageY,\n          rollingTimestamps: [timestamp],\n          rollingPageX: [touch.pageX],\n          rollingPageY: [touch.pageY]\n        };\n        var evt = this.newGestureEvent(EventType.Start, touch.target);\n        evt.pageX = touch.pageX;\n        evt.pageY = touch.pageY;\n        this.dispatchEvent(evt);\n      }\n\n      if (this.dispatched) {\n        e.preventDefault();\n        e.stopPropagation();\n        this.dispatched = false;\n      }\n    }\n  }, {\n    key: \"onTouchEnd\",\n    value: function onTouchEnd(e) {\n      var _this2 = this;\n\n      var timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\n\n      var activeTouchCount = Object.keys(this.activeTouches).length;\n\n      var _loop = function _loop(i, len) {\n        var touch = e.changedTouches.item(i);\n\n        if (!_this2.activeTouches.hasOwnProperty(String(touch.identifier))) {\n          console.warn('move of an UNKNOWN touch', touch);\n          return \"continue\";\n        }\n\n        var data = _this2.activeTouches[touch.identifier],\n            holdTime = Date.now() - data.initialTimeStamp;\n\n        if (holdTime < Gesture.HOLD_DELAY && Math.abs(data.initialPageX - arrays.tail(data.rollingPageX)) < 30 && Math.abs(data.initialPageY - arrays.tail(data.rollingPageY)) < 30) {\n          var evt = _this2.newGestureEvent(EventType.Tap, data.initialTarget);\n\n          evt.pageX = arrays.tail(data.rollingPageX);\n          evt.pageY = arrays.tail(data.rollingPageY);\n\n          _this2.dispatchEvent(evt);\n        } else if (holdTime >= Gesture.HOLD_DELAY && Math.abs(data.initialPageX - arrays.tail(data.rollingPageX)) < 30 && Math.abs(data.initialPageY - arrays.tail(data.rollingPageY)) < 30) {\n          var _evt = _this2.newGestureEvent(EventType.Contextmenu, data.initialTarget);\n\n          _evt.pageX = arrays.tail(data.rollingPageX);\n          _evt.pageY = arrays.tail(data.rollingPageY);\n\n          _this2.dispatchEvent(_evt);\n        } else if (activeTouchCount === 1) {\n          var finalX = arrays.tail(data.rollingPageX);\n          var finalY = arrays.tail(data.rollingPageY);\n          var deltaT = arrays.tail(data.rollingTimestamps) - data.rollingTimestamps[0];\n          var deltaX = finalX - data.rollingPageX[0];\n          var deltaY = finalY - data.rollingPageY[0]; // We need to get all the dispatch targets on the start of the inertia event\n\n          var dispatchTo = _this2.targets.filter(function (t) {\n            return data.initialTarget instanceof Node && t.contains(data.initialTarget);\n          });\n\n          _this2.inertia(dispatchTo, timestamp, // time now\n          Math.abs(deltaX) / deltaT, // speed\n          deltaX > 0 ? 1 : -1, // x direction\n          finalX, // x now\n          Math.abs(deltaY) / deltaT, // y speed\n          deltaY > 0 ? 1 : -1, // y direction\n          finalY // y now\n          );\n        }\n\n        _this2.dispatchEvent(_this2.newGestureEvent(EventType.End, data.initialTarget)); // forget about this touch\n\n\n        delete _this2.activeTouches[touch.identifier];\n      };\n\n      for (var i = 0, len = e.changedTouches.length; i < len; i++) {\n        var _ret = _loop(i, len);\n\n        if (_ret === \"continue\") continue;\n      }\n\n      if (this.dispatched) {\n        e.preventDefault();\n        e.stopPropagation();\n        this.dispatched = false;\n      }\n    }\n  }, {\n    key: \"newGestureEvent\",\n    value: function newGestureEvent(type, initialTarget) {\n      var event = document.createEvent('CustomEvent');\n      event.initEvent(type, false, true);\n      event.initialTarget = initialTarget;\n      event.tapCount = 0;\n      return event;\n    }\n  }, {\n    key: \"dispatchEvent\",\n    value: function dispatchEvent(event) {\n      var _this3 = this;\n\n      if (event.type === EventType.Tap) {\n        var currentTime = new Date().getTime();\n        var setTapCount = 0;\n\n        if (currentTime - this._lastSetTapCountTime > Gesture.CLEAR_TAP_COUNT_TIME) {\n          setTapCount = 1;\n        } else {\n          setTapCount = 2;\n        }\n\n        this._lastSetTapCountTime = currentTime;\n        event.tapCount = setTapCount;\n      } else if (event.type === EventType.Change || event.type === EventType.Contextmenu) {\n        // tap is canceled by scrolling or context menu\n        this._lastSetTapCountTime = 0;\n      }\n\n      for (var i = 0; i < this.ignoreTargets.length; i++) {\n        if (event.initialTarget instanceof Node && this.ignoreTargets[i].contains(event.initialTarget)) {\n          return;\n        }\n      }\n\n      this.targets.forEach(function (target) {\n        if (event.initialTarget instanceof Node && target.contains(event.initialTarget)) {\n          target.dispatchEvent(event);\n          _this3.dispatched = true;\n        }\n      });\n    }\n  }, {\n    key: \"inertia\",\n    value: function inertia(dispatchTo, t1, vX, dirX, x, vY, dirY, y) {\n      var _this4 = this;\n\n      this.handle = DomUtils.scheduleAtNextAnimationFrame(function () {\n        var now = Date.now(); // velocity: old speed + accel_over_time\n\n        var deltaT = now - t1,\n            delta_pos_x = 0,\n            delta_pos_y = 0,\n            stopped = true;\n        vX += Gesture.SCROLL_FRICTION * deltaT;\n        vY += Gesture.SCROLL_FRICTION * deltaT;\n\n        if (vX > 0) {\n          stopped = false;\n          delta_pos_x = dirX * vX * deltaT;\n        }\n\n        if (vY > 0) {\n          stopped = false;\n          delta_pos_y = dirY * vY * deltaT;\n        } // dispatch translation event\n\n\n        var evt = _this4.newGestureEvent(EventType.Change);\n\n        evt.translationX = delta_pos_x;\n        evt.translationY = delta_pos_y;\n        dispatchTo.forEach(function (d) {\n          return d.dispatchEvent(evt);\n        });\n\n        if (!stopped) {\n          _this4.inertia(dispatchTo, now, vX, dirX, x + delta_pos_x, vY, dirY, y + delta_pos_y);\n        }\n      });\n    }\n  }, {\n    key: \"onTouchMove\",\n    value: function onTouchMove(e) {\n      var timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\n\n      for (var i = 0, len = e.changedTouches.length; i < len; i++) {\n        var touch = e.changedTouches.item(i);\n\n        if (!this.activeTouches.hasOwnProperty(String(touch.identifier))) {\n          console.warn('end of an UNKNOWN touch', touch);\n          continue;\n        }\n\n        var data = this.activeTouches[touch.identifier];\n        var evt = this.newGestureEvent(EventType.Change, data.initialTarget);\n        evt.translationX = touch.pageX - arrays.tail(data.rollingPageX);\n        evt.translationY = touch.pageY - arrays.tail(data.rollingPageY);\n        evt.pageX = touch.pageX;\n        evt.pageY = touch.pageY;\n        this.dispatchEvent(evt); // only keep a few data points, to average the final speed\n\n        if (data.rollingPageX.length > 3) {\n          data.rollingPageX.shift();\n          data.rollingPageY.shift();\n          data.rollingTimestamps.shift();\n        }\n\n        data.rollingPageX.push(touch.pageX);\n        data.rollingPageY.push(touch.pageY);\n        data.rollingTimestamps.push(timestamp);\n      }\n\n      if (this.dispatched) {\n        e.preventDefault();\n        e.stopPropagation();\n        this.dispatched = false;\n      }\n    }\n  }], [{\n    key: \"addTarget\",\n    value: function addTarget(element) {\n      if (!Gesture.isTouchDevice()) {\n        return Disposable.None;\n      }\n\n      if (!Gesture.INSTANCE) {\n        Gesture.INSTANCE = new Gesture();\n      }\n\n      Gesture.INSTANCE.targets.push(element);\n      return {\n        dispose: function dispose() {\n          Gesture.INSTANCE.targets = Gesture.INSTANCE.targets.filter(function (t) {\n            return t !== element;\n          });\n        }\n      };\n    }\n  }, {\n    key: \"ignoreTarget\",\n    value: function ignoreTarget(element) {\n      if (!Gesture.isTouchDevice()) {\n        return Disposable.None;\n      }\n\n      if (!Gesture.INSTANCE) {\n        Gesture.INSTANCE = new Gesture();\n      }\n\n      Gesture.INSTANCE.ignoreTargets.push(element);\n      return {\n        dispose: function dispose() {\n          Gesture.INSTANCE.ignoreTargets = Gesture.INSTANCE.ignoreTargets.filter(function (t) {\n            return t !== element;\n          });\n        }\n      };\n    }\n  }, {\n    key: \"isTouchDevice\",\n    value: function isTouchDevice() {\n      // `'ontouchstart' in window` always evaluates to true with typescript's modern typings. This causes `window` to be\n      // `never` later in `window.navigator`. That's why we need the explicit `window as Window` cast\n      return 'ontouchstart' in window || navigator.maxTouchPoints > 0 || window.navigator.msMaxTouchPoints > 0;\n    }\n  }]);\n\n  return Gesture;\n}(Disposable);\nGesture.SCROLL_FRICTION = -0.005;\nGesture.HOLD_DELAY = 700;\nGesture.CLEAR_TAP_COUNT_TIME = 400; // ms\n\n__decorate([memoize], Gesture, \"isTouchDevice\", null);","map":{"version":3,"sources":["/home/bar007/Desktop/projects/tio/client/node_modules/monaco-editor/esm/vs/base/browser/touch.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","arrays","Disposable","DomUtils","memoize","EventType","Tap","Change","Start","End","Contextmenu","Gesture","dispatched","activeTouches","handle","targets","ignoreTargets","_lastSetTapCountTime","_register","addDisposableListener","document","e","onTouchStart","passive","onTouchEnd","onTouchMove","dispose","timestamp","Date","now","len","targetTouches","touch","item","identifier","id","initialTarget","initialTimeStamp","initialPageX","pageX","initialPageY","pageY","rollingTimestamps","rollingPageX","rollingPageY","evt","newGestureEvent","dispatchEvent","preventDefault","stopPropagation","activeTouchCount","keys","changedTouches","hasOwnProperty","String","console","warn","data","holdTime","HOLD_DELAY","Math","abs","tail","finalX","finalY","deltaT","deltaX","deltaY","dispatchTo","filter","t","Node","contains","inertia","type","event","createEvent","initEvent","tapCount","currentTime","getTime","setTapCount","CLEAR_TAP_COUNT_TIME","forEach","t1","vX","dirX","x","vY","dirY","y","scheduleAtNextAnimationFrame","delta_pos_x","delta_pos_y","stopped","SCROLL_FRICTION","translationX","translationY","shift","push","element","isTouchDevice","None","INSTANCE","window","navigator","maxTouchPoints","msMaxTouchPoints"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport * as arrays from '../common/arrays.js';\r\nimport { Disposable } from '../common/lifecycle.js';\r\nimport * as DomUtils from './dom.js';\r\nimport { memoize } from '../common/decorators.js';\r\nexport var EventType;\r\n(function (EventType) {\r\n    EventType.Tap = '-monaco-gesturetap';\r\n    EventType.Change = '-monaco-gesturechange';\r\n    EventType.Start = '-monaco-gesturestart';\r\n    EventType.End = '-monaco-gesturesend';\r\n    EventType.Contextmenu = '-monaco-gesturecontextmenu';\r\n})(EventType || (EventType = {}));\r\nexport class Gesture extends Disposable {\r\n    constructor() {\r\n        super();\r\n        this.dispatched = false;\r\n        this.activeTouches = {};\r\n        this.handle = null;\r\n        this.targets = [];\r\n        this.ignoreTargets = [];\r\n        this._lastSetTapCountTime = 0;\r\n        this._register(DomUtils.addDisposableListener(document, 'touchstart', (e) => this.onTouchStart(e), { passive: false }));\r\n        this._register(DomUtils.addDisposableListener(document, 'touchend', (e) => this.onTouchEnd(e)));\r\n        this._register(DomUtils.addDisposableListener(document, 'touchmove', (e) => this.onTouchMove(e), { passive: false }));\r\n    }\r\n    static addTarget(element) {\r\n        if (!Gesture.isTouchDevice()) {\r\n            return Disposable.None;\r\n        }\r\n        if (!Gesture.INSTANCE) {\r\n            Gesture.INSTANCE = new Gesture();\r\n        }\r\n        Gesture.INSTANCE.targets.push(element);\r\n        return {\r\n            dispose: () => {\r\n                Gesture.INSTANCE.targets = Gesture.INSTANCE.targets.filter(t => t !== element);\r\n            }\r\n        };\r\n    }\r\n    static ignoreTarget(element) {\r\n        if (!Gesture.isTouchDevice()) {\r\n            return Disposable.None;\r\n        }\r\n        if (!Gesture.INSTANCE) {\r\n            Gesture.INSTANCE = new Gesture();\r\n        }\r\n        Gesture.INSTANCE.ignoreTargets.push(element);\r\n        return {\r\n            dispose: () => {\r\n                Gesture.INSTANCE.ignoreTargets = Gesture.INSTANCE.ignoreTargets.filter(t => t !== element);\r\n            }\r\n        };\r\n    }\r\n    static isTouchDevice() {\r\n        // `'ontouchstart' in window` always evaluates to true with typescript's modern typings. This causes `window` to be\r\n        // `never` later in `window.navigator`. That's why we need the explicit `window as Window` cast\r\n        return 'ontouchstart' in window || navigator.maxTouchPoints > 0 || window.navigator.msMaxTouchPoints > 0;\r\n    }\r\n    dispose() {\r\n        if (this.handle) {\r\n            this.handle.dispose();\r\n            this.handle = null;\r\n        }\r\n        super.dispose();\r\n    }\r\n    onTouchStart(e) {\r\n        let timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\r\n        if (this.handle) {\r\n            this.handle.dispose();\r\n            this.handle = null;\r\n        }\r\n        for (let i = 0, len = e.targetTouches.length; i < len; i++) {\r\n            let touch = e.targetTouches.item(i);\r\n            this.activeTouches[touch.identifier] = {\r\n                id: touch.identifier,\r\n                initialTarget: touch.target,\r\n                initialTimeStamp: timestamp,\r\n                initialPageX: touch.pageX,\r\n                initialPageY: touch.pageY,\r\n                rollingTimestamps: [timestamp],\r\n                rollingPageX: [touch.pageX],\r\n                rollingPageY: [touch.pageY]\r\n            };\r\n            let evt = this.newGestureEvent(EventType.Start, touch.target);\r\n            evt.pageX = touch.pageX;\r\n            evt.pageY = touch.pageY;\r\n            this.dispatchEvent(evt);\r\n        }\r\n        if (this.dispatched) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            this.dispatched = false;\r\n        }\r\n    }\r\n    onTouchEnd(e) {\r\n        let timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\r\n        let activeTouchCount = Object.keys(this.activeTouches).length;\r\n        for (let i = 0, len = e.changedTouches.length; i < len; i++) {\r\n            let touch = e.changedTouches.item(i);\r\n            if (!this.activeTouches.hasOwnProperty(String(touch.identifier))) {\r\n                console.warn('move of an UNKNOWN touch', touch);\r\n                continue;\r\n            }\r\n            let data = this.activeTouches[touch.identifier], holdTime = Date.now() - data.initialTimeStamp;\r\n            if (holdTime < Gesture.HOLD_DELAY\r\n                && Math.abs(data.initialPageX - arrays.tail(data.rollingPageX)) < 30\r\n                && Math.abs(data.initialPageY - arrays.tail(data.rollingPageY)) < 30) {\r\n                let evt = this.newGestureEvent(EventType.Tap, data.initialTarget);\r\n                evt.pageX = arrays.tail(data.rollingPageX);\r\n                evt.pageY = arrays.tail(data.rollingPageY);\r\n                this.dispatchEvent(evt);\r\n            }\r\n            else if (holdTime >= Gesture.HOLD_DELAY\r\n                && Math.abs(data.initialPageX - arrays.tail(data.rollingPageX)) < 30\r\n                && Math.abs(data.initialPageY - arrays.tail(data.rollingPageY)) < 30) {\r\n                let evt = this.newGestureEvent(EventType.Contextmenu, data.initialTarget);\r\n                evt.pageX = arrays.tail(data.rollingPageX);\r\n                evt.pageY = arrays.tail(data.rollingPageY);\r\n                this.dispatchEvent(evt);\r\n            }\r\n            else if (activeTouchCount === 1) {\r\n                let finalX = arrays.tail(data.rollingPageX);\r\n                let finalY = arrays.tail(data.rollingPageY);\r\n                let deltaT = arrays.tail(data.rollingTimestamps) - data.rollingTimestamps[0];\r\n                let deltaX = finalX - data.rollingPageX[0];\r\n                let deltaY = finalY - data.rollingPageY[0];\r\n                // We need to get all the dispatch targets on the start of the inertia event\r\n                const dispatchTo = this.targets.filter(t => data.initialTarget instanceof Node && t.contains(data.initialTarget));\r\n                this.inertia(dispatchTo, timestamp, // time now\r\n                Math.abs(deltaX) / deltaT, // speed\r\n                deltaX > 0 ? 1 : -1, // x direction\r\n                finalX, // x now\r\n                Math.abs(deltaY) / deltaT, // y speed\r\n                deltaY > 0 ? 1 : -1, // y direction\r\n                finalY // y now\r\n                );\r\n            }\r\n            this.dispatchEvent(this.newGestureEvent(EventType.End, data.initialTarget));\r\n            // forget about this touch\r\n            delete this.activeTouches[touch.identifier];\r\n        }\r\n        if (this.dispatched) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            this.dispatched = false;\r\n        }\r\n    }\r\n    newGestureEvent(type, initialTarget) {\r\n        let event = document.createEvent('CustomEvent');\r\n        event.initEvent(type, false, true);\r\n        event.initialTarget = initialTarget;\r\n        event.tapCount = 0;\r\n        return event;\r\n    }\r\n    dispatchEvent(event) {\r\n        if (event.type === EventType.Tap) {\r\n            const currentTime = (new Date()).getTime();\r\n            let setTapCount = 0;\r\n            if (currentTime - this._lastSetTapCountTime > Gesture.CLEAR_TAP_COUNT_TIME) {\r\n                setTapCount = 1;\r\n            }\r\n            else {\r\n                setTapCount = 2;\r\n            }\r\n            this._lastSetTapCountTime = currentTime;\r\n            event.tapCount = setTapCount;\r\n        }\r\n        else if (event.type === EventType.Change || event.type === EventType.Contextmenu) {\r\n            // tap is canceled by scrolling or context menu\r\n            this._lastSetTapCountTime = 0;\r\n        }\r\n        for (let i = 0; i < this.ignoreTargets.length; i++) {\r\n            if (event.initialTarget instanceof Node && this.ignoreTargets[i].contains(event.initialTarget)) {\r\n                return;\r\n            }\r\n        }\r\n        this.targets.forEach(target => {\r\n            if (event.initialTarget instanceof Node && target.contains(event.initialTarget)) {\r\n                target.dispatchEvent(event);\r\n                this.dispatched = true;\r\n            }\r\n        });\r\n    }\r\n    inertia(dispatchTo, t1, vX, dirX, x, vY, dirY, y) {\r\n        this.handle = DomUtils.scheduleAtNextAnimationFrame(() => {\r\n            let now = Date.now();\r\n            // velocity: old speed + accel_over_time\r\n            let deltaT = now - t1, delta_pos_x = 0, delta_pos_y = 0, stopped = true;\r\n            vX += Gesture.SCROLL_FRICTION * deltaT;\r\n            vY += Gesture.SCROLL_FRICTION * deltaT;\r\n            if (vX > 0) {\r\n                stopped = false;\r\n                delta_pos_x = dirX * vX * deltaT;\r\n            }\r\n            if (vY > 0) {\r\n                stopped = false;\r\n                delta_pos_y = dirY * vY * deltaT;\r\n            }\r\n            // dispatch translation event\r\n            let evt = this.newGestureEvent(EventType.Change);\r\n            evt.translationX = delta_pos_x;\r\n            evt.translationY = delta_pos_y;\r\n            dispatchTo.forEach(d => d.dispatchEvent(evt));\r\n            if (!stopped) {\r\n                this.inertia(dispatchTo, now, vX, dirX, x + delta_pos_x, vY, dirY, y + delta_pos_y);\r\n            }\r\n        });\r\n    }\r\n    onTouchMove(e) {\r\n        let timestamp = Date.now(); // use Date.now() because on FF e.timeStamp is not epoch based.\r\n        for (let i = 0, len = e.changedTouches.length; i < len; i++) {\r\n            let touch = e.changedTouches.item(i);\r\n            if (!this.activeTouches.hasOwnProperty(String(touch.identifier))) {\r\n                console.warn('end of an UNKNOWN touch', touch);\r\n                continue;\r\n            }\r\n            let data = this.activeTouches[touch.identifier];\r\n            let evt = this.newGestureEvent(EventType.Change, data.initialTarget);\r\n            evt.translationX = touch.pageX - arrays.tail(data.rollingPageX);\r\n            evt.translationY = touch.pageY - arrays.tail(data.rollingPageY);\r\n            evt.pageX = touch.pageX;\r\n            evt.pageY = touch.pageY;\r\n            this.dispatchEvent(evt);\r\n            // only keep a few data points, to average the final speed\r\n            if (data.rollingPageX.length > 3) {\r\n                data.rollingPageX.shift();\r\n                data.rollingPageY.shift();\r\n                data.rollingTimestamps.shift();\r\n            }\r\n            data.rollingPageX.push(touch.pageX);\r\n            data.rollingPageY.push(touch.pageY);\r\n            data.rollingTimestamps.push(timestamp);\r\n        }\r\n        if (this.dispatched) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            this.dispatched = false;\r\n        }\r\n    }\r\n}\r\nGesture.SCROLL_FRICTION = -0.005;\r\nGesture.HOLD_DELAY = 700;\r\nGesture.CLEAR_TAP_COUNT_TIME = 400; // ms\r\n__decorate([\r\n    memoize\r\n], Gesture, \"isTouchDevice\", null);\r\n"]},"metadata":{},"sourceType":"module"}