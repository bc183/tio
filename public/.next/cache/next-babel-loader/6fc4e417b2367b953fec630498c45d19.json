{"ast":null,"code":"import _get from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/get\";\nimport _inherits from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _classCallCheck from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport * as browser from '../../../base/browser/browser.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport * as platform from '../../../base/common/platform.js';\nimport { CharWidthRequest, readCharWidths } from './charWidthReader.js';\nimport { ElementSizeObserver } from './elementSizeObserver.js';\nimport { CommonEditorConfiguration } from '../../common/config/commonEditorConfig.js';\nimport { EditorFontLigatures } from '../../common/config/editorOptions.js';\nimport { FontInfo } from '../../common/config/fontInfo.js';\n\nvar CSSBasedConfigurationCache = /*#__PURE__*/function () {\n  function CSSBasedConfigurationCache() {\n    _classCallCheck(this, CSSBasedConfigurationCache);\n\n    this._keys = Object.create(null);\n    this._values = Object.create(null);\n  }\n\n  _createClass(CSSBasedConfigurationCache, [{\n    key: \"has\",\n    value: function has(item) {\n      var itemId = item.getId();\n      return !!this._values[itemId];\n    }\n  }, {\n    key: \"get\",\n    value: function get(item) {\n      var itemId = item.getId();\n      return this._values[itemId];\n    }\n  }, {\n    key: \"put\",\n    value: function put(item, value) {\n      var itemId = item.getId();\n      this._keys[itemId] = item;\n      this._values[itemId] = value;\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(item) {\n      var itemId = item.getId();\n      delete this._keys[itemId];\n      delete this._values[itemId];\n    }\n  }, {\n    key: \"getValues\",\n    value: function getValues() {\n      var _this = this;\n\n      return Object.keys(this._keys).map(function (id) {\n        return _this._values[id];\n      });\n    }\n  }]);\n\n  return CSSBasedConfigurationCache;\n}();\n\nexport function clearAllFontInfos() {\n  CSSBasedConfiguration.INSTANCE.clearCache();\n}\n\nvar CSSBasedConfiguration = /*#__PURE__*/function (_Disposable) {\n  _inherits(CSSBasedConfiguration, _Disposable);\n\n  var _super = _createSuper(CSSBasedConfiguration);\n\n  function CSSBasedConfiguration() {\n    var _this2;\n\n    _classCallCheck(this, CSSBasedConfiguration);\n\n    _this2 = _super.call(this);\n    _this2._onDidChange = _this2._register(new Emitter());\n    _this2.onDidChange = _this2._onDidChange.event;\n    _this2._cache = new CSSBasedConfigurationCache();\n    _this2._evictUntrustedReadingsTimeout = -1;\n    return _this2;\n  }\n\n  _createClass(CSSBasedConfiguration, [{\n    key: \"dispose\",\n    value: function dispose() {\n      if (this._evictUntrustedReadingsTimeout !== -1) {\n        clearTimeout(this._evictUntrustedReadingsTimeout);\n        this._evictUntrustedReadingsTimeout = -1;\n      }\n\n      _get(_getPrototypeOf(CSSBasedConfiguration.prototype), \"dispose\", this).call(this);\n    }\n  }, {\n    key: \"clearCache\",\n    value: function clearCache() {\n      this._cache = new CSSBasedConfigurationCache();\n\n      this._onDidChange.fire();\n    }\n  }, {\n    key: \"_writeToCache\",\n    value: function _writeToCache(item, value) {\n      var _this3 = this;\n\n      this._cache.put(item, value);\n\n      if (!value.isTrusted && this._evictUntrustedReadingsTimeout === -1) {\n        // Try reading again after some time\n        this._evictUntrustedReadingsTimeout = setTimeout(function () {\n          _this3._evictUntrustedReadingsTimeout = -1;\n\n          _this3._evictUntrustedReadings();\n        }, 5000);\n      }\n    }\n  }, {\n    key: \"_evictUntrustedReadings\",\n    value: function _evictUntrustedReadings() {\n      var values = this._cache.getValues();\n\n      var somethingRemoved = false;\n\n      var _iterator = _createForOfIteratorHelper(values),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var item = _step.value;\n\n          if (!item.isTrusted) {\n            somethingRemoved = true;\n\n            this._cache.remove(item);\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      if (somethingRemoved) {\n        this._onDidChange.fire();\n      }\n    }\n  }, {\n    key: \"readConfiguration\",\n    value: function readConfiguration(bareFontInfo) {\n      if (!this._cache.has(bareFontInfo)) {\n        var readConfig = CSSBasedConfiguration._actualReadConfiguration(bareFontInfo);\n\n        if (readConfig.typicalHalfwidthCharacterWidth <= 2 || readConfig.typicalFullwidthCharacterWidth <= 2 || readConfig.spaceWidth <= 2 || readConfig.maxDigitWidth <= 2) {\n          // Hey, it's Bug 14341 ... we couldn't read\n          readConfig = new FontInfo({\n            zoomLevel: browser.getZoomLevel(),\n            pixelRatio: browser.getPixelRatio(),\n            fontFamily: readConfig.fontFamily,\n            fontWeight: readConfig.fontWeight,\n            fontSize: readConfig.fontSize,\n            fontFeatureSettings: readConfig.fontFeatureSettings,\n            lineHeight: readConfig.lineHeight,\n            letterSpacing: readConfig.letterSpacing,\n            isMonospace: readConfig.isMonospace,\n            typicalHalfwidthCharacterWidth: Math.max(readConfig.typicalHalfwidthCharacterWidth, 5),\n            typicalFullwidthCharacterWidth: Math.max(readConfig.typicalFullwidthCharacterWidth, 5),\n            canUseHalfwidthRightwardsArrow: readConfig.canUseHalfwidthRightwardsArrow,\n            spaceWidth: Math.max(readConfig.spaceWidth, 5),\n            middotWidth: Math.max(readConfig.middotWidth, 5),\n            wsmiddotWidth: Math.max(readConfig.wsmiddotWidth, 5),\n            maxDigitWidth: Math.max(readConfig.maxDigitWidth, 5)\n          }, false);\n        }\n\n        this._writeToCache(bareFontInfo, readConfig);\n      }\n\n      return this._cache.get(bareFontInfo);\n    }\n  }], [{\n    key: \"createRequest\",\n    value: function createRequest(chr, type, all, monospace) {\n      var result = new CharWidthRequest(chr, type);\n      all.push(result);\n\n      if (monospace) {\n        monospace.push(result);\n      }\n\n      return result;\n    }\n  }, {\n    key: \"_actualReadConfiguration\",\n    value: function _actualReadConfiguration(bareFontInfo) {\n      var all = [];\n      var monospace = [];\n      var typicalHalfwidthCharacter = this.createRequest('n', 0\n      /* Regular */\n      , all, monospace);\n      var typicalFullwidthCharacter = this.createRequest(\"\\uFF4D\", 0\n      /* Regular */\n      , all, null);\n      var space = this.createRequest(' ', 0\n      /* Regular */\n      , all, monospace);\n      var digit0 = this.createRequest('0', 0\n      /* Regular */\n      , all, monospace);\n      var digit1 = this.createRequest('1', 0\n      /* Regular */\n      , all, monospace);\n      var digit2 = this.createRequest('2', 0\n      /* Regular */\n      , all, monospace);\n      var digit3 = this.createRequest('3', 0\n      /* Regular */\n      , all, monospace);\n      var digit4 = this.createRequest('4', 0\n      /* Regular */\n      , all, monospace);\n      var digit5 = this.createRequest('5', 0\n      /* Regular */\n      , all, monospace);\n      var digit6 = this.createRequest('6', 0\n      /* Regular */\n      , all, monospace);\n      var digit7 = this.createRequest('7', 0\n      /* Regular */\n      , all, monospace);\n      var digit8 = this.createRequest('8', 0\n      /* Regular */\n      , all, monospace);\n      var digit9 = this.createRequest('9', 0\n      /* Regular */\n      , all, monospace); // monospace test: used for whitespace rendering\n\n      var rightwardsArrow = this.createRequest('→', 0\n      /* Regular */\n      , all, monospace);\n      var halfwidthRightwardsArrow = this.createRequest('￫', 0\n      /* Regular */\n      , all, null); // U+00B7 - MIDDLE DOT\n\n      var middot = this.createRequest('·', 0\n      /* Regular */\n      , all, monospace); // U+2E31 - WORD SEPARATOR MIDDLE DOT\n\n      var wsmiddotWidth = this.createRequest(String.fromCharCode(0x2E31), 0\n      /* Regular */\n      , all, null); // monospace test: some characters\n\n      this.createRequest('|', 0\n      /* Regular */\n      , all, monospace);\n      this.createRequest('/', 0\n      /* Regular */\n      , all, monospace);\n      this.createRequest('-', 0\n      /* Regular */\n      , all, monospace);\n      this.createRequest('_', 0\n      /* Regular */\n      , all, monospace);\n      this.createRequest('i', 0\n      /* Regular */\n      , all, monospace);\n      this.createRequest('l', 0\n      /* Regular */\n      , all, monospace);\n      this.createRequest('m', 0\n      /* Regular */\n      , all, monospace); // monospace italic test\n\n      this.createRequest('|', 1\n      /* Italic */\n      , all, monospace);\n      this.createRequest('_', 1\n      /* Italic */\n      , all, monospace);\n      this.createRequest('i', 1\n      /* Italic */\n      , all, monospace);\n      this.createRequest('l', 1\n      /* Italic */\n      , all, monospace);\n      this.createRequest('m', 1\n      /* Italic */\n      , all, monospace);\n      this.createRequest('n', 1\n      /* Italic */\n      , all, monospace); // monospace bold test\n\n      this.createRequest('|', 2\n      /* Bold */\n      , all, monospace);\n      this.createRequest('_', 2\n      /* Bold */\n      , all, monospace);\n      this.createRequest('i', 2\n      /* Bold */\n      , all, monospace);\n      this.createRequest('l', 2\n      /* Bold */\n      , all, monospace);\n      this.createRequest('m', 2\n      /* Bold */\n      , all, monospace);\n      this.createRequest('n', 2\n      /* Bold */\n      , all, monospace);\n      readCharWidths(bareFontInfo, all);\n      var maxDigitWidth = Math.max(digit0.width, digit1.width, digit2.width, digit3.width, digit4.width, digit5.width, digit6.width, digit7.width, digit8.width, digit9.width);\n      var isMonospace = bareFontInfo.fontFeatureSettings === EditorFontLigatures.OFF;\n      var referenceWidth = monospace[0].width;\n\n      for (var i = 1, len = monospace.length; isMonospace && i < len; i++) {\n        var diff = referenceWidth - monospace[i].width;\n\n        if (diff < -0.001 || diff > 0.001) {\n          isMonospace = false;\n          break;\n        }\n      }\n\n      var canUseHalfwidthRightwardsArrow = true;\n\n      if (isMonospace && halfwidthRightwardsArrow.width !== referenceWidth) {\n        // using a halfwidth rightwards arrow would break monospace...\n        canUseHalfwidthRightwardsArrow = false;\n      }\n\n      if (halfwidthRightwardsArrow.width > rightwardsArrow.width) {\n        // using a halfwidth rightwards arrow would paint a larger arrow than a regular rightwards arrow\n        canUseHalfwidthRightwardsArrow = false;\n      } // let's trust the zoom level only 2s after it was changed.\n\n\n      var canTrustBrowserZoomLevel = browser.getTimeSinceLastZoomLevelChanged() > 2000;\n      return new FontInfo({\n        zoomLevel: browser.getZoomLevel(),\n        pixelRatio: browser.getPixelRatio(),\n        fontFamily: bareFontInfo.fontFamily,\n        fontWeight: bareFontInfo.fontWeight,\n        fontSize: bareFontInfo.fontSize,\n        fontFeatureSettings: bareFontInfo.fontFeatureSettings,\n        lineHeight: bareFontInfo.lineHeight,\n        letterSpacing: bareFontInfo.letterSpacing,\n        isMonospace: isMonospace,\n        typicalHalfwidthCharacterWidth: typicalHalfwidthCharacter.width,\n        typicalFullwidthCharacterWidth: typicalFullwidthCharacter.width,\n        canUseHalfwidthRightwardsArrow: canUseHalfwidthRightwardsArrow,\n        spaceWidth: space.width,\n        middotWidth: middot.width,\n        wsmiddotWidth: wsmiddotWidth.width,\n        maxDigitWidth: maxDigitWidth\n      }, canTrustBrowserZoomLevel);\n    }\n  }]);\n\n  return CSSBasedConfiguration;\n}(Disposable);\n\nCSSBasedConfiguration.INSTANCE = new CSSBasedConfiguration();\nexport var Configuration = /*#__PURE__*/function (_CommonEditorConfigur) {\n  _inherits(Configuration, _CommonEditorConfigur);\n\n  var _super2 = _createSuper(Configuration);\n\n  function Configuration(isSimpleWidget, options) {\n    var _this4;\n\n    var referenceDomElement = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    var accessibilityService = arguments.length > 3 ? arguments[3] : undefined;\n\n    _classCallCheck(this, Configuration);\n\n    _this4 = _super2.call(this, isSimpleWidget, options);\n    _this4.accessibilityService = accessibilityService;\n    _this4._elementSizeObserver = _this4._register(new ElementSizeObserver(referenceDomElement, options.dimension, function () {\n      return _this4._recomputeOptions();\n    }));\n\n    _this4._register(CSSBasedConfiguration.INSTANCE.onDidChange(function () {\n      return _this4._recomputeOptions();\n    }));\n\n    if (_this4._validatedOptions.get(9\n    /* automaticLayout */\n    )) {\n      _this4._elementSizeObserver.startObserving();\n    }\n\n    _this4._register(browser.onDidChangeZoomLevel(function (_) {\n      return _this4._recomputeOptions();\n    }));\n\n    _this4._register(_this4.accessibilityService.onDidChangeScreenReaderOptimized(function () {\n      return _this4._recomputeOptions();\n    }));\n\n    _this4._recomputeOptions();\n\n    return _this4;\n  }\n\n  _createClass(Configuration, [{\n    key: \"observeReferenceElement\",\n    value: function observeReferenceElement(dimension) {\n      this._elementSizeObserver.observe(dimension);\n    }\n  }, {\n    key: \"updatePixelRatio\",\n    value: function updatePixelRatio() {\n      this._recomputeOptions();\n    }\n  }, {\n    key: \"_getEnvConfiguration\",\n    value: function _getEnvConfiguration() {\n      return {\n        extraEditorClassName: Configuration._getExtraEditorClassName(),\n        outerWidth: this._elementSizeObserver.getWidth(),\n        outerHeight: this._elementSizeObserver.getHeight(),\n        emptySelectionClipboard: browser.isWebKit || browser.isFirefox,\n        pixelRatio: browser.getPixelRatio(),\n        zoomLevel: browser.getZoomLevel(),\n        accessibilitySupport: this.accessibilityService.isScreenReaderOptimized() ? 2\n        /* Enabled */\n        : this.accessibilityService.getAccessibilitySupport()\n      };\n    }\n  }, {\n    key: \"readConfiguration\",\n    value: function readConfiguration(bareFontInfo) {\n      return CSSBasedConfiguration.INSTANCE.readConfiguration(bareFontInfo);\n    }\n  }], [{\n    key: \"applyFontInfoSlow\",\n    value: function applyFontInfoSlow(domNode, fontInfo) {\n      domNode.style.fontFamily = fontInfo.getMassagedFontFamily();\n      domNode.style.fontWeight = fontInfo.fontWeight;\n      domNode.style.fontSize = fontInfo.fontSize + 'px';\n      domNode.style.fontFeatureSettings = fontInfo.fontFeatureSettings;\n      domNode.style.lineHeight = fontInfo.lineHeight + 'px';\n      domNode.style.letterSpacing = fontInfo.letterSpacing + 'px';\n    }\n  }, {\n    key: \"applyFontInfo\",\n    value: function applyFontInfo(domNode, fontInfo) {\n      domNode.setFontFamily(fontInfo.getMassagedFontFamily());\n      domNode.setFontWeight(fontInfo.fontWeight);\n      domNode.setFontSize(fontInfo.fontSize);\n      domNode.setFontFeatureSettings(fontInfo.fontFeatureSettings);\n      domNode.setLineHeight(fontInfo.lineHeight);\n      domNode.setLetterSpacing(fontInfo.letterSpacing);\n    }\n  }, {\n    key: \"_getExtraEditorClassName\",\n    value: function _getExtraEditorClassName() {\n      var extra = '';\n\n      if (!browser.isSafari && !browser.isWebkitWebView) {\n        // Use user-select: none in all browsers except Safari and native macOS WebView\n        extra += 'no-user-select ';\n      }\n\n      if (browser.isSafari) {\n        // See https://github.com/microsoft/vscode/issues/108822\n        extra += 'no-minimap-shadow ';\n      }\n\n      if (platform.isMacintosh) {\n        extra += 'mac ';\n      }\n\n      return extra;\n    }\n  }]);\n\n  return Configuration;\n}(CommonEditorConfiguration);","map":{"version":3,"sources":["/home/bar007/Desktop/projects/tio/client/node_modules/monaco-editor/esm/vs/editor/browser/config/configuration.js"],"names":["browser","Emitter","Disposable","platform","CharWidthRequest","readCharWidths","ElementSizeObserver","CommonEditorConfiguration","EditorFontLigatures","FontInfo","CSSBasedConfigurationCache","_keys","Object","create","_values","item","itemId","getId","value","keys","map","id","clearAllFontInfos","CSSBasedConfiguration","INSTANCE","clearCache","_onDidChange","_register","onDidChange","event","_cache","_evictUntrustedReadingsTimeout","clearTimeout","fire","put","isTrusted","setTimeout","_evictUntrustedReadings","values","getValues","somethingRemoved","remove","bareFontInfo","has","readConfig","_actualReadConfiguration","typicalHalfwidthCharacterWidth","typicalFullwidthCharacterWidth","spaceWidth","maxDigitWidth","zoomLevel","getZoomLevel","pixelRatio","getPixelRatio","fontFamily","fontWeight","fontSize","fontFeatureSettings","lineHeight","letterSpacing","isMonospace","Math","max","canUseHalfwidthRightwardsArrow","middotWidth","wsmiddotWidth","_writeToCache","get","chr","type","all","monospace","result","push","typicalHalfwidthCharacter","createRequest","typicalFullwidthCharacter","space","digit0","digit1","digit2","digit3","digit4","digit5","digit6","digit7","digit8","digit9","rightwardsArrow","halfwidthRightwardsArrow","middot","String","fromCharCode","width","OFF","referenceWidth","i","len","length","diff","canTrustBrowserZoomLevel","getTimeSinceLastZoomLevelChanged","Configuration","isSimpleWidget","options","referenceDomElement","accessibilityService","_elementSizeObserver","dimension","_recomputeOptions","_validatedOptions","startObserving","onDidChangeZoomLevel","_","onDidChangeScreenReaderOptimized","observe","extraEditorClassName","_getExtraEditorClassName","outerWidth","getWidth","outerHeight","getHeight","emptySelectionClipboard","isWebKit","isFirefox","accessibilitySupport","isScreenReaderOptimized","getAccessibilitySupport","readConfiguration","domNode","fontInfo","style","getMassagedFontFamily","setFontFamily","setFontWeight","setFontSize","setFontFeatureSettings","setLineHeight","setLetterSpacing","extra","isSafari","isWebkitWebView","isMacintosh"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport * as browser from '../../../base/browser/browser.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nimport * as platform from '../../../base/common/platform.js';\r\nimport { CharWidthRequest, readCharWidths } from './charWidthReader.js';\r\nimport { ElementSizeObserver } from './elementSizeObserver.js';\r\nimport { CommonEditorConfiguration } from '../../common/config/commonEditorConfig.js';\r\nimport { EditorFontLigatures } from '../../common/config/editorOptions.js';\r\nimport { FontInfo } from '../../common/config/fontInfo.js';\r\nclass CSSBasedConfigurationCache {\r\n    constructor() {\r\n        this._keys = Object.create(null);\r\n        this._values = Object.create(null);\r\n    }\r\n    has(item) {\r\n        const itemId = item.getId();\r\n        return !!this._values[itemId];\r\n    }\r\n    get(item) {\r\n        const itemId = item.getId();\r\n        return this._values[itemId];\r\n    }\r\n    put(item, value) {\r\n        const itemId = item.getId();\r\n        this._keys[itemId] = item;\r\n        this._values[itemId] = value;\r\n    }\r\n    remove(item) {\r\n        const itemId = item.getId();\r\n        delete this._keys[itemId];\r\n        delete this._values[itemId];\r\n    }\r\n    getValues() {\r\n        return Object.keys(this._keys).map(id => this._values[id]);\r\n    }\r\n}\r\nexport function clearAllFontInfos() {\r\n    CSSBasedConfiguration.INSTANCE.clearCache();\r\n}\r\nclass CSSBasedConfiguration extends Disposable {\r\n    constructor() {\r\n        super();\r\n        this._onDidChange = this._register(new Emitter());\r\n        this.onDidChange = this._onDidChange.event;\r\n        this._cache = new CSSBasedConfigurationCache();\r\n        this._evictUntrustedReadingsTimeout = -1;\r\n    }\r\n    dispose() {\r\n        if (this._evictUntrustedReadingsTimeout !== -1) {\r\n            clearTimeout(this._evictUntrustedReadingsTimeout);\r\n            this._evictUntrustedReadingsTimeout = -1;\r\n        }\r\n        super.dispose();\r\n    }\r\n    clearCache() {\r\n        this._cache = new CSSBasedConfigurationCache();\r\n        this._onDidChange.fire();\r\n    }\r\n    _writeToCache(item, value) {\r\n        this._cache.put(item, value);\r\n        if (!value.isTrusted && this._evictUntrustedReadingsTimeout === -1) {\r\n            // Try reading again after some time\r\n            this._evictUntrustedReadingsTimeout = setTimeout(() => {\r\n                this._evictUntrustedReadingsTimeout = -1;\r\n                this._evictUntrustedReadings();\r\n            }, 5000);\r\n        }\r\n    }\r\n    _evictUntrustedReadings() {\r\n        const values = this._cache.getValues();\r\n        let somethingRemoved = false;\r\n        for (const item of values) {\r\n            if (!item.isTrusted) {\r\n                somethingRemoved = true;\r\n                this._cache.remove(item);\r\n            }\r\n        }\r\n        if (somethingRemoved) {\r\n            this._onDidChange.fire();\r\n        }\r\n    }\r\n    readConfiguration(bareFontInfo) {\r\n        if (!this._cache.has(bareFontInfo)) {\r\n            let readConfig = CSSBasedConfiguration._actualReadConfiguration(bareFontInfo);\r\n            if (readConfig.typicalHalfwidthCharacterWidth <= 2 || readConfig.typicalFullwidthCharacterWidth <= 2 || readConfig.spaceWidth <= 2 || readConfig.maxDigitWidth <= 2) {\r\n                // Hey, it's Bug 14341 ... we couldn't read\r\n                readConfig = new FontInfo({\r\n                    zoomLevel: browser.getZoomLevel(),\r\n                    pixelRatio: browser.getPixelRatio(),\r\n                    fontFamily: readConfig.fontFamily,\r\n                    fontWeight: readConfig.fontWeight,\r\n                    fontSize: readConfig.fontSize,\r\n                    fontFeatureSettings: readConfig.fontFeatureSettings,\r\n                    lineHeight: readConfig.lineHeight,\r\n                    letterSpacing: readConfig.letterSpacing,\r\n                    isMonospace: readConfig.isMonospace,\r\n                    typicalHalfwidthCharacterWidth: Math.max(readConfig.typicalHalfwidthCharacterWidth, 5),\r\n                    typicalFullwidthCharacterWidth: Math.max(readConfig.typicalFullwidthCharacterWidth, 5),\r\n                    canUseHalfwidthRightwardsArrow: readConfig.canUseHalfwidthRightwardsArrow,\r\n                    spaceWidth: Math.max(readConfig.spaceWidth, 5),\r\n                    middotWidth: Math.max(readConfig.middotWidth, 5),\r\n                    wsmiddotWidth: Math.max(readConfig.wsmiddotWidth, 5),\r\n                    maxDigitWidth: Math.max(readConfig.maxDigitWidth, 5),\r\n                }, false);\r\n            }\r\n            this._writeToCache(bareFontInfo, readConfig);\r\n        }\r\n        return this._cache.get(bareFontInfo);\r\n    }\r\n    static createRequest(chr, type, all, monospace) {\r\n        const result = new CharWidthRequest(chr, type);\r\n        all.push(result);\r\n        if (monospace) {\r\n            monospace.push(result);\r\n        }\r\n        return result;\r\n    }\r\n    static _actualReadConfiguration(bareFontInfo) {\r\n        const all = [];\r\n        const monospace = [];\r\n        const typicalHalfwidthCharacter = this.createRequest('n', 0 /* Regular */, all, monospace);\r\n        const typicalFullwidthCharacter = this.createRequest('\\uff4d', 0 /* Regular */, all, null);\r\n        const space = this.createRequest(' ', 0 /* Regular */, all, monospace);\r\n        const digit0 = this.createRequest('0', 0 /* Regular */, all, monospace);\r\n        const digit1 = this.createRequest('1', 0 /* Regular */, all, monospace);\r\n        const digit2 = this.createRequest('2', 0 /* Regular */, all, monospace);\r\n        const digit3 = this.createRequest('3', 0 /* Regular */, all, monospace);\r\n        const digit4 = this.createRequest('4', 0 /* Regular */, all, monospace);\r\n        const digit5 = this.createRequest('5', 0 /* Regular */, all, monospace);\r\n        const digit6 = this.createRequest('6', 0 /* Regular */, all, monospace);\r\n        const digit7 = this.createRequest('7', 0 /* Regular */, all, monospace);\r\n        const digit8 = this.createRequest('8', 0 /* Regular */, all, monospace);\r\n        const digit9 = this.createRequest('9', 0 /* Regular */, all, monospace);\r\n        // monospace test: used for whitespace rendering\r\n        const rightwardsArrow = this.createRequest('→', 0 /* Regular */, all, monospace);\r\n        const halfwidthRightwardsArrow = this.createRequest('￫', 0 /* Regular */, all, null);\r\n        // U+00B7 - MIDDLE DOT\r\n        const middot = this.createRequest('·', 0 /* Regular */, all, monospace);\r\n        // U+2E31 - WORD SEPARATOR MIDDLE DOT\r\n        const wsmiddotWidth = this.createRequest(String.fromCharCode(0x2E31), 0 /* Regular */, all, null);\r\n        // monospace test: some characters\r\n        this.createRequest('|', 0 /* Regular */, all, monospace);\r\n        this.createRequest('/', 0 /* Regular */, all, monospace);\r\n        this.createRequest('-', 0 /* Regular */, all, monospace);\r\n        this.createRequest('_', 0 /* Regular */, all, monospace);\r\n        this.createRequest('i', 0 /* Regular */, all, monospace);\r\n        this.createRequest('l', 0 /* Regular */, all, monospace);\r\n        this.createRequest('m', 0 /* Regular */, all, monospace);\r\n        // monospace italic test\r\n        this.createRequest('|', 1 /* Italic */, all, monospace);\r\n        this.createRequest('_', 1 /* Italic */, all, monospace);\r\n        this.createRequest('i', 1 /* Italic */, all, monospace);\r\n        this.createRequest('l', 1 /* Italic */, all, monospace);\r\n        this.createRequest('m', 1 /* Italic */, all, monospace);\r\n        this.createRequest('n', 1 /* Italic */, all, monospace);\r\n        // monospace bold test\r\n        this.createRequest('|', 2 /* Bold */, all, monospace);\r\n        this.createRequest('_', 2 /* Bold */, all, monospace);\r\n        this.createRequest('i', 2 /* Bold */, all, monospace);\r\n        this.createRequest('l', 2 /* Bold */, all, monospace);\r\n        this.createRequest('m', 2 /* Bold */, all, monospace);\r\n        this.createRequest('n', 2 /* Bold */, all, monospace);\r\n        readCharWidths(bareFontInfo, all);\r\n        const maxDigitWidth = Math.max(digit0.width, digit1.width, digit2.width, digit3.width, digit4.width, digit5.width, digit6.width, digit7.width, digit8.width, digit9.width);\r\n        let isMonospace = (bareFontInfo.fontFeatureSettings === EditorFontLigatures.OFF);\r\n        const referenceWidth = monospace[0].width;\r\n        for (let i = 1, len = monospace.length; isMonospace && i < len; i++) {\r\n            const diff = referenceWidth - monospace[i].width;\r\n            if (diff < -0.001 || diff > 0.001) {\r\n                isMonospace = false;\r\n                break;\r\n            }\r\n        }\r\n        let canUseHalfwidthRightwardsArrow = true;\r\n        if (isMonospace && halfwidthRightwardsArrow.width !== referenceWidth) {\r\n            // using a halfwidth rightwards arrow would break monospace...\r\n            canUseHalfwidthRightwardsArrow = false;\r\n        }\r\n        if (halfwidthRightwardsArrow.width > rightwardsArrow.width) {\r\n            // using a halfwidth rightwards arrow would paint a larger arrow than a regular rightwards arrow\r\n            canUseHalfwidthRightwardsArrow = false;\r\n        }\r\n        // let's trust the zoom level only 2s after it was changed.\r\n        const canTrustBrowserZoomLevel = (browser.getTimeSinceLastZoomLevelChanged() > 2000);\r\n        return new FontInfo({\r\n            zoomLevel: browser.getZoomLevel(),\r\n            pixelRatio: browser.getPixelRatio(),\r\n            fontFamily: bareFontInfo.fontFamily,\r\n            fontWeight: bareFontInfo.fontWeight,\r\n            fontSize: bareFontInfo.fontSize,\r\n            fontFeatureSettings: bareFontInfo.fontFeatureSettings,\r\n            lineHeight: bareFontInfo.lineHeight,\r\n            letterSpacing: bareFontInfo.letterSpacing,\r\n            isMonospace: isMonospace,\r\n            typicalHalfwidthCharacterWidth: typicalHalfwidthCharacter.width,\r\n            typicalFullwidthCharacterWidth: typicalFullwidthCharacter.width,\r\n            canUseHalfwidthRightwardsArrow: canUseHalfwidthRightwardsArrow,\r\n            spaceWidth: space.width,\r\n            middotWidth: middot.width,\r\n            wsmiddotWidth: wsmiddotWidth.width,\r\n            maxDigitWidth: maxDigitWidth\r\n        }, canTrustBrowserZoomLevel);\r\n    }\r\n}\r\nCSSBasedConfiguration.INSTANCE = new CSSBasedConfiguration();\r\nexport class Configuration extends CommonEditorConfiguration {\r\n    constructor(isSimpleWidget, options, referenceDomElement = null, accessibilityService) {\r\n        super(isSimpleWidget, options);\r\n        this.accessibilityService = accessibilityService;\r\n        this._elementSizeObserver = this._register(new ElementSizeObserver(referenceDomElement, options.dimension, () => this._recomputeOptions()));\r\n        this._register(CSSBasedConfiguration.INSTANCE.onDidChange(() => this._recomputeOptions()));\r\n        if (this._validatedOptions.get(9 /* automaticLayout */)) {\r\n            this._elementSizeObserver.startObserving();\r\n        }\r\n        this._register(browser.onDidChangeZoomLevel(_ => this._recomputeOptions()));\r\n        this._register(this.accessibilityService.onDidChangeScreenReaderOptimized(() => this._recomputeOptions()));\r\n        this._recomputeOptions();\r\n    }\r\n    static applyFontInfoSlow(domNode, fontInfo) {\r\n        domNode.style.fontFamily = fontInfo.getMassagedFontFamily();\r\n        domNode.style.fontWeight = fontInfo.fontWeight;\r\n        domNode.style.fontSize = fontInfo.fontSize + 'px';\r\n        domNode.style.fontFeatureSettings = fontInfo.fontFeatureSettings;\r\n        domNode.style.lineHeight = fontInfo.lineHeight + 'px';\r\n        domNode.style.letterSpacing = fontInfo.letterSpacing + 'px';\r\n    }\r\n    static applyFontInfo(domNode, fontInfo) {\r\n        domNode.setFontFamily(fontInfo.getMassagedFontFamily());\r\n        domNode.setFontWeight(fontInfo.fontWeight);\r\n        domNode.setFontSize(fontInfo.fontSize);\r\n        domNode.setFontFeatureSettings(fontInfo.fontFeatureSettings);\r\n        domNode.setLineHeight(fontInfo.lineHeight);\r\n        domNode.setLetterSpacing(fontInfo.letterSpacing);\r\n    }\r\n    observeReferenceElement(dimension) {\r\n        this._elementSizeObserver.observe(dimension);\r\n    }\r\n    updatePixelRatio() {\r\n        this._recomputeOptions();\r\n    }\r\n    static _getExtraEditorClassName() {\r\n        let extra = '';\r\n        if (!browser.isSafari && !browser.isWebkitWebView) {\r\n            // Use user-select: none in all browsers except Safari and native macOS WebView\r\n            extra += 'no-user-select ';\r\n        }\r\n        if (browser.isSafari) {\r\n            // See https://github.com/microsoft/vscode/issues/108822\r\n            extra += 'no-minimap-shadow ';\r\n        }\r\n        if (platform.isMacintosh) {\r\n            extra += 'mac ';\r\n        }\r\n        return extra;\r\n    }\r\n    _getEnvConfiguration() {\r\n        return {\r\n            extraEditorClassName: Configuration._getExtraEditorClassName(),\r\n            outerWidth: this._elementSizeObserver.getWidth(),\r\n            outerHeight: this._elementSizeObserver.getHeight(),\r\n            emptySelectionClipboard: browser.isWebKit || browser.isFirefox,\r\n            pixelRatio: browser.getPixelRatio(),\r\n            zoomLevel: browser.getZoomLevel(),\r\n            accessibilitySupport: (this.accessibilityService.isScreenReaderOptimized()\r\n                ? 2 /* Enabled */\r\n                : this.accessibilityService.getAccessibilitySupport())\r\n        };\r\n    }\r\n    readConfiguration(bareFontInfo) {\r\n        return CSSBasedConfiguration.INSTANCE.readConfiguration(bareFontInfo);\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}