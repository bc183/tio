{"ast":null,"code":"import _regeneratorRuntime from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport Axios from \"axios\";\nimport Head from \"next/head\";\nimport { useRouter } from \"next/router\";\nimport { createRef, useState } from \"react\";\nimport useSWR from \"swr\";\nimport SideBar from \"../../../components/SideBar\";\nexport var __N_SSP = true;\nexport default function submit() {\n  var router = useRouter();\n  var fileInputRef = /*#__PURE__*/createRef();\n  var subName = router.query.sub;\n\n  var _useSWR = useSWR(subName ? \"/subs/\".concat(subName) : null),\n      sub = _useSWR.data,\n      error = _useSWR.error;\n\n  if (error) {\n    router.push('/');\n  }\n\n  var _useState = useState(\"\"),\n      title = _useState[0],\n      setTitle = _useState[1];\n\n  var _useState2 = useState(\"\"),\n      body = _useState2[0],\n      setBody = _useState2[1];\n\n  var _useState3 = useState(null),\n      image = _useState3[0],\n      setImage = _useState3[1];\n\n  var openFileInput = function openFileInput(type) {\n    fileInputRef.current.name = type;\n    fileInputRef.current.click();\n  };\n\n  var changeImage = function changeImage(event) {\n    var file = event.target.files[0];\n    setImage(file);\n  };\n\n  var uploadImageAndSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      var formData, _yield$Axios$post, post;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              formData = new FormData();\n              formData.append('file', image);\n              formData.append('title', title);\n              formData.append('body', body);\n              formData.append('sub', sub.name);\n              _context.prev = 6;\n              _context.next = 9;\n              return Axios.post('/posts', formData, {\n                headers: {\n                  'Content-Type': 'multipart/form-data'\n                }\n              });\n\n            case 9:\n              _yield$Axios$post = _context.sent;\n              post = _yield$Axios$post.data;\n              router.push(\"/r/\".concat(sub.name, \"/\").concat(post.identifier, \"/\").concat(post.slug));\n              _context.next = 17;\n              break;\n\n            case 14:\n              _context.prev = 14;\n              _context.t0 = _context[\"catch\"](6);\n              console.log(_context.t0);\n\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[6, 14]]);\n    }));\n\n    return function uploadImageAndSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"container flex pt-5\",\n    children: [/*#__PURE__*/_jsx(Head, {\n      children: /*#__PURE__*/_jsx(\"title\", {\n        children: \"Submit to TIO\"\n      })\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"w-160\",\n      children: [/*#__PURE__*/_jsx(\"input\", {\n        type: \"file\",\n        hidden: true,\n        ref: fileInputRef,\n        onChange: changeImage\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"p-4 bg-white rounded\",\n        children: [/*#__PURE__*/_jsxs(\"h1\", {\n          className: \"mb-3 text-lg\",\n          children: [\"Submit a post to /r/\", subName]\n        }), /*#__PURE__*/_jsxs(\"form\", {\n          onSubmit: uploadImageAndSubmit,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"relative mb-2\",\n            children: [/*#__PURE__*/_jsx(\"input\", {\n              type: \"text\",\n              className: \"w-full px-3 py-3 border border-gray-300 rounded focus:outline-none focus:border-gray-600\",\n              placeholder: \"Title\",\n              maxLength: 300,\n              value: title,\n              onChange: function onChange(e) {\n                return setTitle(e.target.value);\n              }\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"absolute mb-2 text-sm text-gray-500 select-none\",\n              style: {\n                top: 11,\n                right: 10\n              },\n              children: [title.trim().length, \" / 300\"]\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            children: [/*#__PURE__*/_jsx(\"span\", {\n              onClick: function onClick() {\n                return openFileInput('file');\n              },\n              className: \"mb-2 fa fa-plus hover:bg-gray-200\"\n            }), /*#__PURE__*/_jsx(\"span\", {\n              className: \"m-2\",\n              children: \"Add Photo\"\n            })]\n          }), image && /*#__PURE__*/_jsx(\"p\", {\n            className: \"text-sm\",\n            children: \"Image uploaded!\"\n          }), /*#__PURE__*/_jsx(\"textarea\", {\n            className: \"w-full p-3 border border-gray-300 rounded focus:outline-none focus:border-gray-600\",\n            value: body,\n            placeholder: \"Text (optional)\",\n            rows: 4,\n            onChange: function onChange(e) {\n              return setBody(e.target.value);\n            }\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"flex justify-end\",\n            children: /*#__PURE__*/_jsx(\"button\", {\n              className: \"px-3 py-1 blue button\",\n              type: \"submit\",\n              disabled: title.trim().length === 0,\n              children: \"Submit\"\n            })\n          })]\n        })]\n      })]\n    }), sub && /*#__PURE__*/_jsx(SideBar, {\n      sub: sub\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}