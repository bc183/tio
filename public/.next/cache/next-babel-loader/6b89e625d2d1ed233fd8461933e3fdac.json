{"ast":null,"code":"import _toConsumableArray from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/bar007/Desktop/projects/tio/client/pages/index.tsx\",\n    _s = $RefreshSig$();\n\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport dayjs from 'dayjs';\nimport 'react';\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport { Fragment, useEffect, useState } from 'react';\nimport PostCard from '../components/PostCard';\nimport useSwr, { useSWRInfinite } from 'swr';\nimport Image from 'next/image';\nimport { useAuthState } from '../context/auth';\ndayjs.extend(relativeTime);\nexport default function Home() {\n  _s();\n\n  var _ref,\n      _this = this;\n\n  //const { data: posts } = useSwr<Post[]>('/posts');\n  var _useSwr = useSwr('/misc/top-subs'),\n      topSubs = _useSwr.data;\n\n  var _useState = useState(1),\n      dummy = _useState[0],\n      setDummy = _useState[1];\n\n  var _useState2 = useState(''),\n      observedPost = _useState2[0],\n      setObservedPost = _useState2[1];\n\n  var _useSWRInfinite = useSWRInfinite(function (index) {\n    return \"/posts?page=\".concat(index);\n  }),\n      data = _useSWRInfinite.data,\n      error = _useSWRInfinite.error,\n      mutate = _useSWRInfinite.mutate,\n      page = _useSWRInfinite.size,\n      setPage = _useSWRInfinite.setSize,\n      isValidating = _useSWRInfinite.isValidating,\n      revalidate = _useSWRInfinite.revalidate;\n\n  var posts = data ? (_ref = []).concat.apply(_ref, _toConsumableArray(data)) : [];\n  var isLoadingInitialData = !data && !error;\n  var title = \"TIO: Talk It Out\";\n  var description = \"Talk It Out is a platorm where people gather together as a communtiy to talk about the stuffs they like.\";\n  useEffect(function () {\n    if (!posts || posts.length === 0) {\n      return;\n    }\n\n    var id = posts[posts.length - 1].identifier;\n\n    if (id !== observedPost) {\n      setObservedPost(id);\n      observeElement(document.getElementById(id));\n    }\n  }, [posts]);\n\n  var observeElement = function observeElement(element) {\n    if (!element) {\n      return;\n    }\n\n    var observer = new IntersectionObserver(function (entries) {\n      if (entries[0].isIntersecting === true) {\n        console.log(\"hii\");\n        setPage(page + 1);\n        observer.unobserve(element);\n      }\n    }, {\n      threshold: 1\n    });\n    observer.observe(element);\n  };\n\n  var setVote = function setVote(value, post) {\n    var index = 0;\n    posts.forEach(function (postTemp, indexTemp) {\n      if (postTemp.identifier === post.identifier) {\n        index = indexTemp;\n        console.log(post.identifier);\n      }\n    });\n    var postEdit = posts[index];\n    postEdit.userVote = value;\n    postEdit.voteScore = postEdit.voteScore === 0 || postEdit.voteScore === 1 || postEdit.voteScore === -1 ? value : postEdit.voteScore += value;\n    posts.splice(index, 1);\n    posts.splice(index, 0, postEdit);\n    console.log(posts);\n  };\n\n  var _useAuthState = useAuthState(),\n      authenticated = _useAuthState.authenticated;\n\n  return /*#__PURE__*/_jsxDEV(Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Head, {\n      children: [/*#__PURE__*/_jsxDEV(\"title\", {\n        children: title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"meta\", {\n        name: \"description\",\n        content: description\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"meta\", {\n        property: \"og:description\",\n        content: description\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"meta\", {\n        property: \"og:title\",\n        content: title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"meta\", {\n        property: \"twitter:title\",\n        content: title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"meta\", {\n        property: \"twitter:description\",\n        content: description\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container flex pt-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full md:w-160\",\n        children: [isLoadingInitialData && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-lg text-center\",\n          children: \"Loading...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 37\n        }, this), posts === null || posts === void 0 ? void 0 : posts.map(function (post) {\n          return /*#__PURE__*/_jsxDEV(PostCard, {\n            post: post,\n            setVote: setVote,\n            setDummy: setDummy,\n            dummy: dummy\n          }, post.identifier, false, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 13\n          }, _this);\n        }), isValidating && posts.length > 0 && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-lg text-center\",\n          children: \"Loading more...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 49\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"hidden px-4 ml-6 md:block md:p-0 w-80\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-white rounded\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4 border-b-2\",\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-lg font-semibold text-center\",\n              children: \"Top Communities\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 104,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: topSubs === null || topSubs === void 0 ? void 0 : topSubs.map(function (sub) {\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center px-4 py-2 text-xs border-b\",\n                children: [/*#__PURE__*/_jsxDEV(Link, {\n                  href: \"/r/\".concat(sub.name),\n                  children: /*#__PURE__*/_jsxDEV(\"a\", {\n                    children: /*#__PURE__*/_jsxDEV(Image, {\n                      className: \"rounded-full cursor-pointer\",\n                      src: sub.imageUrl,\n                      alt: \"sub\",\n                      width: 6 * 16 / 4,\n                      height: 6 * 16 / 4\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 114,\n                      columnNumber: 27\n                    }, _this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 113,\n                    columnNumber: 25\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 112,\n                  columnNumber: 23\n                }, _this), /*#__PURE__*/_jsxDEV(Link, {\n                  href: \"/r/\".concat(sub.name),\n                  children: /*#__PURE__*/_jsxDEV(\"a\", {\n                    className: \"ml-2 font-bold hover:cursor-pointer\",\n                    children: [\"/r/\", sub.name]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 124,\n                    columnNumber: 25\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 123,\n                  columnNumber: 21\n                }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"ml-auto font-medium\",\n                  children: sub.postCount\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 128,\n                  columnNumber: 23\n                }, _this)]\n              }, sub.name, true, {\n                fileName: _jsxFileName,\n                lineNumber: 111,\n                columnNumber: 19\n              }, _this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 13\n          }, this), authenticated && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4 border-t-2\",\n            children: /*#__PURE__*/_jsxDEV(Link, {\n              href: \"/subs/create\",\n              children: /*#__PURE__*/_jsxDEV(\"a\", {\n                className: \"w-full px-2 py-1 blue button\",\n                children: \"Create Community\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 136,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 135,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 5\n  }, this);\n} // server side rendering\n// export const getServerSideProps: GetServerSideProps = async (context) => {\n//   try {\n//     const res = await Axios.get('/posts')\n//     return { props: {posts: res.data} }\n//   } catch (error) {\n//     return {props: {error: 'Something went wrong'}}\n//   }\n// }\n\n_s(Home, \"iezjgXqILZPVvh9Q0UfW/QEdO7M=\", false, function () {\n  return [useSwr, useSWRInfinite, useAuthState];\n});\n\n_c = Home;\n\nvar _c;\n\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"sources":["/home/bar007/Desktop/projects/tio/client/pages/index.tsx"],"names":["Head","Link","dayjs","relativeTime","Fragment","useEffect","useState","PostCard","useSwr","useSWRInfinite","Image","useAuthState","extend","Home","topSubs","data","dummy","setDummy","observedPost","setObservedPost","index","error","mutate","page","size","setPage","setSize","isValidating","revalidate","posts","concat","isLoadingInitialData","title","description","length","id","identifier","observeElement","document","getElementById","element","observer","IntersectionObserver","entries","isIntersecting","console","log","unobserve","threshold","observe","setVote","value","post","forEach","postTemp","indexTemp","postEdit","userVote","voteScore","splice","authenticated","map","sub","name","imageUrl","postCount"],"mappings":"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","sourcesContent":["import Axios from 'axios'\nimport Head from 'next/head'\nimport Link from 'next/link'\nimport dayjs from 'dayjs';\nimport { } from 'react'\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport { Fragment, useEffect, useState } from 'react'\nimport { Post, Sub } from '../types'\nimport { GetServerSideProps } from 'next';\nimport PostCard from '../components/PostCard';\nimport useSwr, { useSWRInfinite } from 'swr';\nimport Image from 'next/image';\nimport { useAuthState } from '../context/auth';\n\ndayjs.extend(relativeTime);\n\n\n\nexport default function Home() {\n\n  //const { data: posts } = useSwr<Post[]>('/posts');\n  const { data: topSubs } = useSwr<Sub[]>('/misc/top-subs');\n\n  const [dummy, setDummy] = useState(1);\n\n  const [observedPost, setObservedPost] = useState('');\n\n  const { data, error, mutate, size: page, setSize: setPage, isValidating, revalidate } = useSWRInfinite<Post[]>(\n    index => `/posts?page=${index}`\n    )\n\n  const posts: Post[] = data? [].concat(...data): [];\n  const isLoadingInitialData = !data && !error;\n  const title: string = \"TIO: Talk It Out\";\n\n  const description: string = \"Talk It Out is a platorm where people gather together as a communtiy to talk about the stuffs they like.\";\n  useEffect(() => {\n    if (!posts || posts.length === 0)\n    {\n      return;\n    }\n    const id = posts[posts.length-1].identifier;\n    if (id !== observedPost) {\n      setObservedPost(id);\n      observeElement(document.getElementById(id))\n    }\n\n  }, [posts]);\n  \n\n  const observeElement = (element: HTMLElement) => {\n    if (!element) {\n      return;\n    }\n    const observer = new IntersectionObserver((entries) => {\n      if (entries[0].isIntersecting === true) {\n        console.log(\"hii\");\n        setPage(page+1)\n        observer.unobserve(element);\n      }\n    }, { threshold: 1 });\n    observer.observe(element);\n  }\n\n  const setVote = (value: number, post: Post) => {\n    let index: number = 0;\n    posts.forEach((postTemp, indexTemp) => {\n      if (postTemp.identifier === post.identifier) {\n        index = indexTemp;\n        console.log(post.identifier);\n      }\n    });\n    let postEdit = posts[index];\n    postEdit.userVote = value;\n    postEdit.voteScore = postEdit.voteScore === 0 || postEdit.voteScore === 1 || postEdit.voteScore === -1? value: postEdit.voteScore+=value;\n    posts.splice(index, 1);\n    posts.splice(index, 0, postEdit);\n    console.log(posts);\n  }\n\n  const { authenticated } = useAuthState()\n  return (\n    <Fragment>\n      <Head>\n        <title>{title}</title>\n        <meta name=\"description\" content={description}>\n        </meta>\n        <meta property=\"og:description\" content={description} />\n        <meta property=\"og:title\" content={title} />\n        <meta property=\"twitter:title\" content={title} />\n        <meta property=\"twitter:description\" content={description} />\n      </Head>\n      <div className=\"container flex pt-4\">\n        <div className=\"w-full md:w-160\">\n          { isLoadingInitialData && <p className=\"text-lg text-center\">Loading...</p> }\n          {posts?.map(post => (\n            <PostCard post={post} key={post.identifier} setVote={setVote} setDummy={setDummy} dummy={dummy}/>              \n          ))}\n          { isValidating && posts.length > 0 && <p className=\"text-lg text-center\">Loading more...</p> }\n        </div>\n        <div className=\"hidden px-4 ml-6 md:block md:p-0 w-80\">\n          <div className=\"bg-white rounded\">\n            <div className=\"p-4 border-b-2\">\n              <p className=\"text-lg font-semibold text-center\">\n                Top Communities\n              </p>\n            </div>\n            <div>\n              {topSubs?.map((sub)=> {\n                return (\n                  <div key={sub.name} className=\"flex items-center px-4 py-2 text-xs border-b\">\n                      <Link href={`/r/${sub.name}`}>\n                        <a>\n                          <Image \n                            className=\"rounded-full cursor-pointer\"\n                            src={sub.imageUrl}\n                            alt=\"sub\"\n                            width={6*16/4}\n                            height={6*16/4}\n                          />\n                        </a>\n                      </Link>\n                    <Link href={`/r/${sub.name}`}>\n                        <a className=\"ml-2 font-bold hover:cursor-pointer\">\n                          /r/{sub.name}\n                        </a>\n                      </Link>\n                      <p className=\"ml-auto font-medium\">{sub.postCount}</p>\n                  </div>\n                )\n              })}\n            </div>\n            {authenticated && (\n              <div className=\"p-4 border-t-2\">\n                <Link href=\"/subs/create\">\n                  <a className=\"w-full px-2 py-1 blue button\">  \n                    Create Community\n                  </a>\n                </Link>\n              </div>\n            )}\n            \n          </div> \n        </div>\n      </div>\n    </Fragment>\n  )\n}\n// server side rendering\n// export const getServerSideProps: GetServerSideProps = async (context) => {\n//   try {\n//     const res = await Axios.get('/posts')\n\n//     return { props: {posts: res.data} }\n//   } catch (error) {\n//     return {props: {error: 'Something went wrong'}}\n//   }\n// }\n\n"]},"metadata":{},"sourceType":"module"}