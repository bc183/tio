{"ast":null,"code":"import _regeneratorRuntime from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/bar007/Desktop/projects/tio/client/pages/r/[sub].tsx\",\n    _s = $RefreshSig$();\n\nimport Head from 'next/head';\nimport { useRouter } from 'next/router';\nimport React, { createRef, Fragment, useEffect, useState } from 'react';\nimport useSWR from 'swr';\nimport PostCard from '../../components/PostCard';\nimport SideBar from '../../components/SideBar';\nimport Image from 'next/image';\nimport { useAuthState } from '../../context/auth';\nimport classNames from 'classnames';\nimport Axios from 'axios';\nimport Link from 'next/link';\nexport default function SubPage() {\n  _s();\n\n  var _this = this;\n\n  var _useState = useState(null),\n      ownSub = _useState[0],\n      setOwnSub = _useState[1];\n\n  var router = useRouter();\n\n  var _useAuthState = useAuthState(),\n      authenticated = _useAuthState.authenticated,\n      user = _useAuthState.user;\n\n  var fileInputRef = /*#__PURE__*/createRef();\n  var subName = router.query.sub;\n\n  var _useSWR = useSWR(subName ? \"/subs/\".concat(subName) : null),\n      sub = _useSWR.data,\n      error = _useSWR.error,\n      revalidate = _useSWR.revalidate; //console.log(sub);\n\n\n  useEffect(function () {\n    if (!sub) {\n      return;\n    }\n\n    setOwnSub(authenticated && user.username === sub.username);\n  }, [sub]);\n\n  var openFileInput = function openFileInput(type) {\n    if (!ownSub) {\n      return;\n    }\n\n    fileInputRef.current.name = type;\n    fileInputRef.current.click();\n  };\n\n  var uploadImage = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      var file, formData;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              file = event.target.files[0];\n              formData = new FormData();\n              formData.append('file', file);\n              formData.append('type', fileInputRef.current.name);\n              _context.prev = 4;\n              _context.next = 7;\n              return Axios.post(\"/subs/\".concat(sub.name, \"/image\"), formData, {\n                headers: {\n                  'Content-Type': 'multipart/form-data'\n                }\n              });\n\n            case 7:\n              revalidate();\n              _context.next = 13;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](4);\n              console.log(_context.t0);\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[4, 10]]);\n    }));\n\n    return function uploadImage(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  if (error) router.push('/');\n  var postsMarkup;\n\n  if (!sub) {\n    postsMarkup = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-lg text-center\",\n      children: \"Loading..\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 19\n    }, this);\n  } else if (sub.posts.length === 0) {\n    postsMarkup = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-lg text-center\",\n      children: \"No posts submitted yet\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 19\n    }, this);\n  } else {\n    postsMarkup = sub.posts.map(function (post) {\n      return /*#__PURE__*/_jsxDEV(PostCard, {\n        post: post,\n        revalidate: revalidate\n      }, post.identifier, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 7\n      }, _this);\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Head, {\n      children: /*#__PURE__*/_jsxDEV(\"title\", {\n        children: sub === null || sub === void 0 ? void 0 : sub.title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }, this), sub && /*#__PURE__*/_jsxDEV(Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        hidden: true,\n        ref: fileInputRef,\n        onChange: uploadImage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: classNames(\"bg-blue-500\", {\n            'cursor-pointer': ownSub\n          }),\n          onClick: function onClick() {\n            return openFileInput('banner');\n          },\n          children: sub.bannerUrl ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"h-56 bg-blue-500\",\n            style: {\n              backgroundImage: \"url(\".concat(sub.bannerUrl, \")\"),\n              backgroundRepeat: 'no-repeat',\n              backgroundSize: 'cover',\n              backgroundPosition: 'center'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 90,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"h-20 bg-blue-500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"h-20 bg-white\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"container relative flex\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"absolute\",\n              style: {\n                top: -15\n              },\n              children: /*#__PURE__*/_jsxDEV(Image, {\n                src: sub.imageUrl,\n                alt: \"sub image\",\n                className: classNames(\"rounded-full\", {\n                  'cursor-pointer': ownSub\n                }),\n                width: 70,\n                height: 70,\n                onClick: function onClick() {\n                  return openFileInput('image');\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 105,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 104,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pt-1 pl-24\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center\",\n                children: /*#__PURE__*/_jsxDEV(\"h1\", {\n                  className: \"mb-1 text-3xl font-bold\",\n                  children: sub.title\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 119,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 118,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-sm font-bold text-gray-500\",\n                children: [\"/r/\", sub.name, \" . \", sub.subOfCommunity ? \"Sub community of \".concat(sub.subOfCommunity) : '']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 123,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 117,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"container flex pt-5\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-160\",\n          children: postsMarkup\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(SideBar, {\n          sub: sub\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 13\n        }, this), sub.subOfCommunity === null && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ml-6 w-80\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-white rounded\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-3 bg-blue-500 rounded-t\",\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"font-semibold text-white\",\n                children: \"Sub Communities\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 137,\n                columnNumber: 27\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 136,\n              columnNumber: 23\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-3\",\n              children: [sub.subCommunities.forEach(function (subCommunity) {\n                return (\n                  /*#__PURE__*/\n                  //console.log(subCommunity)\n                  _jsxDEV(\"p\", {\n                    className: \"mb-3 text-md\",\n                    children: subCommunity.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 144,\n                    columnNumber: 30\n                  }, _this)\n                );\n              }), authenticated && ownSub && /*#__PURE__*/_jsxDEV(Link, {\n                href: \"/r/\".concat(sub.name, \"/submit\"),\n                children: /*#__PURE__*/_jsxDEV(\"a\", {\n                  className: \"w-full py-1 text-sm blue button\",\n                  children: \"Create Sub community\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 150,\n                  columnNumber: 35\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 149,\n                columnNumber: 31\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 141,\n              columnNumber: 23\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 135,\n            columnNumber: 19\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 18\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 5\n  }, this);\n}\n\n_s(SubPage, \"+9KQL8LTttsWgsunloLM0Aw5aYc=\", false, function () {\n  return [useRouter, useAuthState, useSWR];\n});\n\n_c = SubPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"SubPage\");","map":{"version":3,"sources":["/home/bar007/Desktop/projects/tio/client/pages/r/[sub].tsx"],"names":["Head","useRouter","React","createRef","Fragment","useEffect","useState","useSWR","PostCard","SideBar","Image","useAuthState","classNames","Axios","Link","SubPage","ownSub","setOwnSub","router","authenticated","user","fileInputRef","subName","query","sub","data","error","revalidate","username","openFileInput","type","current","name","click","uploadImage","event","file","target","files","formData","FormData","append","post","headers","console","log","push","postsMarkup","posts","length","map","identifier","title","bannerUrl","backgroundImage","backgroundRepeat","backgroundSize","backgroundPosition","top","imageUrl","subOfCommunity","subCommunities","forEach","subCommunity"],"mappings":"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","sourcesContent":["import Head from 'next/head'\nimport { useRouter } from 'next/router'\nimport React, { ChangeEvent, createRef, Fragment, useEffect, useState } from 'react'\nimport useSWR from 'swr'\nimport PostCard from '../../components/PostCard'\nimport SideBar from '../../components/SideBar';\nimport { Sub } from '../../types';\nimport Image from 'next/image';\nimport { useAuthState } from '../../context/auth'\nimport classNames from 'classnames';\nimport Axios from 'axios'\nimport dayjs from 'dayjs'\nimport Link from 'next/link'\n\nexport default function SubPage() {\n  const [ownSub, setOwnSub] = useState(null);\n  const router = useRouter();\n  const { authenticated, user } = useAuthState();\n\n  const fileInputRef = createRef<HTMLInputElement>();\n\n  const subName = router.query.sub;\n\n  const { data: sub, error, revalidate } = useSWR<Sub>(subName ? `/subs/${subName}` : null)\n\n  //console.log(sub);\n\n  useEffect(() => {\n    if(!sub) {\n      return;\n    }\n    setOwnSub(authenticated && user.username === sub.username)\n  }, [sub]);\n\n  const openFileInput = (type: string) => {\n    if(!ownSub) {\n      return;\n    }\n    fileInputRef.current.name = type;\n    fileInputRef.current.click();\n  }\n\n  const uploadImage = async (event: ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files[0];\n    const formData = new FormData();\n    formData.append('file', file);\n    formData.append('type', fileInputRef.current.name);\n\n    try {\n      await Axios.post<Sub>(`/subs/${sub.name}/image`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n          }\n      });\n      revalidate();\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  if (error) router.push('/')\n\n  let postsMarkup\n  if (!sub) {\n    postsMarkup = <p className=\"text-lg text-center\">Loading..</p>\n  } else if (sub.posts.length === 0) {\n    postsMarkup = <p className=\"text-lg text-center\">No posts submitted yet</p>\n  } else {\n    postsMarkup = sub.posts.map((post) => (\n      <PostCard key={post.identifier} post={post} revalidate={revalidate} />\n    ))\n  }\n\n\n\n  return (\n    <div>\n      <Head>  \n        <title>{sub?.title}</title>\n      </Head>\n        {sub && (<Fragment>\n          <input type=\"file\" hidden={true} ref={fileInputRef} onChange={uploadImage}/>\n          <div>\n            <div className={classNames(\"bg-blue-500\", {\n              'cursor-pointer': ownSub\n            })}\n            onClick={() => openFileInput('banner')}\n            >\n              {sub.bannerUrl? (\n                <div className=\"h-56 bg-blue-500\" style={{\n                  backgroundImage: `url(${sub.bannerUrl})`,\n                  backgroundRepeat: 'no-repeat',\n                  backgroundSize: 'cover',\n                  backgroundPosition: 'center'\n                }}>\n\n                </div>\n              ): (\n                <div className=\"h-20 bg-blue-500\"></div>\n              )}\n            </div>\n            <div className=\"h-20 bg-white\">\n              <div className=\"container relative flex\">\n                <div className=\"absolute\" style={{top:-15}}>\n                  <Image \n                    src={sub.imageUrl}\n                    alt=\"sub image\"\n                    className={classNames(\"rounded-full\", {\n                      'cursor-pointer': ownSub\n                    })}\n                    width={70}\n                    height={70}\n                    onClick={() => openFileInput('image')}\n                    >\n                  </Image>\n                </div>\n                <div className=\"pt-1 pl-24\">\n                  <div className=\"flex items-center\">\n                    <h1 className=\"mb-1 text-3xl font-bold\">\n                      {sub.title}\n                    </h1>\n                  </div>\n                  <p className=\"text-sm font-bold text-gray-500\">\n                    /r/{sub.name} . {sub.subOfCommunity? `Sub community of ${sub.subOfCommunity}`: ''}\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div className=\"container flex pt-5\">\n            <div className=\"w-160\">{postsMarkup}</div>\n            <SideBar sub={sub} />\n            {sub.subOfCommunity===null && \n              <div className=\"ml-6 w-80\">\n                  <div className=\"bg-white rounded\">\n                      <div className=\"p-3 bg-blue-500 rounded-t\">\n                          <p className=\"font-semibold text-white\">\n                            Sub Communities\n                          </p>\n                      </div>\n                      <div className=\"p-3\">\n                          {sub.subCommunities.forEach(subCommunity => \n                            //console.log(subCommunity)\n                            (<p className=\"mb-3 text-md\">\n                              {subCommunity.name}\n                            </p>)\n                          )}\n                          {(authenticated && ownSub) && (\n                              <Link href={`/r/${sub.name}/submit`}>\n                                  <a className=\"w-full py-1 text-sm blue button\">\n                                      Create Sub community\n                                  </a>\n                              </Link>\n                          )}\n                      </div>\n                  </div>\n              </div>\n\n            }\n            \n          </div>\n        </Fragment>)}\n    </div>  \n  )\n}"]},"metadata":{},"sourceType":"module"}