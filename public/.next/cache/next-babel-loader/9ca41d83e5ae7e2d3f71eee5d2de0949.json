{"ast":null,"code":"import _assertThisInitialized from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _get from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/get\";\nimport _toConsumableArray from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport { IMarkerService, MarkerSeverity } from '../../../platform/markers/common/markers.js';\nimport { Disposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { OverviewRulerLane, MinimapPosition } from '../model.js';\nimport { themeColorFromId } from '../../../platform/theme/common/themeService.js';\nimport { overviewRulerWarning, overviewRulerInfo, overviewRulerError } from '../view/editorColorRegistry.js';\nimport { IModelService } from './modelService.js';\nimport { Range } from '../core/range.js';\nimport { Schemas } from '../../../base/common/network.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { minimapWarning, minimapError } from '../../../platform/theme/common/colorRegistry.js';\n\nfunction MODEL_ID(resource) {\n  return resource.toString();\n}\n\n_c = MODEL_ID;\n\nvar MarkerDecorations = /*#__PURE__*/function (_Disposable) {\n  _inherits(MarkerDecorations, _Disposable);\n\n  var _super = _createSuper(MarkerDecorations);\n\n  function MarkerDecorations(model) {\n    var _this;\n\n    _classCallCheck(this, MarkerDecorations);\n\n    _this = _super.call(this);\n    _this.model = model;\n    _this._markersData = new Map();\n\n    _this._register(toDisposable(function () {\n      _this.model.deltaDecorations(_toConsumableArray(_this._markersData.keys()), []);\n\n      _this._markersData.clear();\n    }));\n\n    return _this;\n  }\n\n  _createClass(MarkerDecorations, [{\n    key: \"update\",\n    value: function update(markers, newDecorations) {\n      var oldIds = _toConsumableArray(this._markersData.keys());\n\n      this._markersData.clear();\n\n      var ids = this.model.deltaDecorations(oldIds, newDecorations);\n\n      for (var index = 0; index < ids.length; index++) {\n        this._markersData.set(ids[index], markers[index]);\n      }\n\n      return oldIds.length !== 0 || ids.length !== 0;\n    }\n  }, {\n    key: \"getMarker\",\n    value: function getMarker(decoration) {\n      return this._markersData.get(decoration.id);\n    }\n  }]);\n\n  return MarkerDecorations;\n}(Disposable);\n\nvar MarkerDecorationsService = /*#__PURE__*/function (_Disposable2) {\n  _inherits(MarkerDecorationsService, _Disposable2);\n\n  var _super2 = _createSuper(MarkerDecorationsService);\n\n  function MarkerDecorationsService(modelService, _markerService) {\n    var _this2;\n\n    _classCallCheck(this, MarkerDecorationsService);\n\n    _this2 = _super2.call(this);\n    _this2._markerService = _markerService;\n    _this2._onDidChangeMarker = _this2._register(new Emitter());\n    _this2._markerDecorations = new Map();\n    modelService.getModels().forEach(function (model) {\n      return _this2._onModelAdded(model);\n    });\n\n    _this2._register(modelService.onModelAdded(_this2._onModelAdded, _assertThisInitialized(_this2)));\n\n    _this2._register(modelService.onModelRemoved(_this2._onModelRemoved, _assertThisInitialized(_this2)));\n\n    _this2._register(_this2._markerService.onMarkerChanged(_this2._handleMarkerChange, _assertThisInitialized(_this2)));\n\n    return _this2;\n  }\n\n  _createClass(MarkerDecorationsService, [{\n    key: \"dispose\",\n    value: function dispose() {\n      _get(_getPrototypeOf(MarkerDecorationsService.prototype), \"dispose\", this).call(this);\n\n      this._markerDecorations.forEach(function (value) {\n        return value.dispose();\n      });\n\n      this._markerDecorations.clear();\n    }\n  }, {\n    key: \"getMarker\",\n    value: function getMarker(uri, decoration) {\n      var markerDecorations = this._markerDecorations.get(MODEL_ID(uri));\n\n      return markerDecorations ? markerDecorations.getMarker(decoration) || null : null;\n    }\n  }, {\n    key: \"_handleMarkerChange\",\n    value: function _handleMarkerChange(changedResources) {\n      var _this3 = this;\n\n      changedResources.forEach(function (resource) {\n        var markerDecorations = _this3._markerDecorations.get(MODEL_ID(resource));\n\n        if (markerDecorations) {\n          _this3._updateDecorations(markerDecorations);\n        }\n      });\n    }\n  }, {\n    key: \"_onModelAdded\",\n    value: function _onModelAdded(model) {\n      var markerDecorations = new MarkerDecorations(model);\n\n      this._markerDecorations.set(MODEL_ID(model.uri), markerDecorations);\n\n      this._updateDecorations(markerDecorations);\n    }\n  }, {\n    key: \"_onModelRemoved\",\n    value: function _onModelRemoved(model) {\n      var _this4 = this;\n\n      var markerDecorations = this._markerDecorations.get(MODEL_ID(model.uri));\n\n      if (markerDecorations) {\n        markerDecorations.dispose();\n\n        this._markerDecorations[\"delete\"](MODEL_ID(model.uri));\n      } // clean up markers for internal, transient models\n\n\n      if (model.uri.scheme === Schemas.inMemory || model.uri.scheme === Schemas.internal || model.uri.scheme === Schemas.vscode) {\n        if (this._markerService) {\n          this._markerService.read({\n            resource: model.uri\n          }).map(function (marker) {\n            return marker.owner;\n          }).forEach(function (owner) {\n            return _this4._markerService.remove(owner, [model.uri]);\n          });\n        }\n      }\n    }\n  }, {\n    key: \"_updateDecorations\",\n    value: function _updateDecorations(markerDecorations) {\n      var _this5 = this;\n\n      // Limit to the first 500 errors/warnings\n      var markers = this._markerService.read({\n        resource: markerDecorations.model.uri,\n        take: 500\n      });\n\n      var newModelDecorations = markers.map(function (marker) {\n        return {\n          range: _this5._createDecorationRange(markerDecorations.model, marker),\n          options: _this5._createDecorationOption(marker)\n        };\n      });\n\n      if (markerDecorations.update(markers, newModelDecorations)) {\n        this._onDidChangeMarker.fire(markerDecorations.model);\n      }\n    }\n  }, {\n    key: \"_createDecorationRange\",\n    value: function _createDecorationRange(model, rawMarker) {\n      var ret = Range.lift(rawMarker);\n\n      if (rawMarker.severity === MarkerSeverity.Hint && !this._hasMarkerTag(rawMarker, 1\n      /* Unnecessary */\n      ) && !this._hasMarkerTag(rawMarker, 2\n      /* Deprecated */\n      )) {\n        // * never render hints on multiple lines\n        // * make enough space for three dots\n        ret = ret.setEndPosition(ret.startLineNumber, ret.startColumn + 2);\n      }\n\n      ret = model.validateRange(ret);\n\n      if (ret.isEmpty()) {\n        var word = model.getWordAtPosition(ret.getStartPosition());\n\n        if (word) {\n          ret = new Range(ret.startLineNumber, word.startColumn, ret.endLineNumber, word.endColumn);\n        } else {\n          var maxColumn = model.getLineLastNonWhitespaceColumn(ret.startLineNumber) || model.getLineMaxColumn(ret.startLineNumber);\n\n          if (maxColumn === 1) {// empty line\n            // console.warn('marker on empty line:', marker);\n          } else if (ret.endColumn >= maxColumn) {\n            // behind eol\n            ret = new Range(ret.startLineNumber, maxColumn - 1, ret.endLineNumber, maxColumn);\n          } else {\n            // extend marker to width = 1\n            ret = new Range(ret.startLineNumber, ret.startColumn, ret.endLineNumber, ret.endColumn + 1);\n          }\n        }\n      } else if (rawMarker.endColumn === Number.MAX_VALUE && rawMarker.startColumn === 1 && ret.startLineNumber === ret.endLineNumber) {\n        var minColumn = model.getLineFirstNonWhitespaceColumn(rawMarker.startLineNumber);\n\n        if (minColumn < ret.endColumn) {\n          ret = new Range(ret.startLineNumber, minColumn, ret.endLineNumber, ret.endColumn);\n          rawMarker.startColumn = minColumn;\n        }\n      }\n\n      return ret;\n    }\n  }, {\n    key: \"_createDecorationOption\",\n    value: function _createDecorationOption(marker) {\n      var className;\n      var color = undefined;\n      var zIndex;\n      var inlineClassName = undefined;\n      var minimap;\n\n      switch (marker.severity) {\n        case MarkerSeverity.Hint:\n          if (this._hasMarkerTag(marker, 2\n          /* Deprecated */\n          )) {\n            className = undefined;\n          } else if (this._hasMarkerTag(marker, 1\n          /* Unnecessary */\n          )) {\n            className = \"squiggly-unnecessary\"\n            /* EditorUnnecessaryDecoration */\n            ;\n          } else {\n            className = \"squiggly-hint\"\n            /* EditorHintDecoration */\n            ;\n          }\n\n          zIndex = 0;\n          break;\n\n        case MarkerSeverity.Warning:\n          className = \"squiggly-warning\"\n          /* EditorWarningDecoration */\n          ;\n          color = themeColorFromId(overviewRulerWarning);\n          zIndex = 20;\n          minimap = {\n            color: themeColorFromId(minimapWarning),\n            position: MinimapPosition.Inline\n          };\n          break;\n\n        case MarkerSeverity.Info:\n          className = \"squiggly-info\"\n          /* EditorInfoDecoration */\n          ;\n          color = themeColorFromId(overviewRulerInfo);\n          zIndex = 10;\n          break;\n\n        case MarkerSeverity.Error:\n        default:\n          className = \"squiggly-error\"\n          /* EditorErrorDecoration */\n          ;\n          color = themeColorFromId(overviewRulerError);\n          zIndex = 30;\n          minimap = {\n            color: themeColorFromId(minimapError),\n            position: MinimapPosition.Inline\n          };\n          break;\n      }\n\n      if (marker.tags) {\n        if (marker.tags.indexOf(1\n        /* Unnecessary */\n        ) !== -1) {\n          inlineClassName = \"squiggly-inline-unnecessary\"\n          /* EditorUnnecessaryInlineDecoration */\n          ;\n        }\n\n        if (marker.tags.indexOf(2\n        /* Deprecated */\n        ) !== -1) {\n          inlineClassName = \"squiggly-inline-deprecated\"\n          /* EditorDeprecatedInlineDecoration */\n          ;\n        }\n      }\n\n      return {\n        stickiness: 1\n        /* NeverGrowsWhenTypingAtEdges */\n        ,\n        className: className,\n        showIfCollapsed: true,\n        overviewRuler: {\n          color: color,\n          position: OverviewRulerLane.Right\n        },\n        minimap: minimap,\n        zIndex: zIndex,\n        inlineClassName: inlineClassName\n      };\n    }\n  }, {\n    key: \"_hasMarkerTag\",\n    value: function _hasMarkerTag(marker, tag) {\n      if (marker.tags) {\n        return marker.tags.indexOf(tag) >= 0;\n      }\n\n      return false;\n    }\n  }]);\n\n  return MarkerDecorationsService;\n}(Disposable);\n\nMarkerDecorationsService = __decorate([__param(0, IModelService), __param(1, IMarkerService)], MarkerDecorationsService);\nexport { MarkerDecorationsService };\n\nvar _c;\n\n$RefreshReg$(_c, \"MODEL_ID\");","map":{"version":3,"sources":["/home/bar007/Desktop/projects/tio/client/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorationsServiceImpl.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","IMarkerService","MarkerSeverity","Disposable","toDisposable","OverviewRulerLane","MinimapPosition","themeColorFromId","overviewRulerWarning","overviewRulerInfo","overviewRulerError","IModelService","Range","Schemas","Emitter","minimapWarning","minimapError","MODEL_ID","resource","toString","MarkerDecorations","model","_markersData","Map","_register","deltaDecorations","keys","clear","markers","newDecorations","oldIds","ids","index","set","decoration","get","id","MarkerDecorationsService","modelService","_markerService","_onDidChangeMarker","_markerDecorations","getModels","forEach","_onModelAdded","onModelAdded","onModelRemoved","_onModelRemoved","onMarkerChanged","_handleMarkerChange","value","dispose","uri","markerDecorations","getMarker","changedResources","_updateDecorations","scheme","inMemory","internal","vscode","read","map","marker","owner","remove","take","newModelDecorations","range","_createDecorationRange","options","_createDecorationOption","update","fire","rawMarker","ret","lift","severity","Hint","_hasMarkerTag","setEndPosition","startLineNumber","startColumn","validateRange","isEmpty","word","getWordAtPosition","getStartPosition","endLineNumber","endColumn","maxColumn","getLineLastNonWhitespaceColumn","getLineMaxColumn","Number","MAX_VALUE","minColumn","getLineFirstNonWhitespaceColumn","className","color","undefined","zIndex","inlineClassName","minimap","Warning","position","Inline","Info","Error","tags","indexOf","stickiness","showIfCollapsed","overviewRuler","Right","tag"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nimport { IMarkerService, MarkerSeverity } from '../../../platform/markers/common/markers.js';\r\nimport { Disposable, toDisposable } from '../../../base/common/lifecycle.js';\r\nimport { OverviewRulerLane, MinimapPosition } from '../model.js';\r\nimport { themeColorFromId } from '../../../platform/theme/common/themeService.js';\r\nimport { overviewRulerWarning, overviewRulerInfo, overviewRulerError } from '../view/editorColorRegistry.js';\r\nimport { IModelService } from './modelService.js';\r\nimport { Range } from '../core/range.js';\r\nimport { Schemas } from '../../../base/common/network.js';\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { minimapWarning, minimapError } from '../../../platform/theme/common/colorRegistry.js';\r\nfunction MODEL_ID(resource) {\r\n    return resource.toString();\r\n}\r\nclass MarkerDecorations extends Disposable {\r\n    constructor(model) {\r\n        super();\r\n        this.model = model;\r\n        this._markersData = new Map();\r\n        this._register(toDisposable(() => {\r\n            this.model.deltaDecorations([...this._markersData.keys()], []);\r\n            this._markersData.clear();\r\n        }));\r\n    }\r\n    update(markers, newDecorations) {\r\n        const oldIds = [...this._markersData.keys()];\r\n        this._markersData.clear();\r\n        const ids = this.model.deltaDecorations(oldIds, newDecorations);\r\n        for (let index = 0; index < ids.length; index++) {\r\n            this._markersData.set(ids[index], markers[index]);\r\n        }\r\n        return oldIds.length !== 0 || ids.length !== 0;\r\n    }\r\n    getMarker(decoration) {\r\n        return this._markersData.get(decoration.id);\r\n    }\r\n}\r\nlet MarkerDecorationsService = class MarkerDecorationsService extends Disposable {\r\n    constructor(modelService, _markerService) {\r\n        super();\r\n        this._markerService = _markerService;\r\n        this._onDidChangeMarker = this._register(new Emitter());\r\n        this._markerDecorations = new Map();\r\n        modelService.getModels().forEach(model => this._onModelAdded(model));\r\n        this._register(modelService.onModelAdded(this._onModelAdded, this));\r\n        this._register(modelService.onModelRemoved(this._onModelRemoved, this));\r\n        this._register(this._markerService.onMarkerChanged(this._handleMarkerChange, this));\r\n    }\r\n    dispose() {\r\n        super.dispose();\r\n        this._markerDecorations.forEach(value => value.dispose());\r\n        this._markerDecorations.clear();\r\n    }\r\n    getMarker(uri, decoration) {\r\n        const markerDecorations = this._markerDecorations.get(MODEL_ID(uri));\r\n        return markerDecorations ? (markerDecorations.getMarker(decoration) || null) : null;\r\n    }\r\n    _handleMarkerChange(changedResources) {\r\n        changedResources.forEach((resource) => {\r\n            const markerDecorations = this._markerDecorations.get(MODEL_ID(resource));\r\n            if (markerDecorations) {\r\n                this._updateDecorations(markerDecorations);\r\n            }\r\n        });\r\n    }\r\n    _onModelAdded(model) {\r\n        const markerDecorations = new MarkerDecorations(model);\r\n        this._markerDecorations.set(MODEL_ID(model.uri), markerDecorations);\r\n        this._updateDecorations(markerDecorations);\r\n    }\r\n    _onModelRemoved(model) {\r\n        const markerDecorations = this._markerDecorations.get(MODEL_ID(model.uri));\r\n        if (markerDecorations) {\r\n            markerDecorations.dispose();\r\n            this._markerDecorations.delete(MODEL_ID(model.uri));\r\n        }\r\n        // clean up markers for internal, transient models\r\n        if (model.uri.scheme === Schemas.inMemory\r\n            || model.uri.scheme === Schemas.internal\r\n            || model.uri.scheme === Schemas.vscode) {\r\n            if (this._markerService) {\r\n                this._markerService.read({ resource: model.uri }).map(marker => marker.owner).forEach(owner => this._markerService.remove(owner, [model.uri]));\r\n            }\r\n        }\r\n    }\r\n    _updateDecorations(markerDecorations) {\r\n        // Limit to the first 500 errors/warnings\r\n        const markers = this._markerService.read({ resource: markerDecorations.model.uri, take: 500 });\r\n        let newModelDecorations = markers.map((marker) => {\r\n            return {\r\n                range: this._createDecorationRange(markerDecorations.model, marker),\r\n                options: this._createDecorationOption(marker)\r\n            };\r\n        });\r\n        if (markerDecorations.update(markers, newModelDecorations)) {\r\n            this._onDidChangeMarker.fire(markerDecorations.model);\r\n        }\r\n    }\r\n    _createDecorationRange(model, rawMarker) {\r\n        let ret = Range.lift(rawMarker);\r\n        if (rawMarker.severity === MarkerSeverity.Hint && !this._hasMarkerTag(rawMarker, 1 /* Unnecessary */) && !this._hasMarkerTag(rawMarker, 2 /* Deprecated */)) {\r\n            // * never render hints on multiple lines\r\n            // * make enough space for three dots\r\n            ret = ret.setEndPosition(ret.startLineNumber, ret.startColumn + 2);\r\n        }\r\n        ret = model.validateRange(ret);\r\n        if (ret.isEmpty()) {\r\n            let word = model.getWordAtPosition(ret.getStartPosition());\r\n            if (word) {\r\n                ret = new Range(ret.startLineNumber, word.startColumn, ret.endLineNumber, word.endColumn);\r\n            }\r\n            else {\r\n                let maxColumn = model.getLineLastNonWhitespaceColumn(ret.startLineNumber) ||\r\n                    model.getLineMaxColumn(ret.startLineNumber);\r\n                if (maxColumn === 1) {\r\n                    // empty line\r\n                    // console.warn('marker on empty line:', marker);\r\n                }\r\n                else if (ret.endColumn >= maxColumn) {\r\n                    // behind eol\r\n                    ret = new Range(ret.startLineNumber, maxColumn - 1, ret.endLineNumber, maxColumn);\r\n                }\r\n                else {\r\n                    // extend marker to width = 1\r\n                    ret = new Range(ret.startLineNumber, ret.startColumn, ret.endLineNumber, ret.endColumn + 1);\r\n                }\r\n            }\r\n        }\r\n        else if (rawMarker.endColumn === Number.MAX_VALUE && rawMarker.startColumn === 1 && ret.startLineNumber === ret.endLineNumber) {\r\n            let minColumn = model.getLineFirstNonWhitespaceColumn(rawMarker.startLineNumber);\r\n            if (minColumn < ret.endColumn) {\r\n                ret = new Range(ret.startLineNumber, minColumn, ret.endLineNumber, ret.endColumn);\r\n                rawMarker.startColumn = minColumn;\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n    _createDecorationOption(marker) {\r\n        let className;\r\n        let color = undefined;\r\n        let zIndex;\r\n        let inlineClassName = undefined;\r\n        let minimap;\r\n        switch (marker.severity) {\r\n            case MarkerSeverity.Hint:\r\n                if (this._hasMarkerTag(marker, 2 /* Deprecated */)) {\r\n                    className = undefined;\r\n                }\r\n                else if (this._hasMarkerTag(marker, 1 /* Unnecessary */)) {\r\n                    className = \"squiggly-unnecessary\" /* EditorUnnecessaryDecoration */;\r\n                }\r\n                else {\r\n                    className = \"squiggly-hint\" /* EditorHintDecoration */;\r\n                }\r\n                zIndex = 0;\r\n                break;\r\n            case MarkerSeverity.Warning:\r\n                className = \"squiggly-warning\" /* EditorWarningDecoration */;\r\n                color = themeColorFromId(overviewRulerWarning);\r\n                zIndex = 20;\r\n                minimap = {\r\n                    color: themeColorFromId(minimapWarning),\r\n                    position: MinimapPosition.Inline\r\n                };\r\n                break;\r\n            case MarkerSeverity.Info:\r\n                className = \"squiggly-info\" /* EditorInfoDecoration */;\r\n                color = themeColorFromId(overviewRulerInfo);\r\n                zIndex = 10;\r\n                break;\r\n            case MarkerSeverity.Error:\r\n            default:\r\n                className = \"squiggly-error\" /* EditorErrorDecoration */;\r\n                color = themeColorFromId(overviewRulerError);\r\n                zIndex = 30;\r\n                minimap = {\r\n                    color: themeColorFromId(minimapError),\r\n                    position: MinimapPosition.Inline\r\n                };\r\n                break;\r\n        }\r\n        if (marker.tags) {\r\n            if (marker.tags.indexOf(1 /* Unnecessary */) !== -1) {\r\n                inlineClassName = \"squiggly-inline-unnecessary\" /* EditorUnnecessaryInlineDecoration */;\r\n            }\r\n            if (marker.tags.indexOf(2 /* Deprecated */) !== -1) {\r\n                inlineClassName = \"squiggly-inline-deprecated\" /* EditorDeprecatedInlineDecoration */;\r\n            }\r\n        }\r\n        return {\r\n            stickiness: 1 /* NeverGrowsWhenTypingAtEdges */,\r\n            className,\r\n            showIfCollapsed: true,\r\n            overviewRuler: {\r\n                color,\r\n                position: OverviewRulerLane.Right\r\n            },\r\n            minimap,\r\n            zIndex,\r\n            inlineClassName,\r\n        };\r\n    }\r\n    _hasMarkerTag(marker, tag) {\r\n        if (marker.tags) {\r\n            return marker.tags.indexOf(tag) >= 0;\r\n        }\r\n        return false;\r\n    }\r\n};\r\nMarkerDecorationsService = __decorate([\r\n    __param(0, IModelService),\r\n    __param(1, IMarkerService)\r\n], MarkerDecorationsService);\r\nexport { MarkerDecorationsService };\r\n"]},"metadata":{},"sourceType":"module"}