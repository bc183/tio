{"ast":null,"code":"import _classCallCheck from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nexport var ViewModelEventDispatcher = /*#__PURE__*/function (_Disposable) {\n  _inherits(ViewModelEventDispatcher, _Disposable);\n\n  var _super = _createSuper(ViewModelEventDispatcher);\n\n  function ViewModelEventDispatcher() {\n    var _this;\n\n    _classCallCheck(this, ViewModelEventDispatcher);\n\n    _this = _super.call(this);\n    _this._onEvent = _this._register(new Emitter());\n    _this.onEvent = _this._onEvent.event;\n    _this._eventHandlers = [];\n    _this._viewEventQueue = null;\n    _this._isConsumingViewEventQueue = false;\n    _this._collector = null;\n    _this._collectorCnt = 0;\n    _this._outgoingEvents = [];\n    return _this;\n  }\n\n  _createClass(ViewModelEventDispatcher, [{\n    key: \"emitOutgoingEvent\",\n    value: function emitOutgoingEvent(e) {\n      this._addOutgoingEvent(e);\n\n      this._emitOugoingEvents();\n    }\n  }, {\n    key: \"_addOutgoingEvent\",\n    value: function _addOutgoingEvent(e) {\n      for (var i = 0, len = this._outgoingEvents.length; i < len; i++) {\n        if (this._outgoingEvents[i].kind === e.kind) {\n          this._outgoingEvents[i] = this._outgoingEvents[i].merge(e);\n          return;\n        }\n      } // not merged\n\n\n      this._outgoingEvents.push(e);\n    }\n  }, {\n    key: \"_emitOugoingEvents\",\n    value: function _emitOugoingEvents() {\n      while (this._outgoingEvents.length > 0) {\n        if (this._collector || this._isConsumingViewEventQueue) {\n          // right now collecting or emitting view events, so let's postpone emitting\n          return;\n        }\n\n        var event = this._outgoingEvents.shift();\n\n        if (event.isNoOp()) {\n          continue;\n        }\n\n        this._onEvent.fire(event);\n      }\n    }\n  }, {\n    key: \"addViewEventHandler\",\n    value: function addViewEventHandler(eventHandler) {\n      for (var i = 0, len = this._eventHandlers.length; i < len; i++) {\n        if (this._eventHandlers[i] === eventHandler) {\n          console.warn('Detected duplicate listener in ViewEventDispatcher', eventHandler);\n        }\n      }\n\n      this._eventHandlers.push(eventHandler);\n    }\n  }, {\n    key: \"removeViewEventHandler\",\n    value: function removeViewEventHandler(eventHandler) {\n      for (var i = 0; i < this._eventHandlers.length; i++) {\n        if (this._eventHandlers[i] === eventHandler) {\n          this._eventHandlers.splice(i, 1);\n\n          break;\n        }\n      }\n    }\n  }, {\n    key: \"beginEmitViewEvents\",\n    value: function beginEmitViewEvents() {\n      this._collectorCnt++;\n\n      if (this._collectorCnt === 1) {\n        this._collector = new ViewModelEventsCollector();\n      }\n\n      return this._collector;\n    }\n  }, {\n    key: \"endEmitViewEvents\",\n    value: function endEmitViewEvents() {\n      this._collectorCnt--;\n\n      if (this._collectorCnt === 0) {\n        var outgoingEvents = this._collector.outgoingEvents;\n        var viewEvents = this._collector.viewEvents;\n        this._collector = null;\n\n        var _iterator = _createForOfIteratorHelper(outgoingEvents),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var outgoingEvent = _step.value;\n\n            this._addOutgoingEvent(outgoingEvent);\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n\n        if (viewEvents.length > 0) {\n          this._emitMany(viewEvents);\n        }\n      }\n\n      this._emitOugoingEvents();\n    }\n  }, {\n    key: \"emitSingleViewEvent\",\n    value: function emitSingleViewEvent(event) {\n      try {\n        var eventsCollector = this.beginEmitViewEvents();\n        eventsCollector.emitViewEvent(event);\n      } finally {\n        this.endEmitViewEvents();\n      }\n    }\n  }, {\n    key: \"_emitMany\",\n    value: function _emitMany(events) {\n      if (this._viewEventQueue) {\n        this._viewEventQueue = this._viewEventQueue.concat(events);\n      } else {\n        this._viewEventQueue = events;\n      }\n\n      if (!this._isConsumingViewEventQueue) {\n        this._consumeViewEventQueue();\n      }\n    }\n  }, {\n    key: \"_consumeViewEventQueue\",\n    value: function _consumeViewEventQueue() {\n      try {\n        this._isConsumingViewEventQueue = true;\n\n        this._doConsumeQueue();\n      } finally {\n        this._isConsumingViewEventQueue = false;\n      }\n    }\n  }, {\n    key: \"_doConsumeQueue\",\n    value: function _doConsumeQueue() {\n      while (this._viewEventQueue) {\n        // Empty event queue, as events might come in while sending these off\n        var events = this._viewEventQueue;\n        this._viewEventQueue = null; // Use a clone of the event handlers list, as they might remove themselves\n\n        var eventHandlers = this._eventHandlers.slice(0);\n\n        var _iterator2 = _createForOfIteratorHelper(eventHandlers),\n            _step2;\n\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var eventHandler = _step2.value;\n            eventHandler.handleEvents(events);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      }\n    }\n  }]);\n\n  return ViewModelEventDispatcher;\n}(Disposable);\nexport var ViewModelEventsCollector = /*#__PURE__*/function () {\n  function ViewModelEventsCollector() {\n    _classCallCheck(this, ViewModelEventsCollector);\n\n    this.viewEvents = [];\n    this.outgoingEvents = [];\n  }\n\n  _createClass(ViewModelEventsCollector, [{\n    key: \"emitViewEvent\",\n    value: function emitViewEvent(event) {\n      this.viewEvents.push(event);\n    }\n  }, {\n    key: \"emitOutgoingEvent\",\n    value: function emitOutgoingEvent(e) {\n      this.outgoingEvents.push(e);\n    }\n  }]);\n\n  return ViewModelEventsCollector;\n}();\nexport var ContentSizeChangedEvent = /*#__PURE__*/function () {\n  function ContentSizeChangedEvent(oldContentWidth, oldContentHeight, contentWidth, contentHeight) {\n    _classCallCheck(this, ContentSizeChangedEvent);\n\n    this.kind = 0\n    /* ContentSizeChanged */\n    ;\n    this._oldContentWidth = oldContentWidth;\n    this._oldContentHeight = oldContentHeight;\n    this.contentWidth = contentWidth;\n    this.contentHeight = contentHeight;\n    this.contentWidthChanged = this._oldContentWidth !== this.contentWidth;\n    this.contentHeightChanged = this._oldContentHeight !== this.contentHeight;\n  }\n\n  _createClass(ContentSizeChangedEvent, [{\n    key: \"isNoOp\",\n    value: function isNoOp() {\n      return !this.contentWidthChanged && !this.contentHeightChanged;\n    }\n  }, {\n    key: \"merge\",\n    value: function merge(other) {\n      if (other.kind !== 0\n      /* ContentSizeChanged */\n      ) {\n          return this;\n        }\n\n      return new ContentSizeChangedEvent(this._oldContentWidth, this._oldContentHeight, other.contentWidth, other.contentHeight);\n    }\n  }]);\n\n  return ContentSizeChangedEvent;\n}();\nexport var FocusChangedEvent = /*#__PURE__*/function () {\n  function FocusChangedEvent(oldHasFocus, hasFocus) {\n    _classCallCheck(this, FocusChangedEvent);\n\n    this.kind = 1\n    /* FocusChanged */\n    ;\n    this.oldHasFocus = oldHasFocus;\n    this.hasFocus = hasFocus;\n  }\n\n  _createClass(FocusChangedEvent, [{\n    key: \"isNoOp\",\n    value: function isNoOp() {\n      return this.oldHasFocus === this.hasFocus;\n    }\n  }, {\n    key: \"merge\",\n    value: function merge(other) {\n      if (other.kind !== 1\n      /* FocusChanged */\n      ) {\n          return this;\n        }\n\n      return new FocusChangedEvent(this.oldHasFocus, other.hasFocus);\n    }\n  }]);\n\n  return FocusChangedEvent;\n}();\nexport var ScrollChangedEvent = /*#__PURE__*/function () {\n  function ScrollChangedEvent(oldScrollWidth, oldScrollLeft, oldScrollHeight, oldScrollTop, scrollWidth, scrollLeft, scrollHeight, scrollTop) {\n    _classCallCheck(this, ScrollChangedEvent);\n\n    this.kind = 2\n    /* ScrollChanged */\n    ;\n    this._oldScrollWidth = oldScrollWidth;\n    this._oldScrollLeft = oldScrollLeft;\n    this._oldScrollHeight = oldScrollHeight;\n    this._oldScrollTop = oldScrollTop;\n    this.scrollWidth = scrollWidth;\n    this.scrollLeft = scrollLeft;\n    this.scrollHeight = scrollHeight;\n    this.scrollTop = scrollTop;\n    this.scrollWidthChanged = this._oldScrollWidth !== this.scrollWidth;\n    this.scrollLeftChanged = this._oldScrollLeft !== this.scrollLeft;\n    this.scrollHeightChanged = this._oldScrollHeight !== this.scrollHeight;\n    this.scrollTopChanged = this._oldScrollTop !== this.scrollTop;\n  }\n\n  _createClass(ScrollChangedEvent, [{\n    key: \"isNoOp\",\n    value: function isNoOp() {\n      return !this.scrollWidthChanged && !this.scrollLeftChanged && !this.scrollHeightChanged && !this.scrollTopChanged;\n    }\n  }, {\n    key: \"merge\",\n    value: function merge(other) {\n      if (other.kind !== 2\n      /* ScrollChanged */\n      ) {\n          return this;\n        }\n\n      return new ScrollChangedEvent(this._oldScrollWidth, this._oldScrollLeft, this._oldScrollHeight, this._oldScrollTop, other.scrollWidth, other.scrollLeft, other.scrollHeight, other.scrollTop);\n    }\n  }]);\n\n  return ScrollChangedEvent;\n}();\nexport var ViewZonesChangedEvent = /*#__PURE__*/function () {\n  function ViewZonesChangedEvent() {\n    _classCallCheck(this, ViewZonesChangedEvent);\n\n    this.kind = 3\n    /* ViewZonesChanged */\n    ;\n  }\n\n  _createClass(ViewZonesChangedEvent, [{\n    key: \"isNoOp\",\n    value: function isNoOp() {\n      return false;\n    }\n  }, {\n    key: \"merge\",\n    value: function merge(other) {\n      return this;\n    }\n  }]);\n\n  return ViewZonesChangedEvent;\n}();\nexport var CursorStateChangedEvent = /*#__PURE__*/function () {\n  function CursorStateChangedEvent(oldSelections, selections, oldModelVersionId, modelVersionId, source, reason, reachedMaxCursorCount) {\n    _classCallCheck(this, CursorStateChangedEvent);\n\n    this.kind = 5\n    /* CursorStateChanged */\n    ;\n    this.oldSelections = oldSelections;\n    this.selections = selections;\n    this.oldModelVersionId = oldModelVersionId;\n    this.modelVersionId = modelVersionId;\n    this.source = source;\n    this.reason = reason;\n    this.reachedMaxCursorCount = reachedMaxCursorCount;\n  }\n\n  _createClass(CursorStateChangedEvent, [{\n    key: \"isNoOp\",\n    value: function isNoOp() {\n      return CursorStateChangedEvent._selectionsAreEqual(this.oldSelections, this.selections) && this.oldModelVersionId === this.modelVersionId;\n    }\n  }, {\n    key: \"merge\",\n    value: function merge(other) {\n      if (other.kind !== 5\n      /* CursorStateChanged */\n      ) {\n          return this;\n        }\n\n      return new CursorStateChangedEvent(this.oldSelections, other.selections, this.oldModelVersionId, other.modelVersionId, other.source, other.reason, this.reachedMaxCursorCount || other.reachedMaxCursorCount);\n    }\n  }], [{\n    key: \"_selectionsAreEqual\",\n    value: function _selectionsAreEqual(a, b) {\n      if (!a && !b) {\n        return true;\n      }\n\n      if (!a || !b) {\n        return false;\n      }\n\n      var aLen = a.length;\n      var bLen = b.length;\n\n      if (aLen !== bLen) {\n        return false;\n      }\n\n      for (var i = 0; i < aLen; i++) {\n        if (!a[i].equalsSelection(b[i])) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n  }]);\n\n  return CursorStateChangedEvent;\n}();\nexport var ReadOnlyEditAttemptEvent = /*#__PURE__*/function () {\n  function ReadOnlyEditAttemptEvent() {\n    _classCallCheck(this, ReadOnlyEditAttemptEvent);\n\n    this.kind = 4\n    /* ReadOnlyEditAttempt */\n    ;\n  }\n\n  _createClass(ReadOnlyEditAttemptEvent, [{\n    key: \"isNoOp\",\n    value: function isNoOp() {\n      return false;\n    }\n  }, {\n    key: \"merge\",\n    value: function merge(other) {\n      return this;\n    }\n  }]);\n\n  return ReadOnlyEditAttemptEvent;\n}();","map":{"version":3,"sources":["/home/bar007/Desktop/projects/tio/client/node_modules/monaco-editor/esm/vs/editor/common/viewModel/viewModelEventDispatcher.js"],"names":["Emitter","Disposable","ViewModelEventDispatcher","_onEvent","_register","onEvent","event","_eventHandlers","_viewEventQueue","_isConsumingViewEventQueue","_collector","_collectorCnt","_outgoingEvents","e","_addOutgoingEvent","_emitOugoingEvents","i","len","length","kind","merge","push","shift","isNoOp","fire","eventHandler","console","warn","splice","ViewModelEventsCollector","outgoingEvents","viewEvents","outgoingEvent","_emitMany","eventsCollector","beginEmitViewEvents","emitViewEvent","endEmitViewEvents","events","concat","_consumeViewEventQueue","_doConsumeQueue","eventHandlers","slice","handleEvents","ContentSizeChangedEvent","oldContentWidth","oldContentHeight","contentWidth","contentHeight","_oldContentWidth","_oldContentHeight","contentWidthChanged","contentHeightChanged","other","FocusChangedEvent","oldHasFocus","hasFocus","ScrollChangedEvent","oldScrollWidth","oldScrollLeft","oldScrollHeight","oldScrollTop","scrollWidth","scrollLeft","scrollHeight","scrollTop","_oldScrollWidth","_oldScrollLeft","_oldScrollHeight","_oldScrollTop","scrollWidthChanged","scrollLeftChanged","scrollHeightChanged","scrollTopChanged","ViewZonesChangedEvent","CursorStateChangedEvent","oldSelections","selections","oldModelVersionId","modelVersionId","source","reason","reachedMaxCursorCount","_selectionsAreEqual","a","b","aLen","bLen","equalsSelection","ReadOnlyEditAttemptEvent"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport { Emitter } from '../../../base/common/event.js';\r\nimport { Disposable } from '../../../base/common/lifecycle.js';\r\nexport class ViewModelEventDispatcher extends Disposable {\r\n    constructor() {\r\n        super();\r\n        this._onEvent = this._register(new Emitter());\r\n        this.onEvent = this._onEvent.event;\r\n        this._eventHandlers = [];\r\n        this._viewEventQueue = null;\r\n        this._isConsumingViewEventQueue = false;\r\n        this._collector = null;\r\n        this._collectorCnt = 0;\r\n        this._outgoingEvents = [];\r\n    }\r\n    emitOutgoingEvent(e) {\r\n        this._addOutgoingEvent(e);\r\n        this._emitOugoingEvents();\r\n    }\r\n    _addOutgoingEvent(e) {\r\n        for (let i = 0, len = this._outgoingEvents.length; i < len; i++) {\r\n            if (this._outgoingEvents[i].kind === e.kind) {\r\n                this._outgoingEvents[i] = this._outgoingEvents[i].merge(e);\r\n                return;\r\n            }\r\n        }\r\n        // not merged\r\n        this._outgoingEvents.push(e);\r\n    }\r\n    _emitOugoingEvents() {\r\n        while (this._outgoingEvents.length > 0) {\r\n            if (this._collector || this._isConsumingViewEventQueue) {\r\n                // right now collecting or emitting view events, so let's postpone emitting\r\n                return;\r\n            }\r\n            const event = this._outgoingEvents.shift();\r\n            if (event.isNoOp()) {\r\n                continue;\r\n            }\r\n            this._onEvent.fire(event);\r\n        }\r\n    }\r\n    addViewEventHandler(eventHandler) {\r\n        for (let i = 0, len = this._eventHandlers.length; i < len; i++) {\r\n            if (this._eventHandlers[i] === eventHandler) {\r\n                console.warn('Detected duplicate listener in ViewEventDispatcher', eventHandler);\r\n            }\r\n        }\r\n        this._eventHandlers.push(eventHandler);\r\n    }\r\n    removeViewEventHandler(eventHandler) {\r\n        for (let i = 0; i < this._eventHandlers.length; i++) {\r\n            if (this._eventHandlers[i] === eventHandler) {\r\n                this._eventHandlers.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    beginEmitViewEvents() {\r\n        this._collectorCnt++;\r\n        if (this._collectorCnt === 1) {\r\n            this._collector = new ViewModelEventsCollector();\r\n        }\r\n        return this._collector;\r\n    }\r\n    endEmitViewEvents() {\r\n        this._collectorCnt--;\r\n        if (this._collectorCnt === 0) {\r\n            const outgoingEvents = this._collector.outgoingEvents;\r\n            const viewEvents = this._collector.viewEvents;\r\n            this._collector = null;\r\n            for (const outgoingEvent of outgoingEvents) {\r\n                this._addOutgoingEvent(outgoingEvent);\r\n            }\r\n            if (viewEvents.length > 0) {\r\n                this._emitMany(viewEvents);\r\n            }\r\n        }\r\n        this._emitOugoingEvents();\r\n    }\r\n    emitSingleViewEvent(event) {\r\n        try {\r\n            const eventsCollector = this.beginEmitViewEvents();\r\n            eventsCollector.emitViewEvent(event);\r\n        }\r\n        finally {\r\n            this.endEmitViewEvents();\r\n        }\r\n    }\r\n    _emitMany(events) {\r\n        if (this._viewEventQueue) {\r\n            this._viewEventQueue = this._viewEventQueue.concat(events);\r\n        }\r\n        else {\r\n            this._viewEventQueue = events;\r\n        }\r\n        if (!this._isConsumingViewEventQueue) {\r\n            this._consumeViewEventQueue();\r\n        }\r\n    }\r\n    _consumeViewEventQueue() {\r\n        try {\r\n            this._isConsumingViewEventQueue = true;\r\n            this._doConsumeQueue();\r\n        }\r\n        finally {\r\n            this._isConsumingViewEventQueue = false;\r\n        }\r\n    }\r\n    _doConsumeQueue() {\r\n        while (this._viewEventQueue) {\r\n            // Empty event queue, as events might come in while sending these off\r\n            const events = this._viewEventQueue;\r\n            this._viewEventQueue = null;\r\n            // Use a clone of the event handlers list, as they might remove themselves\r\n            const eventHandlers = this._eventHandlers.slice(0);\r\n            for (const eventHandler of eventHandlers) {\r\n                eventHandler.handleEvents(events);\r\n            }\r\n        }\r\n    }\r\n}\r\nexport class ViewModelEventsCollector {\r\n    constructor() {\r\n        this.viewEvents = [];\r\n        this.outgoingEvents = [];\r\n    }\r\n    emitViewEvent(event) {\r\n        this.viewEvents.push(event);\r\n    }\r\n    emitOutgoingEvent(e) {\r\n        this.outgoingEvents.push(e);\r\n    }\r\n}\r\nexport class ContentSizeChangedEvent {\r\n    constructor(oldContentWidth, oldContentHeight, contentWidth, contentHeight) {\r\n        this.kind = 0 /* ContentSizeChanged */;\r\n        this._oldContentWidth = oldContentWidth;\r\n        this._oldContentHeight = oldContentHeight;\r\n        this.contentWidth = contentWidth;\r\n        this.contentHeight = contentHeight;\r\n        this.contentWidthChanged = (this._oldContentWidth !== this.contentWidth);\r\n        this.contentHeightChanged = (this._oldContentHeight !== this.contentHeight);\r\n    }\r\n    isNoOp() {\r\n        return (!this.contentWidthChanged && !this.contentHeightChanged);\r\n    }\r\n    merge(other) {\r\n        if (other.kind !== 0 /* ContentSizeChanged */) {\r\n            return this;\r\n        }\r\n        return new ContentSizeChangedEvent(this._oldContentWidth, this._oldContentHeight, other.contentWidth, other.contentHeight);\r\n    }\r\n}\r\nexport class FocusChangedEvent {\r\n    constructor(oldHasFocus, hasFocus) {\r\n        this.kind = 1 /* FocusChanged */;\r\n        this.oldHasFocus = oldHasFocus;\r\n        this.hasFocus = hasFocus;\r\n    }\r\n    isNoOp() {\r\n        return (this.oldHasFocus === this.hasFocus);\r\n    }\r\n    merge(other) {\r\n        if (other.kind !== 1 /* FocusChanged */) {\r\n            return this;\r\n        }\r\n        return new FocusChangedEvent(this.oldHasFocus, other.hasFocus);\r\n    }\r\n}\r\nexport class ScrollChangedEvent {\r\n    constructor(oldScrollWidth, oldScrollLeft, oldScrollHeight, oldScrollTop, scrollWidth, scrollLeft, scrollHeight, scrollTop) {\r\n        this.kind = 2 /* ScrollChanged */;\r\n        this._oldScrollWidth = oldScrollWidth;\r\n        this._oldScrollLeft = oldScrollLeft;\r\n        this._oldScrollHeight = oldScrollHeight;\r\n        this._oldScrollTop = oldScrollTop;\r\n        this.scrollWidth = scrollWidth;\r\n        this.scrollLeft = scrollLeft;\r\n        this.scrollHeight = scrollHeight;\r\n        this.scrollTop = scrollTop;\r\n        this.scrollWidthChanged = (this._oldScrollWidth !== this.scrollWidth);\r\n        this.scrollLeftChanged = (this._oldScrollLeft !== this.scrollLeft);\r\n        this.scrollHeightChanged = (this._oldScrollHeight !== this.scrollHeight);\r\n        this.scrollTopChanged = (this._oldScrollTop !== this.scrollTop);\r\n    }\r\n    isNoOp() {\r\n        return (!this.scrollWidthChanged && !this.scrollLeftChanged && !this.scrollHeightChanged && !this.scrollTopChanged);\r\n    }\r\n    merge(other) {\r\n        if (other.kind !== 2 /* ScrollChanged */) {\r\n            return this;\r\n        }\r\n        return new ScrollChangedEvent(this._oldScrollWidth, this._oldScrollLeft, this._oldScrollHeight, this._oldScrollTop, other.scrollWidth, other.scrollLeft, other.scrollHeight, other.scrollTop);\r\n    }\r\n}\r\nexport class ViewZonesChangedEvent {\r\n    constructor() {\r\n        this.kind = 3 /* ViewZonesChanged */;\r\n    }\r\n    isNoOp() {\r\n        return false;\r\n    }\r\n    merge(other) {\r\n        return this;\r\n    }\r\n}\r\nexport class CursorStateChangedEvent {\r\n    constructor(oldSelections, selections, oldModelVersionId, modelVersionId, source, reason, reachedMaxCursorCount) {\r\n        this.kind = 5 /* CursorStateChanged */;\r\n        this.oldSelections = oldSelections;\r\n        this.selections = selections;\r\n        this.oldModelVersionId = oldModelVersionId;\r\n        this.modelVersionId = modelVersionId;\r\n        this.source = source;\r\n        this.reason = reason;\r\n        this.reachedMaxCursorCount = reachedMaxCursorCount;\r\n    }\r\n    static _selectionsAreEqual(a, b) {\r\n        if (!a && !b) {\r\n            return true;\r\n        }\r\n        if (!a || !b) {\r\n            return false;\r\n        }\r\n        const aLen = a.length;\r\n        const bLen = b.length;\r\n        if (aLen !== bLen) {\r\n            return false;\r\n        }\r\n        for (let i = 0; i < aLen; i++) {\r\n            if (!a[i].equalsSelection(b[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    isNoOp() {\r\n        return (CursorStateChangedEvent._selectionsAreEqual(this.oldSelections, this.selections)\r\n            && this.oldModelVersionId === this.modelVersionId);\r\n    }\r\n    merge(other) {\r\n        if (other.kind !== 5 /* CursorStateChanged */) {\r\n            return this;\r\n        }\r\n        return new CursorStateChangedEvent(this.oldSelections, other.selections, this.oldModelVersionId, other.modelVersionId, other.source, other.reason, this.reachedMaxCursorCount || other.reachedMaxCursorCount);\r\n    }\r\n}\r\nexport class ReadOnlyEditAttemptEvent {\r\n    constructor() {\r\n        this.kind = 4 /* ReadOnlyEditAttempt */;\r\n    }\r\n    isNoOp() {\r\n        return false;\r\n    }\r\n    merge(other) {\r\n        return this;\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}