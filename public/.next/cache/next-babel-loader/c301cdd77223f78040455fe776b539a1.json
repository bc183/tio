{"ast":null,"code":"import _slicedToArray from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { getOrDefault } from '../../../common/objects.js';\nimport { dispose as _dispose, Disposable, toDisposable, DisposableStore } from '../../../common/lifecycle.js';\nimport { Gesture, EventType as TouchEventType } from '../../touch.js';\nimport { Event, Emitter } from '../../../common/event.js';\nimport { domEvent } from '../../event.js';\nimport { SmoothScrollableElement } from '../scrollbar/scrollableElement.js';\nimport { Scrollable } from '../../../common/scrollable.js';\nimport { RangeMap, shift } from './rangeMap.js';\nimport { RowCache } from './rowCache.js';\nimport { memoize } from '../../../common/decorators.js';\nimport { Range } from '../../../common/range.js';\nimport { equals, distinct } from '../../../common/arrays.js';\nimport { DataTransfers, StaticDND } from '../../dnd.js';\nimport { disposableTimeout, Delayer } from '../../../common/async.js';\nimport { isFirefox } from '../../browser.js';\nimport { $, animate, getContentHeight, getContentWidth, getTopLeftOffset, scheduleAtNextAnimationFrame } from '../../dom.js';\nvar DefaultOptions = {\n  useShadows: true,\n  verticalScrollMode: 1\n  /* Auto */\n  ,\n  setRowLineHeight: true,\n  setRowHeight: true,\n  supportDynamicHeights: false,\n  dnd: {\n    getDragElements: function getDragElements(e) {\n      return [e];\n    },\n    getDragURI: function getDragURI() {\n      return null;\n    },\n    onDragStart: function onDragStart() {},\n    onDragOver: function onDragOver() {\n      return false;\n    },\n    drop: function drop() {}\n  },\n  horizontalScrolling: false,\n  transformOptimization: true\n};\nexport var ElementsDragAndDropData = /*#__PURE__*/function () {\n  function ElementsDragAndDropData(elements) {\n    _classCallCheck(this, ElementsDragAndDropData);\n\n    this.elements = elements;\n  }\n\n  _createClass(ElementsDragAndDropData, [{\n    key: \"update\",\n    value: function update() {}\n  }, {\n    key: \"getData\",\n    value: function getData() {\n      return this.elements;\n    }\n  }]);\n\n  return ElementsDragAndDropData;\n}();\nexport var ExternalElementsDragAndDropData = /*#__PURE__*/function () {\n  function ExternalElementsDragAndDropData(elements) {\n    _classCallCheck(this, ExternalElementsDragAndDropData);\n\n    this.elements = elements;\n  }\n\n  _createClass(ExternalElementsDragAndDropData, [{\n    key: \"update\",\n    value: function update() {}\n  }, {\n    key: \"getData\",\n    value: function getData() {\n      return this.elements;\n    }\n  }]);\n\n  return ExternalElementsDragAndDropData;\n}();\nexport var NativeDragAndDropData = /*#__PURE__*/function () {\n  function NativeDragAndDropData() {\n    _classCallCheck(this, NativeDragAndDropData);\n\n    this.types = [];\n    this.files = [];\n  }\n\n  _createClass(NativeDragAndDropData, [{\n    key: \"update\",\n    value: function update(dataTransfer) {\n      if (dataTransfer.types) {\n        var _this$types;\n\n        (_this$types = this.types).splice.apply(_this$types, [0, this.types.length].concat(_toConsumableArray(dataTransfer.types)));\n      }\n\n      if (dataTransfer.files) {\n        this.files.splice(0, this.files.length);\n\n        for (var i = 0; i < dataTransfer.files.length; i++) {\n          var file = dataTransfer.files.item(i);\n\n          if (file && (file.size || file.type)) {\n            this.files.push(file);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"getData\",\n    value: function getData() {\n      return {\n        types: this.types,\n        files: this.files\n      };\n    }\n  }]);\n\n  return NativeDragAndDropData;\n}();\n\nfunction equalsDragFeedback(f1, f2) {\n  if (Array.isArray(f1) && Array.isArray(f2)) {\n    return equals(f1, f2);\n  }\n\n  return f1 === f2;\n}\n\nvar ListViewAccessibilityProvider = function ListViewAccessibilityProvider(accessibilityProvider) {\n  _classCallCheck(this, ListViewAccessibilityProvider);\n\n  if (accessibilityProvider === null || accessibilityProvider === void 0 ? void 0 : accessibilityProvider.getSetSize) {\n    this.getSetSize = accessibilityProvider.getSetSize.bind(accessibilityProvider);\n  } else {\n    this.getSetSize = function (e, i, l) {\n      return l;\n    };\n  }\n\n  if (accessibilityProvider === null || accessibilityProvider === void 0 ? void 0 : accessibilityProvider.getPosInSet) {\n    this.getPosInSet = accessibilityProvider.getPosInSet.bind(accessibilityProvider);\n  } else {\n    this.getPosInSet = function (e, i) {\n      return i + 1;\n    };\n  }\n\n  if (accessibilityProvider === null || accessibilityProvider === void 0 ? void 0 : accessibilityProvider.getRole) {\n    this.getRole = accessibilityProvider.getRole.bind(accessibilityProvider);\n  } else {\n    this.getRole = function (_) {\n      return 'listitem';\n    };\n  }\n\n  if (accessibilityProvider === null || accessibilityProvider === void 0 ? void 0 : accessibilityProvider.isChecked) {\n    this.isChecked = accessibilityProvider.isChecked.bind(accessibilityProvider);\n  } else {\n    this.isChecked = function (_) {\n      return undefined;\n    };\n  }\n};\n\nexport var ListView = /*#__PURE__*/function () {\n  function ListView(container, virtualDelegate, renderers) {\n    var _this = this;\n\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : DefaultOptions;\n\n    _classCallCheck(this, ListView);\n\n    this.virtualDelegate = virtualDelegate;\n    this.domId = \"list_id_\".concat(++ListView.InstanceCount);\n    this.renderers = new Map();\n    this.renderWidth = 0;\n    this._scrollHeight = 0;\n    this.scrollableElementUpdateDisposable = null;\n    this.scrollableElementWidthDelayer = new Delayer(50);\n    this.splicing = false;\n    this.dragOverAnimationStopDisposable = Disposable.None;\n    this.dragOverMouseY = 0;\n    this.canDrop = false;\n    this.currentDragFeedbackDisposable = Disposable.None;\n    this.onDragLeaveTimeout = Disposable.None;\n    this.disposables = new DisposableStore();\n    this._onDidChangeContentHeight = new Emitter();\n    this._horizontalScrolling = false;\n\n    if (options.horizontalScrolling && options.supportDynamicHeights) {\n      throw new Error('Horizontal scrolling and dynamic heights not supported simultaneously');\n    }\n\n    this.items = [];\n    this.itemId = 0;\n    this.rangeMap = new RangeMap();\n\n    var _iterator = _createForOfIteratorHelper(renderers),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var renderer = _step.value;\n        this.renderers.set(renderer.templateId, renderer);\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    this.cache = this.disposables.add(new RowCache(this.renderers));\n    this.lastRenderTop = 0;\n    this.lastRenderHeight = 0;\n    this.domNode = document.createElement('div');\n    this.domNode.className = 'monaco-list';\n    this.domNode.classList.add(this.domId);\n    this.domNode.tabIndex = 0;\n    this.domNode.classList.toggle('mouse-support', typeof options.mouseSupport === 'boolean' ? options.mouseSupport : true);\n    this._horizontalScrolling = getOrDefault(options, function (o) {\n      return o.horizontalScrolling;\n    }, DefaultOptions.horizontalScrolling);\n    this.domNode.classList.toggle('horizontal-scrolling', this._horizontalScrolling);\n    this.additionalScrollHeight = typeof options.additionalScrollHeight === 'undefined' ? 0 : options.additionalScrollHeight;\n    this.accessibilityProvider = new ListViewAccessibilityProvider(options.accessibilityProvider);\n    this.rowsContainer = document.createElement('div');\n    this.rowsContainer.className = 'monaco-list-rows';\n    var transformOptimization = getOrDefault(options, function (o) {\n      return o.transformOptimization;\n    }, DefaultOptions.transformOptimization);\n\n    if (transformOptimization) {\n      this.rowsContainer.style.transform = 'translate3d(0px, 0px, 0px)';\n    }\n\n    this.disposables.add(Gesture.addTarget(this.rowsContainer));\n    this.scrollable = new Scrollable(getOrDefault(options, function (o) {\n      return o.smoothScrolling;\n    }, false) ? 125 : 0, function (cb) {\n      return scheduleAtNextAnimationFrame(cb);\n    });\n    this.scrollableElement = this.disposables.add(new SmoothScrollableElement(this.rowsContainer, {\n      horizontal: 1\n      /* Auto */\n      ,\n      vertical: getOrDefault(options, function (o) {\n        return o.verticalScrollMode;\n      }, DefaultOptions.verticalScrollMode),\n      useShadows: getOrDefault(options, function (o) {\n        return o.useShadows;\n      }, DefaultOptions.useShadows)\n    }, this.scrollable));\n    this.domNode.appendChild(this.scrollableElement.getDomNode());\n    container.appendChild(this.domNode);\n    this.scrollableElement.onScroll(this.onScroll, this, this.disposables);\n    domEvent(this.rowsContainer, TouchEventType.Change)(this.onTouchChange, this, this.disposables); // Prevent the monaco-scrollable-element from scrolling\n    // https://github.com/microsoft/vscode/issues/44181\n\n    domEvent(this.scrollableElement.getDomNode(), 'scroll')(function (e) {\n      return e.target.scrollTop = 0;\n    }, null, this.disposables);\n    Event.map(domEvent(this.domNode, 'dragover'), function (e) {\n      return _this.toDragEvent(e);\n    })(this.onDragOver, this, this.disposables);\n    Event.map(domEvent(this.domNode, 'drop'), function (e) {\n      return _this.toDragEvent(e);\n    })(this.onDrop, this, this.disposables);\n    domEvent(this.domNode, 'dragleave')(this.onDragLeave, this, this.disposables);\n    domEvent(window, 'dragend')(this.onDragEnd, this, this.disposables);\n    this.setRowLineHeight = getOrDefault(options, function (o) {\n      return o.setRowLineHeight;\n    }, DefaultOptions.setRowLineHeight);\n    this.setRowHeight = getOrDefault(options, function (o) {\n      return o.setRowHeight;\n    }, DefaultOptions.setRowHeight);\n    this.supportDynamicHeights = getOrDefault(options, function (o) {\n      return o.supportDynamicHeights;\n    }, DefaultOptions.supportDynamicHeights);\n    this.dnd = getOrDefault(options, function (o) {\n      return o.dnd;\n    }, DefaultOptions.dnd);\n    this.layout();\n  }\n\n  _createClass(ListView, [{\n    key: \"updateOptions\",\n    value: function updateOptions(options) {\n      if (options.additionalScrollHeight !== undefined) {\n        this.additionalScrollHeight = options.additionalScrollHeight;\n      }\n\n      if (options.smoothScrolling !== undefined) {\n        this.scrollable.setSmoothScrollDuration(options.smoothScrolling ? 125 : 0);\n      }\n\n      if (options.horizontalScrolling !== undefined) {\n        this.horizontalScrolling = options.horizontalScrolling;\n      }\n    }\n  }, {\n    key: \"splice\",\n    value: function splice(start, deleteCount) {\n      var elements = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n\n      if (this.splicing) {\n        throw new Error('Can\\'t run recursive splices.');\n      }\n\n      this.splicing = true;\n\n      try {\n        return this._splice(start, deleteCount, elements);\n      } finally {\n        this.splicing = false;\n\n        this._onDidChangeContentHeight.fire(this.contentHeight);\n      }\n    }\n  }, {\n    key: \"_splice\",\n    value: function _splice(start, deleteCount) {\n      var _this2 = this;\n\n      var elements = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n      var previousRenderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n      var deleteRange = {\n        start: start,\n        end: start + deleteCount\n      };\n      var removeRange = Range.intersect(previousRenderRange, deleteRange); // try to reuse rows, avoid removing them from DOM\n\n      var rowsToDispose = new Map();\n\n      for (var i = removeRange.start; i < removeRange.end; i++) {\n        var item = this.items[i];\n        item.dragStartDisposable.dispose();\n\n        if (item.row) {\n          var rows = rowsToDispose.get(item.templateId);\n\n          if (!rows) {\n            rows = [];\n            rowsToDispose.set(item.templateId, rows);\n          }\n\n          rows.push([item.row, item.element, i, item.size]);\n        }\n\n        item.row = null;\n      }\n\n      var previousRestRange = {\n        start: start + deleteCount,\n        end: this.items.length\n      };\n      var previousRenderedRestRange = Range.intersect(previousRestRange, previousRenderRange);\n      var previousUnrenderedRestRanges = Range.relativeComplement(previousRestRange, previousRenderRange);\n      var inserted = elements.map(function (element) {\n        return {\n          id: String(_this2.itemId++),\n          element: element,\n          templateId: _this2.virtualDelegate.getTemplateId(element),\n          size: _this2.virtualDelegate.getHeight(element),\n          width: undefined,\n          hasDynamicHeight: !!_this2.virtualDelegate.hasDynamicHeight && _this2.virtualDelegate.hasDynamicHeight(element),\n          lastDynamicHeightWidth: undefined,\n          row: null,\n          uri: undefined,\n          dropTarget: false,\n          dragStartDisposable: Disposable.None\n        };\n      });\n      var deleted; // TODO@joao: improve this optimization to catch even more cases\n\n      if (start === 0 && deleteCount >= this.items.length) {\n        this.rangeMap = new RangeMap();\n        this.rangeMap.splice(0, 0, inserted);\n        this.items = inserted;\n        deleted = [];\n      } else {\n        var _this$items;\n\n        this.rangeMap.splice(start, deleteCount, inserted);\n        deleted = (_this$items = this.items).splice.apply(_this$items, [start, deleteCount].concat(_toConsumableArray(inserted)));\n      }\n\n      var delta = elements.length - deleteCount;\n      var renderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n      var renderedRestRange = shift(previousRenderedRestRange, delta);\n      var updateRange = Range.intersect(renderRange, renderedRestRange);\n\n      for (var _i = updateRange.start; _i < updateRange.end; _i++) {\n        this.updateItemInDOM(this.items[_i], _i);\n      }\n\n      var removeRanges = Range.relativeComplement(renderedRestRange, renderRange);\n\n      var _iterator2 = _createForOfIteratorHelper(removeRanges),\n          _step2;\n\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var range = _step2.value;\n\n          for (var _i2 = range.start; _i2 < range.end; _i2++) {\n            this.removeItemFromDOM(_i2);\n          }\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n\n      var unrenderedRestRanges = previousUnrenderedRestRanges.map(function (r) {\n        return shift(r, delta);\n      });\n      var elementsRange = {\n        start: start,\n        end: start + elements.length\n      };\n      var insertRanges = [elementsRange].concat(_toConsumableArray(unrenderedRestRanges)).map(function (r) {\n        return Range.intersect(renderRange, r);\n      });\n      var beforeElement = this.getNextToLastElement(insertRanges);\n\n      var _iterator3 = _createForOfIteratorHelper(insertRanges),\n          _step3;\n\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var _range = _step3.value;\n\n          for (var _i3 = _range.start; _i3 < _range.end; _i3++) {\n            var _item = this.items[_i3];\n\n            var _rows = rowsToDispose.get(_item.templateId);\n\n            var rowData = _rows === null || _rows === void 0 ? void 0 : _rows.pop();\n\n            if (!rowData) {\n              this.insertItemInDOM(_i3, beforeElement);\n            } else {\n              var _rowData = _slicedToArray(rowData, 4),\n                  row = _rowData[0],\n                  element = _rowData[1],\n                  index = _rowData[2],\n                  size = _rowData[3];\n\n              var renderer = this.renderers.get(_item.templateId);\n\n              if (renderer && renderer.disposeElement) {\n                renderer.disposeElement(element, index, row.templateData, size);\n              }\n\n              this.insertItemInDOM(_i3, beforeElement, row);\n            }\n          }\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n\n      var _iterator4 = _createForOfIteratorHelper(rowsToDispose),\n          _step4;\n\n      try {\n        for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n          var _step4$value = _slicedToArray(_step4.value, 2),\n              templateId = _step4$value[0],\n              _rows2 = _step4$value[1];\n\n          var _iterator5 = _createForOfIteratorHelper(_rows2),\n              _step5;\n\n          try {\n            for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n              var _step5$value = _slicedToArray(_step5.value, 4),\n                  _row = _step5$value[0],\n                  _element = _step5$value[1],\n                  _index = _step5$value[2],\n                  _size = _step5$value[3];\n\n              var _renderer = this.renderers.get(templateId);\n\n              if (_renderer && _renderer.disposeElement) {\n                _renderer.disposeElement(_element, _index, _row.templateData, _size);\n              }\n\n              this.cache.release(_row);\n            }\n          } catch (err) {\n            _iterator5.e(err);\n          } finally {\n            _iterator5.f();\n          }\n        }\n      } catch (err) {\n        _iterator4.e(err);\n      } finally {\n        _iterator4.f();\n      }\n\n      this.eventuallyUpdateScrollDimensions();\n\n      if (this.supportDynamicHeights) {\n        this._rerender(this.scrollTop, this.renderHeight);\n      }\n\n      return deleted.map(function (i) {\n        return i.element;\n      });\n    }\n  }, {\n    key: \"eventuallyUpdateScrollDimensions\",\n    value: function eventuallyUpdateScrollDimensions() {\n      var _this3 = this;\n\n      this._scrollHeight = this.contentHeight;\n      this.rowsContainer.style.height = \"\".concat(this._scrollHeight, \"px\");\n\n      if (!this.scrollableElementUpdateDisposable) {\n        this.scrollableElementUpdateDisposable = scheduleAtNextAnimationFrame(function () {\n          _this3.scrollableElement.setScrollDimensions({\n            scrollHeight: _this3.scrollHeight\n          });\n\n          _this3.updateScrollWidth();\n\n          _this3.scrollableElementUpdateDisposable = null;\n        });\n      }\n    }\n  }, {\n    key: \"eventuallyUpdateScrollWidth\",\n    value: function eventuallyUpdateScrollWidth() {\n      var _this4 = this;\n\n      if (!this.horizontalScrolling) {\n        this.scrollableElementWidthDelayer.cancel();\n        return;\n      }\n\n      this.scrollableElementWidthDelayer.trigger(function () {\n        return _this4.updateScrollWidth();\n      });\n    }\n  }, {\n    key: \"updateScrollWidth\",\n    value: function updateScrollWidth() {\n      if (!this.horizontalScrolling) {\n        return;\n      }\n\n      var scrollWidth = 0;\n\n      var _iterator6 = _createForOfIteratorHelper(this.items),\n          _step6;\n\n      try {\n        for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n          var item = _step6.value;\n\n          if (typeof item.width !== 'undefined') {\n            scrollWidth = Math.max(scrollWidth, item.width);\n          }\n        }\n      } catch (err) {\n        _iterator6.e(err);\n      } finally {\n        _iterator6.f();\n      }\n\n      this.scrollWidth = scrollWidth;\n      this.scrollableElement.setScrollDimensions({\n        scrollWidth: scrollWidth === 0 ? 0 : scrollWidth + 10\n      });\n    }\n  }, {\n    key: \"rerender\",\n    value: function rerender() {\n      if (!this.supportDynamicHeights) {\n        return;\n      }\n\n      var _iterator7 = _createForOfIteratorHelper(this.items),\n          _step7;\n\n      try {\n        for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {\n          var item = _step7.value;\n          item.lastDynamicHeightWidth = undefined;\n        }\n      } catch (err) {\n        _iterator7.e(err);\n      } finally {\n        _iterator7.f();\n      }\n\n      this._rerender(this.lastRenderTop, this.lastRenderHeight);\n    }\n  }, {\n    key: \"element\",\n    value: function element(index) {\n      return this.items[index].element;\n    }\n  }, {\n    key: \"domElement\",\n    value: function domElement(index) {\n      var row = this.items[index].row;\n      return row && row.domNode;\n    }\n  }, {\n    key: \"elementHeight\",\n    value: function elementHeight(index) {\n      return this.items[index].size;\n    }\n  }, {\n    key: \"elementTop\",\n    value: function elementTop(index) {\n      return this.rangeMap.positionAt(index);\n    }\n  }, {\n    key: \"indexAt\",\n    value: function indexAt(position) {\n      return this.rangeMap.indexAt(position);\n    }\n  }, {\n    key: \"indexAfter\",\n    value: function indexAfter(position) {\n      return this.rangeMap.indexAfter(position);\n    }\n  }, {\n    key: \"layout\",\n    value: function layout(height, width) {\n      var scrollDimensions = {\n        height: typeof height === 'number' ? height : getContentHeight(this.domNode)\n      };\n\n      if (this.scrollableElementUpdateDisposable) {\n        this.scrollableElementUpdateDisposable.dispose();\n        this.scrollableElementUpdateDisposable = null;\n        scrollDimensions.scrollHeight = this.scrollHeight;\n      }\n\n      this.scrollableElement.setScrollDimensions(scrollDimensions);\n\n      if (typeof width !== 'undefined') {\n        this.renderWidth = width;\n\n        if (this.supportDynamicHeights) {\n          this._rerender(this.scrollTop, this.renderHeight);\n        }\n\n        if (this.horizontalScrolling) {\n          this.scrollableElement.setScrollDimensions({\n            width: typeof width === 'number' ? width : getContentWidth(this.domNode)\n          });\n        }\n      }\n    } // Render\n\n  }, {\n    key: \"render\",\n    value: function render(previousRenderRange, renderTop, renderHeight, renderLeft, scrollWidth) {\n      var updateItemsInDOM = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;\n      var renderRange = this.getRenderRange(renderTop, renderHeight);\n      var rangesToInsert = Range.relativeComplement(renderRange, previousRenderRange);\n      var rangesToRemove = Range.relativeComplement(previousRenderRange, renderRange);\n      var beforeElement = this.getNextToLastElement(rangesToInsert);\n\n      if (updateItemsInDOM) {\n        var rangesToUpdate = Range.intersect(previousRenderRange, renderRange);\n\n        for (var i = rangesToUpdate.start; i < rangesToUpdate.end; i++) {\n          this.updateItemInDOM(this.items[i], i);\n        }\n      }\n\n      var _iterator8 = _createForOfIteratorHelper(rangesToInsert),\n          _step8;\n\n      try {\n        for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {\n          var range = _step8.value;\n\n          for (var _i4 = range.start; _i4 < range.end; _i4++) {\n            this.insertItemInDOM(_i4, beforeElement);\n          }\n        }\n      } catch (err) {\n        _iterator8.e(err);\n      } finally {\n        _iterator8.f();\n      }\n\n      var _iterator9 = _createForOfIteratorHelper(rangesToRemove),\n          _step9;\n\n      try {\n        for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {\n          var _range2 = _step9.value;\n\n          for (var _i5 = _range2.start; _i5 < _range2.end; _i5++) {\n            this.removeItemFromDOM(_i5);\n          }\n        }\n      } catch (err) {\n        _iterator9.e(err);\n      } finally {\n        _iterator9.f();\n      }\n\n      if (renderLeft !== undefined) {\n        this.rowsContainer.style.left = \"-\".concat(renderLeft, \"px\");\n      }\n\n      this.rowsContainer.style.top = \"-\".concat(renderTop, \"px\");\n\n      if (this.horizontalScrolling && scrollWidth !== undefined) {\n        this.rowsContainer.style.width = \"\".concat(Math.max(scrollWidth, this.renderWidth), \"px\");\n      }\n\n      this.lastRenderTop = renderTop;\n      this.lastRenderHeight = renderHeight;\n    } // DOM operations\n\n  }, {\n    key: \"insertItemInDOM\",\n    value: function insertItemInDOM(index, beforeElement, row) {\n      var _this5 = this;\n\n      var item = this.items[index];\n\n      if (!item.row) {\n        item.row = row !== null && row !== void 0 ? row : this.cache.alloc(item.templateId);\n      }\n\n      var role = this.accessibilityProvider.getRole(item.element) || 'listitem';\n      item.row.domNode.setAttribute('role', role);\n      var checked = this.accessibilityProvider.isChecked(item.element);\n\n      if (typeof checked !== 'undefined') {\n        item.row.domNode.setAttribute('aria-checked', String(!!checked));\n      }\n\n      if (!item.row.domNode.parentElement) {\n        if (beforeElement) {\n          this.rowsContainer.insertBefore(item.row.domNode, beforeElement);\n        } else {\n          this.rowsContainer.appendChild(item.row.domNode);\n        }\n      }\n\n      this.updateItemInDOM(item, index);\n      var renderer = this.renderers.get(item.templateId);\n\n      if (!renderer) {\n        throw new Error(\"No renderer found for template id \".concat(item.templateId));\n      }\n\n      if (renderer) {\n        renderer.renderElement(item.element, index, item.row.templateData, item.size);\n      }\n\n      var uri = this.dnd.getDragURI(item.element);\n      item.dragStartDisposable.dispose();\n      item.row.domNode.draggable = !!uri;\n\n      if (uri) {\n        var onDragStart = domEvent(item.row.domNode, 'dragstart');\n        item.dragStartDisposable = onDragStart(function (event) {\n          return _this5.onDragStart(item.element, uri, event);\n        });\n      }\n\n      if (this.horizontalScrolling) {\n        this.measureItemWidth(item);\n        this.eventuallyUpdateScrollWidth();\n      }\n    }\n  }, {\n    key: \"measureItemWidth\",\n    value: function measureItemWidth(item) {\n      if (!item.row || !item.row.domNode) {\n        return;\n      }\n\n      item.row.domNode.style.width = isFirefox ? '-moz-fit-content' : 'fit-content';\n      item.width = getContentWidth(item.row.domNode);\n      var style = window.getComputedStyle(item.row.domNode);\n\n      if (style.paddingLeft) {\n        item.width += parseFloat(style.paddingLeft);\n      }\n\n      if (style.paddingRight) {\n        item.width += parseFloat(style.paddingRight);\n      }\n\n      item.row.domNode.style.width = '';\n    }\n  }, {\n    key: \"updateItemInDOM\",\n    value: function updateItemInDOM(item, index) {\n      item.row.domNode.style.top = \"\".concat(this.elementTop(index), \"px\");\n\n      if (this.setRowHeight) {\n        item.row.domNode.style.height = \"\".concat(item.size, \"px\");\n      }\n\n      if (this.setRowLineHeight) {\n        item.row.domNode.style.lineHeight = \"\".concat(item.size, \"px\");\n      }\n\n      item.row.domNode.setAttribute('data-index', \"\".concat(index));\n      item.row.domNode.setAttribute('data-last-element', index === this.length - 1 ? 'true' : 'false');\n      item.row.domNode.setAttribute('aria-setsize', String(this.accessibilityProvider.getSetSize(item.element, index, this.length)));\n      item.row.domNode.setAttribute('aria-posinset', String(this.accessibilityProvider.getPosInSet(item.element, index)));\n      item.row.domNode.setAttribute('id', this.getElementDomId(index));\n      item.row.domNode.classList.toggle('drop-target', item.dropTarget);\n    }\n  }, {\n    key: \"removeItemFromDOM\",\n    value: function removeItemFromDOM(index) {\n      var item = this.items[index];\n      item.dragStartDisposable.dispose();\n\n      if (item.row) {\n        var renderer = this.renderers.get(item.templateId);\n\n        if (renderer && renderer.disposeElement) {\n          renderer.disposeElement(item.element, index, item.row.templateData, item.size);\n        }\n\n        this.cache.release(item.row);\n        item.row = null;\n      }\n\n      if (this.horizontalScrolling) {\n        this.eventuallyUpdateScrollWidth();\n      }\n    }\n  }, {\n    key: \"getScrollTop\",\n    value: function getScrollTop() {\n      var scrollPosition = this.scrollableElement.getScrollPosition();\n      return scrollPosition.scrollTop;\n    }\n  }, {\n    key: \"setScrollTop\",\n    value: function setScrollTop(scrollTop, reuseAnimation) {\n      if (this.scrollableElementUpdateDisposable) {\n        this.scrollableElementUpdateDisposable.dispose();\n        this.scrollableElementUpdateDisposable = null;\n        this.scrollableElement.setScrollDimensions({\n          scrollHeight: this.scrollHeight\n        });\n      }\n\n      this.scrollableElement.setScrollPosition({\n        scrollTop: scrollTop,\n        reuseAnimation: reuseAnimation\n      });\n    }\n  }, {\n    key: \"toMouseEvent\",\n    value: function toMouseEvent(browserEvent) {\n      var index = this.getItemIndexFromEventTarget(browserEvent.target || null);\n      var item = typeof index === 'undefined' ? undefined : this.items[index];\n      var element = item && item.element;\n      return {\n        browserEvent: browserEvent,\n        index: index,\n        element: element\n      };\n    }\n  }, {\n    key: \"toTouchEvent\",\n    value: function toTouchEvent(browserEvent) {\n      var index = this.getItemIndexFromEventTarget(browserEvent.target || null);\n      var item = typeof index === 'undefined' ? undefined : this.items[index];\n      var element = item && item.element;\n      return {\n        browserEvent: browserEvent,\n        index: index,\n        element: element\n      };\n    }\n  }, {\n    key: \"toGestureEvent\",\n    value: function toGestureEvent(browserEvent) {\n      var index = this.getItemIndexFromEventTarget(browserEvent.initialTarget || null);\n      var item = typeof index === 'undefined' ? undefined : this.items[index];\n      var element = item && item.element;\n      return {\n        browserEvent: browserEvent,\n        index: index,\n        element: element\n      };\n    }\n  }, {\n    key: \"toDragEvent\",\n    value: function toDragEvent(browserEvent) {\n      var index = this.getItemIndexFromEventTarget(browserEvent.target || null);\n      var item = typeof index === 'undefined' ? undefined : this.items[index];\n      var element = item && item.element;\n      return {\n        browserEvent: browserEvent,\n        index: index,\n        element: element\n      };\n    }\n  }, {\n    key: \"onScroll\",\n    value: function onScroll(e) {\n      try {\n        var previousRenderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n        this.render(previousRenderRange, e.scrollTop, e.height, e.scrollLeft, e.scrollWidth);\n\n        if (this.supportDynamicHeights) {\n          this._rerender(e.scrollTop, e.height, e.inSmoothScrolling);\n        }\n      } catch (err) {\n        console.error('Got bad scroll event:', e);\n        throw err;\n      }\n    }\n  }, {\n    key: \"onTouchChange\",\n    value: function onTouchChange(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      this.scrollTop -= event.translationY;\n    } // DND\n\n  }, {\n    key: \"onDragStart\",\n    value: function onDragStart(element, uri, event) {\n      if (!event.dataTransfer) {\n        return;\n      }\n\n      var elements = this.dnd.getDragElements(element);\n      event.dataTransfer.effectAllowed = 'copyMove';\n      event.dataTransfer.setData(DataTransfers.RESOURCES, JSON.stringify([uri]));\n\n      if (event.dataTransfer.setDragImage) {\n        var label;\n\n        if (this.dnd.getDragLabel) {\n          label = this.dnd.getDragLabel(elements, event);\n        }\n\n        if (typeof label === 'undefined') {\n          label = String(elements.length);\n        }\n\n        var dragImage = $('.monaco-drag-image');\n        dragImage.textContent = label;\n        document.body.appendChild(dragImage);\n        event.dataTransfer.setDragImage(dragImage, -10, -10);\n        setTimeout(function () {\n          return document.body.removeChild(dragImage);\n        }, 0);\n      }\n\n      this.currentDragData = new ElementsDragAndDropData(elements);\n      StaticDND.CurrentDragAndDropData = new ExternalElementsDragAndDropData(elements);\n\n      if (this.dnd.onDragStart) {\n        this.dnd.onDragStart(this.currentDragData, event);\n      }\n    }\n  }, {\n    key: \"onDragOver\",\n    value: function onDragOver(event) {\n      var _this6 = this;\n\n      event.browserEvent.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\n\n      this.onDragLeaveTimeout.dispose();\n\n      if (StaticDND.CurrentDragAndDropData && StaticDND.CurrentDragAndDropData.getData() === 'vscode-ui') {\n        return false;\n      }\n\n      this.setupDragAndDropScrollTopAnimation(event.browserEvent);\n\n      if (!event.browserEvent.dataTransfer) {\n        return false;\n      } // Drag over from outside\n\n\n      if (!this.currentDragData) {\n        if (StaticDND.CurrentDragAndDropData) {\n          // Drag over from another list\n          this.currentDragData = StaticDND.CurrentDragAndDropData;\n        } else {\n          // Drag over from the desktop\n          if (!event.browserEvent.dataTransfer.types) {\n            return false;\n          }\n\n          this.currentDragData = new NativeDragAndDropData();\n        }\n      }\n\n      var result = this.dnd.onDragOver(this.currentDragData, event.element, event.index, event.browserEvent);\n      this.canDrop = typeof result === 'boolean' ? result : result.accept;\n\n      if (!this.canDrop) {\n        this.currentDragFeedback = undefined;\n        this.currentDragFeedbackDisposable.dispose();\n        return false;\n      }\n\n      event.browserEvent.dataTransfer.dropEffect = typeof result !== 'boolean' && result.effect === 0\n      /* Copy */\n      ? 'copy' : 'move';\n      var feedback;\n\n      if (typeof result !== 'boolean' && result.feedback) {\n        feedback = result.feedback;\n      } else {\n        if (typeof event.index === 'undefined') {\n          feedback = [-1];\n        } else {\n          feedback = [event.index];\n        }\n      } // sanitize feedback list\n\n\n      feedback = distinct(feedback).filter(function (i) {\n        return i >= -1 && i < _this6.length;\n      }).sort(function (a, b) {\n        return a - b;\n      });\n      feedback = feedback[0] === -1 ? [-1] : feedback;\n\n      if (equalsDragFeedback(this.currentDragFeedback, feedback)) {\n        return true;\n      }\n\n      this.currentDragFeedback = feedback;\n      this.currentDragFeedbackDisposable.dispose();\n\n      if (feedback[0] === -1) {\n        // entire list feedback\n        this.domNode.classList.add('drop-target');\n        this.rowsContainer.classList.add('drop-target');\n        this.currentDragFeedbackDisposable = toDisposable(function () {\n          _this6.domNode.classList.remove('drop-target');\n\n          _this6.rowsContainer.classList.remove('drop-target');\n        });\n      } else {\n        var _iterator10 = _createForOfIteratorHelper(feedback),\n            _step10;\n\n        try {\n          for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {\n            var index = _step10.value;\n            var item = this.items[index];\n            item.dropTarget = true;\n\n            if (item.row) {\n              item.row.domNode.classList.add('drop-target');\n            }\n          }\n        } catch (err) {\n          _iterator10.e(err);\n        } finally {\n          _iterator10.f();\n        }\n\n        this.currentDragFeedbackDisposable = toDisposable(function () {\n          var _iterator11 = _createForOfIteratorHelper(feedback),\n              _step11;\n\n          try {\n            for (_iterator11.s(); !(_step11 = _iterator11.n()).done;) {\n              var index = _step11.value;\n              var item = _this6.items[index];\n              item.dropTarget = false;\n\n              if (item.row) {\n                item.row.domNode.classList.remove('drop-target');\n              }\n            }\n          } catch (err) {\n            _iterator11.e(err);\n          } finally {\n            _iterator11.f();\n          }\n        });\n      }\n\n      return true;\n    }\n  }, {\n    key: \"onDragLeave\",\n    value: function onDragLeave() {\n      var _this7 = this;\n\n      this.onDragLeaveTimeout.dispose();\n      this.onDragLeaveTimeout = disposableTimeout(function () {\n        return _this7.clearDragOverFeedback();\n      }, 100);\n    }\n  }, {\n    key: \"onDrop\",\n    value: function onDrop(event) {\n      if (!this.canDrop) {\n        return;\n      }\n\n      var dragData = this.currentDragData;\n      this.teardownDragAndDropScrollTopAnimation();\n      this.clearDragOverFeedback();\n      this.currentDragData = undefined;\n      StaticDND.CurrentDragAndDropData = undefined;\n\n      if (!dragData || !event.browserEvent.dataTransfer) {\n        return;\n      }\n\n      event.browserEvent.preventDefault();\n      dragData.update(event.browserEvent.dataTransfer);\n      this.dnd.drop(dragData, event.element, event.index, event.browserEvent);\n    }\n  }, {\n    key: \"onDragEnd\",\n    value: function onDragEnd(event) {\n      this.canDrop = false;\n      this.teardownDragAndDropScrollTopAnimation();\n      this.clearDragOverFeedback();\n      this.currentDragData = undefined;\n      StaticDND.CurrentDragAndDropData = undefined;\n\n      if (this.dnd.onDragEnd) {\n        this.dnd.onDragEnd(event);\n      }\n    }\n  }, {\n    key: \"clearDragOverFeedback\",\n    value: function clearDragOverFeedback() {\n      this.currentDragFeedback = undefined;\n      this.currentDragFeedbackDisposable.dispose();\n      this.currentDragFeedbackDisposable = Disposable.None;\n    } // DND scroll top animation\n\n  }, {\n    key: \"setupDragAndDropScrollTopAnimation\",\n    value: function setupDragAndDropScrollTopAnimation(event) {\n      var _this8 = this;\n\n      if (!this.dragOverAnimationDisposable) {\n        var viewTop = getTopLeftOffset(this.domNode).top;\n        this.dragOverAnimationDisposable = animate(this.animateDragAndDropScrollTop.bind(this, viewTop));\n      }\n\n      this.dragOverAnimationStopDisposable.dispose();\n      this.dragOverAnimationStopDisposable = disposableTimeout(function () {\n        if (_this8.dragOverAnimationDisposable) {\n          _this8.dragOverAnimationDisposable.dispose();\n\n          _this8.dragOverAnimationDisposable = undefined;\n        }\n      }, 1000);\n      this.dragOverMouseY = event.pageY;\n    }\n  }, {\n    key: \"animateDragAndDropScrollTop\",\n    value: function animateDragAndDropScrollTop(viewTop) {\n      if (this.dragOverMouseY === undefined) {\n        return;\n      }\n\n      var diff = this.dragOverMouseY - viewTop;\n      var upperLimit = this.renderHeight - 35;\n\n      if (diff < 35) {\n        this.scrollTop += Math.max(-14, Math.floor(0.3 * (diff - 35)));\n      } else if (diff > upperLimit) {\n        this.scrollTop += Math.min(14, Math.floor(0.3 * (diff - upperLimit)));\n      }\n    }\n  }, {\n    key: \"teardownDragAndDropScrollTopAnimation\",\n    value: function teardownDragAndDropScrollTopAnimation() {\n      this.dragOverAnimationStopDisposable.dispose();\n\n      if (this.dragOverAnimationDisposable) {\n        this.dragOverAnimationDisposable.dispose();\n        this.dragOverAnimationDisposable = undefined;\n      }\n    } // Util\n\n  }, {\n    key: \"getItemIndexFromEventTarget\",\n    value: function getItemIndexFromEventTarget(target) {\n      var scrollableElement = this.scrollableElement.getDomNode();\n      var element = target;\n\n      while (element instanceof HTMLElement && element !== this.rowsContainer && scrollableElement.contains(element)) {\n        var rawIndex = element.getAttribute('data-index');\n\n        if (rawIndex) {\n          var index = Number(rawIndex);\n\n          if (!isNaN(index)) {\n            return index;\n          }\n        }\n\n        element = element.parentElement;\n      }\n\n      return undefined;\n    }\n  }, {\n    key: \"getRenderRange\",\n    value: function getRenderRange(renderTop, renderHeight) {\n      return {\n        start: this.rangeMap.indexAt(renderTop),\n        end: this.rangeMap.indexAfter(renderTop + renderHeight - 1)\n      };\n    }\n    /**\r\n     * Given a stable rendered state, checks every rendered element whether it needs\r\n     * to be probed for dynamic height. Adjusts scroll height and top if necessary.\r\n     */\n\n  }, {\n    key: \"_rerender\",\n    value: function _rerender(renderTop, renderHeight, inSmoothScrolling) {\n      var previousRenderRange = this.getRenderRange(renderTop, renderHeight); // Let's remember the second element's position, this helps in scrolling up\n      // and preserving a linear upwards scroll movement\n\n      var anchorElementIndex;\n      var anchorElementTopDelta;\n\n      if (renderTop === this.elementTop(previousRenderRange.start)) {\n        anchorElementIndex = previousRenderRange.start;\n        anchorElementTopDelta = 0;\n      } else if (previousRenderRange.end - previousRenderRange.start > 1) {\n        anchorElementIndex = previousRenderRange.start + 1;\n        anchorElementTopDelta = this.elementTop(anchorElementIndex) - renderTop;\n      }\n\n      var heightDiff = 0;\n\n      while (true) {\n        var renderRange = this.getRenderRange(renderTop, renderHeight);\n        var didChange = false;\n\n        for (var i = renderRange.start; i < renderRange.end; i++) {\n          var diff = this.probeDynamicHeight(i);\n\n          if (diff !== 0) {\n            this.rangeMap.splice(i, 1, [this.items[i]]);\n          }\n\n          heightDiff += diff;\n          didChange = didChange || diff !== 0;\n        }\n\n        if (!didChange) {\n          if (heightDiff !== 0) {\n            this.eventuallyUpdateScrollDimensions();\n          }\n\n          var unrenderRanges = Range.relativeComplement(previousRenderRange, renderRange);\n\n          var _iterator12 = _createForOfIteratorHelper(unrenderRanges),\n              _step12;\n\n          try {\n            for (_iterator12.s(); !(_step12 = _iterator12.n()).done;) {\n              var range = _step12.value;\n\n              for (var _i7 = range.start; _i7 < range.end; _i7++) {\n                if (this.items[_i7].row) {\n                  this.removeItemFromDOM(_i7);\n                }\n              }\n            }\n          } catch (err) {\n            _iterator12.e(err);\n          } finally {\n            _iterator12.f();\n          }\n\n          var renderRanges = Range.relativeComplement(renderRange, previousRenderRange);\n\n          var _iterator13 = _createForOfIteratorHelper(renderRanges),\n              _step13;\n\n          try {\n            for (_iterator13.s(); !(_step13 = _iterator13.n()).done;) {\n              var _range3 = _step13.value;\n\n              for (var _i8 = _range3.start; _i8 < _range3.end; _i8++) {\n                var afterIndex = _i8 + 1;\n                var beforeRow = afterIndex < this.items.length ? this.items[afterIndex].row : null;\n                var beforeElement = beforeRow ? beforeRow.domNode : null;\n                this.insertItemInDOM(_i8, beforeElement);\n              }\n            }\n          } catch (err) {\n            _iterator13.e(err);\n          } finally {\n            _iterator13.f();\n          }\n\n          for (var _i6 = renderRange.start; _i6 < renderRange.end; _i6++) {\n            if (this.items[_i6].row) {\n              this.updateItemInDOM(this.items[_i6], _i6);\n            }\n          }\n\n          if (typeof anchorElementIndex === 'number') {\n            // To compute a destination scroll top, we need to take into account the current smooth scrolling\n            // animation, and then reuse it with a new target (to avoid prolonging the scroll)\n            // See https://github.com/microsoft/vscode/issues/104144\n            // See https://github.com/microsoft/vscode/pull/104284\n            // See https://github.com/microsoft/vscode/issues/107704\n            var deltaScrollTop = this.scrollable.getFutureScrollPosition().scrollTop - renderTop;\n            var newScrollTop = this.elementTop(anchorElementIndex) - anchorElementTopDelta + deltaScrollTop;\n            this.setScrollTop(newScrollTop, inSmoothScrolling);\n          }\n\n          this._onDidChangeContentHeight.fire(this.contentHeight);\n\n          return;\n        }\n      }\n    }\n  }, {\n    key: \"probeDynamicHeight\",\n    value: function probeDynamicHeight(index) {\n      var item = this.items[index];\n\n      if (!item.hasDynamicHeight || item.lastDynamicHeightWidth === this.renderWidth) {\n        return 0;\n      }\n\n      if (!!this.virtualDelegate.hasDynamicHeight && !this.virtualDelegate.hasDynamicHeight(item.element)) {\n        return 0;\n      }\n\n      var size = item.size;\n\n      if (!this.setRowHeight && item.row) {\n        var newSize = item.row.domNode.offsetHeight;\n        item.size = newSize;\n        item.lastDynamicHeightWidth = this.renderWidth;\n        return newSize - size;\n      }\n\n      var row = this.cache.alloc(item.templateId);\n      row.domNode.style.height = '';\n      this.rowsContainer.appendChild(row.domNode);\n      var renderer = this.renderers.get(item.templateId);\n\n      if (renderer) {\n        renderer.renderElement(item.element, index, row.templateData, undefined);\n\n        if (renderer.disposeElement) {\n          renderer.disposeElement(item.element, index, row.templateData, undefined);\n        }\n      }\n\n      item.size = row.domNode.offsetHeight;\n\n      if (this.virtualDelegate.setDynamicHeight) {\n        this.virtualDelegate.setDynamicHeight(item.element, item.size);\n      }\n\n      item.lastDynamicHeightWidth = this.renderWidth;\n      this.rowsContainer.removeChild(row.domNode);\n      this.cache.release(row);\n      return item.size - size;\n    }\n  }, {\n    key: \"getNextToLastElement\",\n    value: function getNextToLastElement(ranges) {\n      var lastRange = ranges[ranges.length - 1];\n\n      if (!lastRange) {\n        return null;\n      }\n\n      var nextToLastItem = this.items[lastRange.end];\n\n      if (!nextToLastItem) {\n        return null;\n      }\n\n      if (!nextToLastItem.row) {\n        return null;\n      }\n\n      return nextToLastItem.row.domNode;\n    }\n  }, {\n    key: \"getElementDomId\",\n    value: function getElementDomId(index) {\n      return \"\".concat(this.domId, \"_\").concat(index);\n    } // Dispose\n\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      if (this.items) {\n        var _iterator14 = _createForOfIteratorHelper(this.items),\n            _step14;\n\n        try {\n          for (_iterator14.s(); !(_step14 = _iterator14.n()).done;) {\n            var item = _step14.value;\n\n            if (item.row) {\n              var renderer = this.renderers.get(item.row.templateId);\n\n              if (renderer) {\n                if (renderer.disposeElement) {\n                  renderer.disposeElement(item.element, -1, item.row.templateData, undefined);\n                }\n\n                renderer.disposeTemplate(item.row.templateData);\n              }\n            }\n          }\n        } catch (err) {\n          _iterator14.e(err);\n        } finally {\n          _iterator14.f();\n        }\n\n        this.items = [];\n      }\n\n      if (this.domNode && this.domNode.parentNode) {\n        this.domNode.parentNode.removeChild(this.domNode);\n      }\n\n      _dispose(this.disposables);\n    }\n  }, {\n    key: \"contentHeight\",\n    get: function get() {\n      return this.rangeMap.size;\n    }\n  }, {\n    key: \"horizontalScrolling\",\n    get: function get() {\n      return this._horizontalScrolling;\n    },\n    set: function set(value) {\n      if (value === this._horizontalScrolling) {\n        return;\n      }\n\n      if (value && this.supportDynamicHeights) {\n        throw new Error('Horizontal scrolling and dynamic heights not supported simultaneously');\n      }\n\n      this._horizontalScrolling = value;\n      this.domNode.classList.toggle('horizontal-scrolling', this._horizontalScrolling);\n\n      if (this._horizontalScrolling) {\n        var _iterator15 = _createForOfIteratorHelper(this.items),\n            _step15;\n\n        try {\n          for (_iterator15.s(); !(_step15 = _iterator15.n()).done;) {\n            var item = _step15.value;\n            this.measureItemWidth(item);\n          }\n        } catch (err) {\n          _iterator15.e(err);\n        } finally {\n          _iterator15.f();\n        }\n\n        this.updateScrollWidth();\n        this.scrollableElement.setScrollDimensions({\n          width: getContentWidth(this.domNode)\n        });\n        this.rowsContainer.style.width = \"\".concat(Math.max(this.scrollWidth || 0, this.renderWidth), \"px\");\n      } else {\n        this.scrollableElementWidthDelayer.cancel();\n        this.scrollableElement.setScrollDimensions({\n          width: this.renderWidth,\n          scrollWidth: this.renderWidth\n        });\n        this.rowsContainer.style.width = '';\n      }\n    }\n  }, {\n    key: \"length\",\n    get: function get() {\n      return this.items.length;\n    }\n  }, {\n    key: \"renderHeight\",\n    get: function get() {\n      var scrollDimensions = this.scrollableElement.getScrollDimensions();\n      return scrollDimensions.height;\n    }\n  }, {\n    key: \"scrollTop\",\n    get: function get() {\n      return this.getScrollTop();\n    },\n    set: function set(scrollTop) {\n      this.setScrollTop(scrollTop);\n    }\n  }, {\n    key: \"scrollHeight\",\n    get: function get() {\n      return this._scrollHeight + (this.horizontalScrolling ? 10 : 0) + this.additionalScrollHeight;\n    } // Events\n\n  }, {\n    key: \"onMouseClick\",\n    get: function get() {\n      var _this9 = this;\n\n      return Event.map(domEvent(this.domNode, 'click'), function (e) {\n        return _this9.toMouseEvent(e);\n      });\n    }\n  }, {\n    key: \"onMouseDblClick\",\n    get: function get() {\n      var _this10 = this;\n\n      return Event.map(domEvent(this.domNode, 'dblclick'), function (e) {\n        return _this10.toMouseEvent(e);\n      });\n    }\n  }, {\n    key: \"onMouseMiddleClick\",\n    get: function get() {\n      var _this11 = this;\n\n      return Event.filter(Event.map(domEvent(this.domNode, 'auxclick'), function (e) {\n        return _this11.toMouseEvent(e);\n      }), function (e) {\n        return e.browserEvent.button === 1;\n      });\n    }\n  }, {\n    key: \"onMouseDown\",\n    get: function get() {\n      var _this12 = this;\n\n      return Event.map(domEvent(this.domNode, 'mousedown'), function (e) {\n        return _this12.toMouseEvent(e);\n      });\n    }\n  }, {\n    key: \"onContextMenu\",\n    get: function get() {\n      var _this13 = this;\n\n      return Event.map(domEvent(this.domNode, 'contextmenu'), function (e) {\n        return _this13.toMouseEvent(e);\n      });\n    }\n  }, {\n    key: \"onTouchStart\",\n    get: function get() {\n      var _this14 = this;\n\n      return Event.map(domEvent(this.domNode, 'touchstart'), function (e) {\n        return _this14.toTouchEvent(e);\n      });\n    }\n  }, {\n    key: \"onTap\",\n    get: function get() {\n      var _this15 = this;\n\n      return Event.map(domEvent(this.rowsContainer, TouchEventType.Tap), function (e) {\n        return _this15.toGestureEvent(e);\n      });\n    }\n  }]);\n\n  return ListView;\n}();\nListView.InstanceCount = 0;\n\n__decorate([memoize], ListView.prototype, \"onMouseClick\", null);\n\n__decorate([memoize], ListView.prototype, \"onMouseDblClick\", null);\n\n__decorate([memoize], ListView.prototype, \"onMouseMiddleClick\", null);\n\n__decorate([memoize], ListView.prototype, \"onMouseDown\", null);\n\n__decorate([memoize], ListView.prototype, \"onContextMenu\", null);\n\n__decorate([memoize], ListView.prototype, \"onTouchStart\", null);\n\n__decorate([memoize], ListView.prototype, \"onTap\", null);","map":{"version":3,"sources":["/home/bar007/Desktop/projects/tio/client/node_modules/monaco-editor/esm/vs/base/browser/ui/list/listView.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","getOrDefault","dispose","Disposable","toDisposable","DisposableStore","Gesture","EventType","TouchEventType","Event","Emitter","domEvent","SmoothScrollableElement","Scrollable","RangeMap","shift","RowCache","memoize","Range","equals","distinct","DataTransfers","StaticDND","disposableTimeout","Delayer","isFirefox","$","animate","getContentHeight","getContentWidth","getTopLeftOffset","scheduleAtNextAnimationFrame","DefaultOptions","useShadows","verticalScrollMode","setRowLineHeight","setRowHeight","supportDynamicHeights","dnd","getDragElements","e","getDragURI","onDragStart","onDragOver","drop","horizontalScrolling","transformOptimization","ElementsDragAndDropData","elements","ExternalElementsDragAndDropData","NativeDragAndDropData","types","files","dataTransfer","splice","file","item","size","type","push","equalsDragFeedback","f1","f2","Array","isArray","ListViewAccessibilityProvider","accessibilityProvider","getSetSize","bind","l","getPosInSet","getRole","_","isChecked","undefined","ListView","container","virtualDelegate","renderers","options","domId","InstanceCount","Map","renderWidth","_scrollHeight","scrollableElementUpdateDisposable","scrollableElementWidthDelayer","splicing","dragOverAnimationStopDisposable","None","dragOverMouseY","canDrop","currentDragFeedbackDisposable","onDragLeaveTimeout","disposables","_onDidChangeContentHeight","_horizontalScrolling","Error","items","itemId","rangeMap","renderer","set","templateId","cache","add","lastRenderTop","lastRenderHeight","domNode","document","createElement","className","classList","tabIndex","toggle","mouseSupport","o","additionalScrollHeight","rowsContainer","style","transform","addTarget","scrollable","smoothScrolling","cb","scrollableElement","horizontal","vertical","appendChild","getDomNode","onScroll","Change","onTouchChange","scrollTop","map","toDragEvent","onDrop","onDragLeave","window","onDragEnd","layout","setSmoothScrollDuration","start","deleteCount","_splice","fire","contentHeight","previousRenderRange","getRenderRange","deleteRange","end","removeRange","intersect","rowsToDispose","dragStartDisposable","row","rows","get","element","previousRestRange","previousRenderedRestRange","previousUnrenderedRestRanges","relativeComplement","inserted","id","String","getTemplateId","getHeight","width","hasDynamicHeight","lastDynamicHeightWidth","uri","dropTarget","deleted","delta","renderRange","renderedRestRange","updateRange","updateItemInDOM","removeRanges","range","removeItemFromDOM","unrenderedRestRanges","elementsRange","insertRanges","beforeElement","getNextToLastElement","rowData","pop","insertItemInDOM","index","disposeElement","templateData","release","eventuallyUpdateScrollDimensions","_rerender","renderHeight","height","setScrollDimensions","scrollHeight","updateScrollWidth","cancel","trigger","scrollWidth","Math","max","positionAt","position","indexAt","indexAfter","scrollDimensions","renderTop","renderLeft","updateItemsInDOM","rangesToInsert","rangesToRemove","rangesToUpdate","left","top","alloc","role","setAttribute","checked","parentElement","insertBefore","renderElement","draggable","event","measureItemWidth","eventuallyUpdateScrollWidth","getComputedStyle","paddingLeft","parseFloat","paddingRight","elementTop","lineHeight","getElementDomId","scrollPosition","getScrollPosition","reuseAnimation","setScrollPosition","browserEvent","getItemIndexFromEventTarget","initialTarget","render","scrollLeft","inSmoothScrolling","err","console","error","preventDefault","stopPropagation","translationY","effectAllowed","setData","RESOURCES","JSON","stringify","setDragImage","label","getDragLabel","dragImage","textContent","body","setTimeout","removeChild","currentDragData","CurrentDragAndDropData","getData","setupDragAndDropScrollTopAnimation","result","accept","currentDragFeedback","dropEffect","effect","feedback","filter","sort","a","b","remove","clearDragOverFeedback","dragData","teardownDragAndDropScrollTopAnimation","update","dragOverAnimationDisposable","viewTop","animateDragAndDropScrollTop","pageY","diff","upperLimit","floor","min","HTMLElement","contains","rawIndex","getAttribute","Number","isNaN","anchorElementIndex","anchorElementTopDelta","heightDiff","didChange","probeDynamicHeight","unrenderRanges","renderRanges","afterIndex","beforeRow","deltaScrollTop","getFutureScrollPosition","newScrollTop","setScrollTop","newSize","offsetHeight","setDynamicHeight","ranges","lastRange","nextToLastItem","disposeTemplate","parentNode","value","getScrollDimensions","getScrollTop","toMouseEvent","button","toTouchEvent","Tap","toGestureEvent","prototype"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { getOrDefault } from '../../../common/objects.js';\r\nimport { dispose, Disposable, toDisposable, DisposableStore } from '../../../common/lifecycle.js';\r\nimport { Gesture, EventType as TouchEventType } from '../../touch.js';\r\nimport { Event, Emitter } from '../../../common/event.js';\r\nimport { domEvent } from '../../event.js';\r\nimport { SmoothScrollableElement } from '../scrollbar/scrollableElement.js';\r\nimport { Scrollable } from '../../../common/scrollable.js';\r\nimport { RangeMap, shift } from './rangeMap.js';\r\nimport { RowCache } from './rowCache.js';\r\nimport { memoize } from '../../../common/decorators.js';\r\nimport { Range } from '../../../common/range.js';\r\nimport { equals, distinct } from '../../../common/arrays.js';\r\nimport { DataTransfers, StaticDND } from '../../dnd.js';\r\nimport { disposableTimeout, Delayer } from '../../../common/async.js';\r\nimport { isFirefox } from '../../browser.js';\r\nimport { $, animate, getContentHeight, getContentWidth, getTopLeftOffset, scheduleAtNextAnimationFrame } from '../../dom.js';\r\nconst DefaultOptions = {\r\n    useShadows: true,\r\n    verticalScrollMode: 1 /* Auto */,\r\n    setRowLineHeight: true,\r\n    setRowHeight: true,\r\n    supportDynamicHeights: false,\r\n    dnd: {\r\n        getDragElements(e) { return [e]; },\r\n        getDragURI() { return null; },\r\n        onDragStart() { },\r\n        onDragOver() { return false; },\r\n        drop() { }\r\n    },\r\n    horizontalScrolling: false,\r\n    transformOptimization: true\r\n};\r\nexport class ElementsDragAndDropData {\r\n    constructor(elements) {\r\n        this.elements = elements;\r\n    }\r\n    update() { }\r\n    getData() {\r\n        return this.elements;\r\n    }\r\n}\r\nexport class ExternalElementsDragAndDropData {\r\n    constructor(elements) {\r\n        this.elements = elements;\r\n    }\r\n    update() { }\r\n    getData() {\r\n        return this.elements;\r\n    }\r\n}\r\nexport class NativeDragAndDropData {\r\n    constructor() {\r\n        this.types = [];\r\n        this.files = [];\r\n    }\r\n    update(dataTransfer) {\r\n        if (dataTransfer.types) {\r\n            this.types.splice(0, this.types.length, ...dataTransfer.types);\r\n        }\r\n        if (dataTransfer.files) {\r\n            this.files.splice(0, this.files.length);\r\n            for (let i = 0; i < dataTransfer.files.length; i++) {\r\n                const file = dataTransfer.files.item(i);\r\n                if (file && (file.size || file.type)) {\r\n                    this.files.push(file);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    getData() {\r\n        return {\r\n            types: this.types,\r\n            files: this.files\r\n        };\r\n    }\r\n}\r\nfunction equalsDragFeedback(f1, f2) {\r\n    if (Array.isArray(f1) && Array.isArray(f2)) {\r\n        return equals(f1, f2);\r\n    }\r\n    return f1 === f2;\r\n}\r\nclass ListViewAccessibilityProvider {\r\n    constructor(accessibilityProvider) {\r\n        if (accessibilityProvider === null || accessibilityProvider === void 0 ? void 0 : accessibilityProvider.getSetSize) {\r\n            this.getSetSize = accessibilityProvider.getSetSize.bind(accessibilityProvider);\r\n        }\r\n        else {\r\n            this.getSetSize = (e, i, l) => l;\r\n        }\r\n        if (accessibilityProvider === null || accessibilityProvider === void 0 ? void 0 : accessibilityProvider.getPosInSet) {\r\n            this.getPosInSet = accessibilityProvider.getPosInSet.bind(accessibilityProvider);\r\n        }\r\n        else {\r\n            this.getPosInSet = (e, i) => i + 1;\r\n        }\r\n        if (accessibilityProvider === null || accessibilityProvider === void 0 ? void 0 : accessibilityProvider.getRole) {\r\n            this.getRole = accessibilityProvider.getRole.bind(accessibilityProvider);\r\n        }\r\n        else {\r\n            this.getRole = _ => 'listitem';\r\n        }\r\n        if (accessibilityProvider === null || accessibilityProvider === void 0 ? void 0 : accessibilityProvider.isChecked) {\r\n            this.isChecked = accessibilityProvider.isChecked.bind(accessibilityProvider);\r\n        }\r\n        else {\r\n            this.isChecked = _ => undefined;\r\n        }\r\n    }\r\n}\r\nexport class ListView {\r\n    constructor(container, virtualDelegate, renderers, options = DefaultOptions) {\r\n        this.virtualDelegate = virtualDelegate;\r\n        this.domId = `list_id_${++ListView.InstanceCount}`;\r\n        this.renderers = new Map();\r\n        this.renderWidth = 0;\r\n        this._scrollHeight = 0;\r\n        this.scrollableElementUpdateDisposable = null;\r\n        this.scrollableElementWidthDelayer = new Delayer(50);\r\n        this.splicing = false;\r\n        this.dragOverAnimationStopDisposable = Disposable.None;\r\n        this.dragOverMouseY = 0;\r\n        this.canDrop = false;\r\n        this.currentDragFeedbackDisposable = Disposable.None;\r\n        this.onDragLeaveTimeout = Disposable.None;\r\n        this.disposables = new DisposableStore();\r\n        this._onDidChangeContentHeight = new Emitter();\r\n        this._horizontalScrolling = false;\r\n        if (options.horizontalScrolling && options.supportDynamicHeights) {\r\n            throw new Error('Horizontal scrolling and dynamic heights not supported simultaneously');\r\n        }\r\n        this.items = [];\r\n        this.itemId = 0;\r\n        this.rangeMap = new RangeMap();\r\n        for (const renderer of renderers) {\r\n            this.renderers.set(renderer.templateId, renderer);\r\n        }\r\n        this.cache = this.disposables.add(new RowCache(this.renderers));\r\n        this.lastRenderTop = 0;\r\n        this.lastRenderHeight = 0;\r\n        this.domNode = document.createElement('div');\r\n        this.domNode.className = 'monaco-list';\r\n        this.domNode.classList.add(this.domId);\r\n        this.domNode.tabIndex = 0;\r\n        this.domNode.classList.toggle('mouse-support', typeof options.mouseSupport === 'boolean' ? options.mouseSupport : true);\r\n        this._horizontalScrolling = getOrDefault(options, o => o.horizontalScrolling, DefaultOptions.horizontalScrolling);\r\n        this.domNode.classList.toggle('horizontal-scrolling', this._horizontalScrolling);\r\n        this.additionalScrollHeight = typeof options.additionalScrollHeight === 'undefined' ? 0 : options.additionalScrollHeight;\r\n        this.accessibilityProvider = new ListViewAccessibilityProvider(options.accessibilityProvider);\r\n        this.rowsContainer = document.createElement('div');\r\n        this.rowsContainer.className = 'monaco-list-rows';\r\n        const transformOptimization = getOrDefault(options, o => o.transformOptimization, DefaultOptions.transformOptimization);\r\n        if (transformOptimization) {\r\n            this.rowsContainer.style.transform = 'translate3d(0px, 0px, 0px)';\r\n        }\r\n        this.disposables.add(Gesture.addTarget(this.rowsContainer));\r\n        this.scrollable = new Scrollable(getOrDefault(options, o => o.smoothScrolling, false) ? 125 : 0, cb => scheduleAtNextAnimationFrame(cb));\r\n        this.scrollableElement = this.disposables.add(new SmoothScrollableElement(this.rowsContainer, {\r\n            horizontal: 1 /* Auto */,\r\n            vertical: getOrDefault(options, o => o.verticalScrollMode, DefaultOptions.verticalScrollMode),\r\n            useShadows: getOrDefault(options, o => o.useShadows, DefaultOptions.useShadows),\r\n        }, this.scrollable));\r\n        this.domNode.appendChild(this.scrollableElement.getDomNode());\r\n        container.appendChild(this.domNode);\r\n        this.scrollableElement.onScroll(this.onScroll, this, this.disposables);\r\n        domEvent(this.rowsContainer, TouchEventType.Change)(this.onTouchChange, this, this.disposables);\r\n        // Prevent the monaco-scrollable-element from scrolling\r\n        // https://github.com/microsoft/vscode/issues/44181\r\n        domEvent(this.scrollableElement.getDomNode(), 'scroll')(e => e.target.scrollTop = 0, null, this.disposables);\r\n        Event.map(domEvent(this.domNode, 'dragover'), e => this.toDragEvent(e))(this.onDragOver, this, this.disposables);\r\n        Event.map(domEvent(this.domNode, 'drop'), e => this.toDragEvent(e))(this.onDrop, this, this.disposables);\r\n        domEvent(this.domNode, 'dragleave')(this.onDragLeave, this, this.disposables);\r\n        domEvent(window, 'dragend')(this.onDragEnd, this, this.disposables);\r\n        this.setRowLineHeight = getOrDefault(options, o => o.setRowLineHeight, DefaultOptions.setRowLineHeight);\r\n        this.setRowHeight = getOrDefault(options, o => o.setRowHeight, DefaultOptions.setRowHeight);\r\n        this.supportDynamicHeights = getOrDefault(options, o => o.supportDynamicHeights, DefaultOptions.supportDynamicHeights);\r\n        this.dnd = getOrDefault(options, o => o.dnd, DefaultOptions.dnd);\r\n        this.layout();\r\n    }\r\n    get contentHeight() { return this.rangeMap.size; }\r\n    get horizontalScrolling() { return this._horizontalScrolling; }\r\n    set horizontalScrolling(value) {\r\n        if (value === this._horizontalScrolling) {\r\n            return;\r\n        }\r\n        if (value && this.supportDynamicHeights) {\r\n            throw new Error('Horizontal scrolling and dynamic heights not supported simultaneously');\r\n        }\r\n        this._horizontalScrolling = value;\r\n        this.domNode.classList.toggle('horizontal-scrolling', this._horizontalScrolling);\r\n        if (this._horizontalScrolling) {\r\n            for (const item of this.items) {\r\n                this.measureItemWidth(item);\r\n            }\r\n            this.updateScrollWidth();\r\n            this.scrollableElement.setScrollDimensions({ width: getContentWidth(this.domNode) });\r\n            this.rowsContainer.style.width = `${Math.max(this.scrollWidth || 0, this.renderWidth)}px`;\r\n        }\r\n        else {\r\n            this.scrollableElementWidthDelayer.cancel();\r\n            this.scrollableElement.setScrollDimensions({ width: this.renderWidth, scrollWidth: this.renderWidth });\r\n            this.rowsContainer.style.width = '';\r\n        }\r\n    }\r\n    updateOptions(options) {\r\n        if (options.additionalScrollHeight !== undefined) {\r\n            this.additionalScrollHeight = options.additionalScrollHeight;\r\n        }\r\n        if (options.smoothScrolling !== undefined) {\r\n            this.scrollable.setSmoothScrollDuration(options.smoothScrolling ? 125 : 0);\r\n        }\r\n        if (options.horizontalScrolling !== undefined) {\r\n            this.horizontalScrolling = options.horizontalScrolling;\r\n        }\r\n    }\r\n    splice(start, deleteCount, elements = []) {\r\n        if (this.splicing) {\r\n            throw new Error('Can\\'t run recursive splices.');\r\n        }\r\n        this.splicing = true;\r\n        try {\r\n            return this._splice(start, deleteCount, elements);\r\n        }\r\n        finally {\r\n            this.splicing = false;\r\n            this._onDidChangeContentHeight.fire(this.contentHeight);\r\n        }\r\n    }\r\n    _splice(start, deleteCount, elements = []) {\r\n        const previousRenderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\r\n        const deleteRange = { start, end: start + deleteCount };\r\n        const removeRange = Range.intersect(previousRenderRange, deleteRange);\r\n        // try to reuse rows, avoid removing them from DOM\r\n        const rowsToDispose = new Map();\r\n        for (let i = removeRange.start; i < removeRange.end; i++) {\r\n            const item = this.items[i];\r\n            item.dragStartDisposable.dispose();\r\n            if (item.row) {\r\n                let rows = rowsToDispose.get(item.templateId);\r\n                if (!rows) {\r\n                    rows = [];\r\n                    rowsToDispose.set(item.templateId, rows);\r\n                }\r\n                rows.push([item.row, item.element, i, item.size]);\r\n            }\r\n            item.row = null;\r\n        }\r\n        const previousRestRange = { start: start + deleteCount, end: this.items.length };\r\n        const previousRenderedRestRange = Range.intersect(previousRestRange, previousRenderRange);\r\n        const previousUnrenderedRestRanges = Range.relativeComplement(previousRestRange, previousRenderRange);\r\n        const inserted = elements.map(element => ({\r\n            id: String(this.itemId++),\r\n            element,\r\n            templateId: this.virtualDelegate.getTemplateId(element),\r\n            size: this.virtualDelegate.getHeight(element),\r\n            width: undefined,\r\n            hasDynamicHeight: !!this.virtualDelegate.hasDynamicHeight && this.virtualDelegate.hasDynamicHeight(element),\r\n            lastDynamicHeightWidth: undefined,\r\n            row: null,\r\n            uri: undefined,\r\n            dropTarget: false,\r\n            dragStartDisposable: Disposable.None\r\n        }));\r\n        let deleted;\r\n        // TODO@joao: improve this optimization to catch even more cases\r\n        if (start === 0 && deleteCount >= this.items.length) {\r\n            this.rangeMap = new RangeMap();\r\n            this.rangeMap.splice(0, 0, inserted);\r\n            this.items = inserted;\r\n            deleted = [];\r\n        }\r\n        else {\r\n            this.rangeMap.splice(start, deleteCount, inserted);\r\n            deleted = this.items.splice(start, deleteCount, ...inserted);\r\n        }\r\n        const delta = elements.length - deleteCount;\r\n        const renderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\r\n        const renderedRestRange = shift(previousRenderedRestRange, delta);\r\n        const updateRange = Range.intersect(renderRange, renderedRestRange);\r\n        for (let i = updateRange.start; i < updateRange.end; i++) {\r\n            this.updateItemInDOM(this.items[i], i);\r\n        }\r\n        const removeRanges = Range.relativeComplement(renderedRestRange, renderRange);\r\n        for (const range of removeRanges) {\r\n            for (let i = range.start; i < range.end; i++) {\r\n                this.removeItemFromDOM(i);\r\n            }\r\n        }\r\n        const unrenderedRestRanges = previousUnrenderedRestRanges.map(r => shift(r, delta));\r\n        const elementsRange = { start, end: start + elements.length };\r\n        const insertRanges = [elementsRange, ...unrenderedRestRanges].map(r => Range.intersect(renderRange, r));\r\n        const beforeElement = this.getNextToLastElement(insertRanges);\r\n        for (const range of insertRanges) {\r\n            for (let i = range.start; i < range.end; i++) {\r\n                const item = this.items[i];\r\n                const rows = rowsToDispose.get(item.templateId);\r\n                const rowData = rows === null || rows === void 0 ? void 0 : rows.pop();\r\n                if (!rowData) {\r\n                    this.insertItemInDOM(i, beforeElement);\r\n                }\r\n                else {\r\n                    const [row, element, index, size] = rowData;\r\n                    const renderer = this.renderers.get(item.templateId);\r\n                    if (renderer && renderer.disposeElement) {\r\n                        renderer.disposeElement(element, index, row.templateData, size);\r\n                    }\r\n                    this.insertItemInDOM(i, beforeElement, row);\r\n                }\r\n            }\r\n        }\r\n        for (const [templateId, rows] of rowsToDispose) {\r\n            for (const [row, element, index, size] of rows) {\r\n                const renderer = this.renderers.get(templateId);\r\n                if (renderer && renderer.disposeElement) {\r\n                    renderer.disposeElement(element, index, row.templateData, size);\r\n                }\r\n                this.cache.release(row);\r\n            }\r\n        }\r\n        this.eventuallyUpdateScrollDimensions();\r\n        if (this.supportDynamicHeights) {\r\n            this._rerender(this.scrollTop, this.renderHeight);\r\n        }\r\n        return deleted.map(i => i.element);\r\n    }\r\n    eventuallyUpdateScrollDimensions() {\r\n        this._scrollHeight = this.contentHeight;\r\n        this.rowsContainer.style.height = `${this._scrollHeight}px`;\r\n        if (!this.scrollableElementUpdateDisposable) {\r\n            this.scrollableElementUpdateDisposable = scheduleAtNextAnimationFrame(() => {\r\n                this.scrollableElement.setScrollDimensions({ scrollHeight: this.scrollHeight });\r\n                this.updateScrollWidth();\r\n                this.scrollableElementUpdateDisposable = null;\r\n            });\r\n        }\r\n    }\r\n    eventuallyUpdateScrollWidth() {\r\n        if (!this.horizontalScrolling) {\r\n            this.scrollableElementWidthDelayer.cancel();\r\n            return;\r\n        }\r\n        this.scrollableElementWidthDelayer.trigger(() => this.updateScrollWidth());\r\n    }\r\n    updateScrollWidth() {\r\n        if (!this.horizontalScrolling) {\r\n            return;\r\n        }\r\n        let scrollWidth = 0;\r\n        for (const item of this.items) {\r\n            if (typeof item.width !== 'undefined') {\r\n                scrollWidth = Math.max(scrollWidth, item.width);\r\n            }\r\n        }\r\n        this.scrollWidth = scrollWidth;\r\n        this.scrollableElement.setScrollDimensions({ scrollWidth: scrollWidth === 0 ? 0 : (scrollWidth + 10) });\r\n    }\r\n    rerender() {\r\n        if (!this.supportDynamicHeights) {\r\n            return;\r\n        }\r\n        for (const item of this.items) {\r\n            item.lastDynamicHeightWidth = undefined;\r\n        }\r\n        this._rerender(this.lastRenderTop, this.lastRenderHeight);\r\n    }\r\n    get length() {\r\n        return this.items.length;\r\n    }\r\n    get renderHeight() {\r\n        const scrollDimensions = this.scrollableElement.getScrollDimensions();\r\n        return scrollDimensions.height;\r\n    }\r\n    element(index) {\r\n        return this.items[index].element;\r\n    }\r\n    domElement(index) {\r\n        const row = this.items[index].row;\r\n        return row && row.domNode;\r\n    }\r\n    elementHeight(index) {\r\n        return this.items[index].size;\r\n    }\r\n    elementTop(index) {\r\n        return this.rangeMap.positionAt(index);\r\n    }\r\n    indexAt(position) {\r\n        return this.rangeMap.indexAt(position);\r\n    }\r\n    indexAfter(position) {\r\n        return this.rangeMap.indexAfter(position);\r\n    }\r\n    layout(height, width) {\r\n        let scrollDimensions = {\r\n            height: typeof height === 'number' ? height : getContentHeight(this.domNode)\r\n        };\r\n        if (this.scrollableElementUpdateDisposable) {\r\n            this.scrollableElementUpdateDisposable.dispose();\r\n            this.scrollableElementUpdateDisposable = null;\r\n            scrollDimensions.scrollHeight = this.scrollHeight;\r\n        }\r\n        this.scrollableElement.setScrollDimensions(scrollDimensions);\r\n        if (typeof width !== 'undefined') {\r\n            this.renderWidth = width;\r\n            if (this.supportDynamicHeights) {\r\n                this._rerender(this.scrollTop, this.renderHeight);\r\n            }\r\n            if (this.horizontalScrolling) {\r\n                this.scrollableElement.setScrollDimensions({\r\n                    width: typeof width === 'number' ? width : getContentWidth(this.domNode)\r\n                });\r\n            }\r\n        }\r\n    }\r\n    // Render\r\n    render(previousRenderRange, renderTop, renderHeight, renderLeft, scrollWidth, updateItemsInDOM = false) {\r\n        const renderRange = this.getRenderRange(renderTop, renderHeight);\r\n        const rangesToInsert = Range.relativeComplement(renderRange, previousRenderRange);\r\n        const rangesToRemove = Range.relativeComplement(previousRenderRange, renderRange);\r\n        const beforeElement = this.getNextToLastElement(rangesToInsert);\r\n        if (updateItemsInDOM) {\r\n            const rangesToUpdate = Range.intersect(previousRenderRange, renderRange);\r\n            for (let i = rangesToUpdate.start; i < rangesToUpdate.end; i++) {\r\n                this.updateItemInDOM(this.items[i], i);\r\n            }\r\n        }\r\n        for (const range of rangesToInsert) {\r\n            for (let i = range.start; i < range.end; i++) {\r\n                this.insertItemInDOM(i, beforeElement);\r\n            }\r\n        }\r\n        for (const range of rangesToRemove) {\r\n            for (let i = range.start; i < range.end; i++) {\r\n                this.removeItemFromDOM(i);\r\n            }\r\n        }\r\n        if (renderLeft !== undefined) {\r\n            this.rowsContainer.style.left = `-${renderLeft}px`;\r\n        }\r\n        this.rowsContainer.style.top = `-${renderTop}px`;\r\n        if (this.horizontalScrolling && scrollWidth !== undefined) {\r\n            this.rowsContainer.style.width = `${Math.max(scrollWidth, this.renderWidth)}px`;\r\n        }\r\n        this.lastRenderTop = renderTop;\r\n        this.lastRenderHeight = renderHeight;\r\n    }\r\n    // DOM operations\r\n    insertItemInDOM(index, beforeElement, row) {\r\n        const item = this.items[index];\r\n        if (!item.row) {\r\n            item.row = row !== null && row !== void 0 ? row : this.cache.alloc(item.templateId);\r\n        }\r\n        const role = this.accessibilityProvider.getRole(item.element) || 'listitem';\r\n        item.row.domNode.setAttribute('role', role);\r\n        const checked = this.accessibilityProvider.isChecked(item.element);\r\n        if (typeof checked !== 'undefined') {\r\n            item.row.domNode.setAttribute('aria-checked', String(!!checked));\r\n        }\r\n        if (!item.row.domNode.parentElement) {\r\n            if (beforeElement) {\r\n                this.rowsContainer.insertBefore(item.row.domNode, beforeElement);\r\n            }\r\n            else {\r\n                this.rowsContainer.appendChild(item.row.domNode);\r\n            }\r\n        }\r\n        this.updateItemInDOM(item, index);\r\n        const renderer = this.renderers.get(item.templateId);\r\n        if (!renderer) {\r\n            throw new Error(`No renderer found for template id ${item.templateId}`);\r\n        }\r\n        if (renderer) {\r\n            renderer.renderElement(item.element, index, item.row.templateData, item.size);\r\n        }\r\n        const uri = this.dnd.getDragURI(item.element);\r\n        item.dragStartDisposable.dispose();\r\n        item.row.domNode.draggable = !!uri;\r\n        if (uri) {\r\n            const onDragStart = domEvent(item.row.domNode, 'dragstart');\r\n            item.dragStartDisposable = onDragStart(event => this.onDragStart(item.element, uri, event));\r\n        }\r\n        if (this.horizontalScrolling) {\r\n            this.measureItemWidth(item);\r\n            this.eventuallyUpdateScrollWidth();\r\n        }\r\n    }\r\n    measureItemWidth(item) {\r\n        if (!item.row || !item.row.domNode) {\r\n            return;\r\n        }\r\n        item.row.domNode.style.width = isFirefox ? '-moz-fit-content' : 'fit-content';\r\n        item.width = getContentWidth(item.row.domNode);\r\n        const style = window.getComputedStyle(item.row.domNode);\r\n        if (style.paddingLeft) {\r\n            item.width += parseFloat(style.paddingLeft);\r\n        }\r\n        if (style.paddingRight) {\r\n            item.width += parseFloat(style.paddingRight);\r\n        }\r\n        item.row.domNode.style.width = '';\r\n    }\r\n    updateItemInDOM(item, index) {\r\n        item.row.domNode.style.top = `${this.elementTop(index)}px`;\r\n        if (this.setRowHeight) {\r\n            item.row.domNode.style.height = `${item.size}px`;\r\n        }\r\n        if (this.setRowLineHeight) {\r\n            item.row.domNode.style.lineHeight = `${item.size}px`;\r\n        }\r\n        item.row.domNode.setAttribute('data-index', `${index}`);\r\n        item.row.domNode.setAttribute('data-last-element', index === this.length - 1 ? 'true' : 'false');\r\n        item.row.domNode.setAttribute('aria-setsize', String(this.accessibilityProvider.getSetSize(item.element, index, this.length)));\r\n        item.row.domNode.setAttribute('aria-posinset', String(this.accessibilityProvider.getPosInSet(item.element, index)));\r\n        item.row.domNode.setAttribute('id', this.getElementDomId(index));\r\n        item.row.domNode.classList.toggle('drop-target', item.dropTarget);\r\n    }\r\n    removeItemFromDOM(index) {\r\n        const item = this.items[index];\r\n        item.dragStartDisposable.dispose();\r\n        if (item.row) {\r\n            const renderer = this.renderers.get(item.templateId);\r\n            if (renderer && renderer.disposeElement) {\r\n                renderer.disposeElement(item.element, index, item.row.templateData, item.size);\r\n            }\r\n            this.cache.release(item.row);\r\n            item.row = null;\r\n        }\r\n        if (this.horizontalScrolling) {\r\n            this.eventuallyUpdateScrollWidth();\r\n        }\r\n    }\r\n    getScrollTop() {\r\n        const scrollPosition = this.scrollableElement.getScrollPosition();\r\n        return scrollPosition.scrollTop;\r\n    }\r\n    setScrollTop(scrollTop, reuseAnimation) {\r\n        if (this.scrollableElementUpdateDisposable) {\r\n            this.scrollableElementUpdateDisposable.dispose();\r\n            this.scrollableElementUpdateDisposable = null;\r\n            this.scrollableElement.setScrollDimensions({ scrollHeight: this.scrollHeight });\r\n        }\r\n        this.scrollableElement.setScrollPosition({ scrollTop, reuseAnimation });\r\n    }\r\n    get scrollTop() {\r\n        return this.getScrollTop();\r\n    }\r\n    set scrollTop(scrollTop) {\r\n        this.setScrollTop(scrollTop);\r\n    }\r\n    get scrollHeight() {\r\n        return this._scrollHeight + (this.horizontalScrolling ? 10 : 0) + this.additionalScrollHeight;\r\n    }\r\n    // Events\r\n    get onMouseClick() { return Event.map(domEvent(this.domNode, 'click'), e => this.toMouseEvent(e)); }\r\n    get onMouseDblClick() { return Event.map(domEvent(this.domNode, 'dblclick'), e => this.toMouseEvent(e)); }\r\n    get onMouseMiddleClick() { return Event.filter(Event.map(domEvent(this.domNode, 'auxclick'), e => this.toMouseEvent(e)), e => e.browserEvent.button === 1); }\r\n    get onMouseDown() { return Event.map(domEvent(this.domNode, 'mousedown'), e => this.toMouseEvent(e)); }\r\n    get onContextMenu() { return Event.map(domEvent(this.domNode, 'contextmenu'), e => this.toMouseEvent(e)); }\r\n    get onTouchStart() { return Event.map(domEvent(this.domNode, 'touchstart'), e => this.toTouchEvent(e)); }\r\n    get onTap() { return Event.map(domEvent(this.rowsContainer, TouchEventType.Tap), e => this.toGestureEvent(e)); }\r\n    toMouseEvent(browserEvent) {\r\n        const index = this.getItemIndexFromEventTarget(browserEvent.target || null);\r\n        const item = typeof index === 'undefined' ? undefined : this.items[index];\r\n        const element = item && item.element;\r\n        return { browserEvent, index, element };\r\n    }\r\n    toTouchEvent(browserEvent) {\r\n        const index = this.getItemIndexFromEventTarget(browserEvent.target || null);\r\n        const item = typeof index === 'undefined' ? undefined : this.items[index];\r\n        const element = item && item.element;\r\n        return { browserEvent, index, element };\r\n    }\r\n    toGestureEvent(browserEvent) {\r\n        const index = this.getItemIndexFromEventTarget(browserEvent.initialTarget || null);\r\n        const item = typeof index === 'undefined' ? undefined : this.items[index];\r\n        const element = item && item.element;\r\n        return { browserEvent, index, element };\r\n    }\r\n    toDragEvent(browserEvent) {\r\n        const index = this.getItemIndexFromEventTarget(browserEvent.target || null);\r\n        const item = typeof index === 'undefined' ? undefined : this.items[index];\r\n        const element = item && item.element;\r\n        return { browserEvent, index, element };\r\n    }\r\n    onScroll(e) {\r\n        try {\r\n            const previousRenderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\r\n            this.render(previousRenderRange, e.scrollTop, e.height, e.scrollLeft, e.scrollWidth);\r\n            if (this.supportDynamicHeights) {\r\n                this._rerender(e.scrollTop, e.height, e.inSmoothScrolling);\r\n            }\r\n        }\r\n        catch (err) {\r\n            console.error('Got bad scroll event:', e);\r\n            throw err;\r\n        }\r\n    }\r\n    onTouchChange(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        this.scrollTop -= event.translationY;\r\n    }\r\n    // DND\r\n    onDragStart(element, uri, event) {\r\n        if (!event.dataTransfer) {\r\n            return;\r\n        }\r\n        const elements = this.dnd.getDragElements(element);\r\n        event.dataTransfer.effectAllowed = 'copyMove';\r\n        event.dataTransfer.setData(DataTransfers.RESOURCES, JSON.stringify([uri]));\r\n        if (event.dataTransfer.setDragImage) {\r\n            let label;\r\n            if (this.dnd.getDragLabel) {\r\n                label = this.dnd.getDragLabel(elements, event);\r\n            }\r\n            if (typeof label === 'undefined') {\r\n                label = String(elements.length);\r\n            }\r\n            const dragImage = $('.monaco-drag-image');\r\n            dragImage.textContent = label;\r\n            document.body.appendChild(dragImage);\r\n            event.dataTransfer.setDragImage(dragImage, -10, -10);\r\n            setTimeout(() => document.body.removeChild(dragImage), 0);\r\n        }\r\n        this.currentDragData = new ElementsDragAndDropData(elements);\r\n        StaticDND.CurrentDragAndDropData = new ExternalElementsDragAndDropData(elements);\r\n        if (this.dnd.onDragStart) {\r\n            this.dnd.onDragStart(this.currentDragData, event);\r\n        }\r\n    }\r\n    onDragOver(event) {\r\n        event.browserEvent.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\r\n        this.onDragLeaveTimeout.dispose();\r\n        if (StaticDND.CurrentDragAndDropData && StaticDND.CurrentDragAndDropData.getData() === 'vscode-ui') {\r\n            return false;\r\n        }\r\n        this.setupDragAndDropScrollTopAnimation(event.browserEvent);\r\n        if (!event.browserEvent.dataTransfer) {\r\n            return false;\r\n        }\r\n        // Drag over from outside\r\n        if (!this.currentDragData) {\r\n            if (StaticDND.CurrentDragAndDropData) {\r\n                // Drag over from another list\r\n                this.currentDragData = StaticDND.CurrentDragAndDropData;\r\n            }\r\n            else {\r\n                // Drag over from the desktop\r\n                if (!event.browserEvent.dataTransfer.types) {\r\n                    return false;\r\n                }\r\n                this.currentDragData = new NativeDragAndDropData();\r\n            }\r\n        }\r\n        const result = this.dnd.onDragOver(this.currentDragData, event.element, event.index, event.browserEvent);\r\n        this.canDrop = typeof result === 'boolean' ? result : result.accept;\r\n        if (!this.canDrop) {\r\n            this.currentDragFeedback = undefined;\r\n            this.currentDragFeedbackDisposable.dispose();\r\n            return false;\r\n        }\r\n        event.browserEvent.dataTransfer.dropEffect = (typeof result !== 'boolean' && result.effect === 0 /* Copy */) ? 'copy' : 'move';\r\n        let feedback;\r\n        if (typeof result !== 'boolean' && result.feedback) {\r\n            feedback = result.feedback;\r\n        }\r\n        else {\r\n            if (typeof event.index === 'undefined') {\r\n                feedback = [-1];\r\n            }\r\n            else {\r\n                feedback = [event.index];\r\n            }\r\n        }\r\n        // sanitize feedback list\r\n        feedback = distinct(feedback).filter(i => i >= -1 && i < this.length).sort((a, b) => a - b);\r\n        feedback = feedback[0] === -1 ? [-1] : feedback;\r\n        if (equalsDragFeedback(this.currentDragFeedback, feedback)) {\r\n            return true;\r\n        }\r\n        this.currentDragFeedback = feedback;\r\n        this.currentDragFeedbackDisposable.dispose();\r\n        if (feedback[0] === -1) { // entire list feedback\r\n            this.domNode.classList.add('drop-target');\r\n            this.rowsContainer.classList.add('drop-target');\r\n            this.currentDragFeedbackDisposable = toDisposable(() => {\r\n                this.domNode.classList.remove('drop-target');\r\n                this.rowsContainer.classList.remove('drop-target');\r\n            });\r\n        }\r\n        else {\r\n            for (const index of feedback) {\r\n                const item = this.items[index];\r\n                item.dropTarget = true;\r\n                if (item.row) {\r\n                    item.row.domNode.classList.add('drop-target');\r\n                }\r\n            }\r\n            this.currentDragFeedbackDisposable = toDisposable(() => {\r\n                for (const index of feedback) {\r\n                    const item = this.items[index];\r\n                    item.dropTarget = false;\r\n                    if (item.row) {\r\n                        item.row.domNode.classList.remove('drop-target');\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        return true;\r\n    }\r\n    onDragLeave() {\r\n        this.onDragLeaveTimeout.dispose();\r\n        this.onDragLeaveTimeout = disposableTimeout(() => this.clearDragOverFeedback(), 100);\r\n    }\r\n    onDrop(event) {\r\n        if (!this.canDrop) {\r\n            return;\r\n        }\r\n        const dragData = this.currentDragData;\r\n        this.teardownDragAndDropScrollTopAnimation();\r\n        this.clearDragOverFeedback();\r\n        this.currentDragData = undefined;\r\n        StaticDND.CurrentDragAndDropData = undefined;\r\n        if (!dragData || !event.browserEvent.dataTransfer) {\r\n            return;\r\n        }\r\n        event.browserEvent.preventDefault();\r\n        dragData.update(event.browserEvent.dataTransfer);\r\n        this.dnd.drop(dragData, event.element, event.index, event.browserEvent);\r\n    }\r\n    onDragEnd(event) {\r\n        this.canDrop = false;\r\n        this.teardownDragAndDropScrollTopAnimation();\r\n        this.clearDragOverFeedback();\r\n        this.currentDragData = undefined;\r\n        StaticDND.CurrentDragAndDropData = undefined;\r\n        if (this.dnd.onDragEnd) {\r\n            this.dnd.onDragEnd(event);\r\n        }\r\n    }\r\n    clearDragOverFeedback() {\r\n        this.currentDragFeedback = undefined;\r\n        this.currentDragFeedbackDisposable.dispose();\r\n        this.currentDragFeedbackDisposable = Disposable.None;\r\n    }\r\n    // DND scroll top animation\r\n    setupDragAndDropScrollTopAnimation(event) {\r\n        if (!this.dragOverAnimationDisposable) {\r\n            const viewTop = getTopLeftOffset(this.domNode).top;\r\n            this.dragOverAnimationDisposable = animate(this.animateDragAndDropScrollTop.bind(this, viewTop));\r\n        }\r\n        this.dragOverAnimationStopDisposable.dispose();\r\n        this.dragOverAnimationStopDisposable = disposableTimeout(() => {\r\n            if (this.dragOverAnimationDisposable) {\r\n                this.dragOverAnimationDisposable.dispose();\r\n                this.dragOverAnimationDisposable = undefined;\r\n            }\r\n        }, 1000);\r\n        this.dragOverMouseY = event.pageY;\r\n    }\r\n    animateDragAndDropScrollTop(viewTop) {\r\n        if (this.dragOverMouseY === undefined) {\r\n            return;\r\n        }\r\n        const diff = this.dragOverMouseY - viewTop;\r\n        const upperLimit = this.renderHeight - 35;\r\n        if (diff < 35) {\r\n            this.scrollTop += Math.max(-14, Math.floor(0.3 * (diff - 35)));\r\n        }\r\n        else if (diff > upperLimit) {\r\n            this.scrollTop += Math.min(14, Math.floor(0.3 * (diff - upperLimit)));\r\n        }\r\n    }\r\n    teardownDragAndDropScrollTopAnimation() {\r\n        this.dragOverAnimationStopDisposable.dispose();\r\n        if (this.dragOverAnimationDisposable) {\r\n            this.dragOverAnimationDisposable.dispose();\r\n            this.dragOverAnimationDisposable = undefined;\r\n        }\r\n    }\r\n    // Util\r\n    getItemIndexFromEventTarget(target) {\r\n        const scrollableElement = this.scrollableElement.getDomNode();\r\n        let element = target;\r\n        while (element instanceof HTMLElement && element !== this.rowsContainer && scrollableElement.contains(element)) {\r\n            const rawIndex = element.getAttribute('data-index');\r\n            if (rawIndex) {\r\n                const index = Number(rawIndex);\r\n                if (!isNaN(index)) {\r\n                    return index;\r\n                }\r\n            }\r\n            element = element.parentElement;\r\n        }\r\n        return undefined;\r\n    }\r\n    getRenderRange(renderTop, renderHeight) {\r\n        return {\r\n            start: this.rangeMap.indexAt(renderTop),\r\n            end: this.rangeMap.indexAfter(renderTop + renderHeight - 1)\r\n        };\r\n    }\r\n    /**\r\n     * Given a stable rendered state, checks every rendered element whether it needs\r\n     * to be probed for dynamic height. Adjusts scroll height and top if necessary.\r\n     */\r\n    _rerender(renderTop, renderHeight, inSmoothScrolling) {\r\n        const previousRenderRange = this.getRenderRange(renderTop, renderHeight);\r\n        // Let's remember the second element's position, this helps in scrolling up\r\n        // and preserving a linear upwards scroll movement\r\n        let anchorElementIndex;\r\n        let anchorElementTopDelta;\r\n        if (renderTop === this.elementTop(previousRenderRange.start)) {\r\n            anchorElementIndex = previousRenderRange.start;\r\n            anchorElementTopDelta = 0;\r\n        }\r\n        else if (previousRenderRange.end - previousRenderRange.start > 1) {\r\n            anchorElementIndex = previousRenderRange.start + 1;\r\n            anchorElementTopDelta = this.elementTop(anchorElementIndex) - renderTop;\r\n        }\r\n        let heightDiff = 0;\r\n        while (true) {\r\n            const renderRange = this.getRenderRange(renderTop, renderHeight);\r\n            let didChange = false;\r\n            for (let i = renderRange.start; i < renderRange.end; i++) {\r\n                const diff = this.probeDynamicHeight(i);\r\n                if (diff !== 0) {\r\n                    this.rangeMap.splice(i, 1, [this.items[i]]);\r\n                }\r\n                heightDiff += diff;\r\n                didChange = didChange || diff !== 0;\r\n            }\r\n            if (!didChange) {\r\n                if (heightDiff !== 0) {\r\n                    this.eventuallyUpdateScrollDimensions();\r\n                }\r\n                const unrenderRanges = Range.relativeComplement(previousRenderRange, renderRange);\r\n                for (const range of unrenderRanges) {\r\n                    for (let i = range.start; i < range.end; i++) {\r\n                        if (this.items[i].row) {\r\n                            this.removeItemFromDOM(i);\r\n                        }\r\n                    }\r\n                }\r\n                const renderRanges = Range.relativeComplement(renderRange, previousRenderRange);\r\n                for (const range of renderRanges) {\r\n                    for (let i = range.start; i < range.end; i++) {\r\n                        const afterIndex = i + 1;\r\n                        const beforeRow = afterIndex < this.items.length ? this.items[afterIndex].row : null;\r\n                        const beforeElement = beforeRow ? beforeRow.domNode : null;\r\n                        this.insertItemInDOM(i, beforeElement);\r\n                    }\r\n                }\r\n                for (let i = renderRange.start; i < renderRange.end; i++) {\r\n                    if (this.items[i].row) {\r\n                        this.updateItemInDOM(this.items[i], i);\r\n                    }\r\n                }\r\n                if (typeof anchorElementIndex === 'number') {\r\n                    // To compute a destination scroll top, we need to take into account the current smooth scrolling\r\n                    // animation, and then reuse it with a new target (to avoid prolonging the scroll)\r\n                    // See https://github.com/microsoft/vscode/issues/104144\r\n                    // See https://github.com/microsoft/vscode/pull/104284\r\n                    // See https://github.com/microsoft/vscode/issues/107704\r\n                    const deltaScrollTop = this.scrollable.getFutureScrollPosition().scrollTop - renderTop;\r\n                    const newScrollTop = this.elementTop(anchorElementIndex) - anchorElementTopDelta + deltaScrollTop;\r\n                    this.setScrollTop(newScrollTop, inSmoothScrolling);\r\n                }\r\n                this._onDidChangeContentHeight.fire(this.contentHeight);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n    probeDynamicHeight(index) {\r\n        const item = this.items[index];\r\n        if (!item.hasDynamicHeight || item.lastDynamicHeightWidth === this.renderWidth) {\r\n            return 0;\r\n        }\r\n        if (!!this.virtualDelegate.hasDynamicHeight && !this.virtualDelegate.hasDynamicHeight(item.element)) {\r\n            return 0;\r\n        }\r\n        const size = item.size;\r\n        if (!this.setRowHeight && item.row) {\r\n            let newSize = item.row.domNode.offsetHeight;\r\n            item.size = newSize;\r\n            item.lastDynamicHeightWidth = this.renderWidth;\r\n            return newSize - size;\r\n        }\r\n        const row = this.cache.alloc(item.templateId);\r\n        row.domNode.style.height = '';\r\n        this.rowsContainer.appendChild(row.domNode);\r\n        const renderer = this.renderers.get(item.templateId);\r\n        if (renderer) {\r\n            renderer.renderElement(item.element, index, row.templateData, undefined);\r\n            if (renderer.disposeElement) {\r\n                renderer.disposeElement(item.element, index, row.templateData, undefined);\r\n            }\r\n        }\r\n        item.size = row.domNode.offsetHeight;\r\n        if (this.virtualDelegate.setDynamicHeight) {\r\n            this.virtualDelegate.setDynamicHeight(item.element, item.size);\r\n        }\r\n        item.lastDynamicHeightWidth = this.renderWidth;\r\n        this.rowsContainer.removeChild(row.domNode);\r\n        this.cache.release(row);\r\n        return item.size - size;\r\n    }\r\n    getNextToLastElement(ranges) {\r\n        const lastRange = ranges[ranges.length - 1];\r\n        if (!lastRange) {\r\n            return null;\r\n        }\r\n        const nextToLastItem = this.items[lastRange.end];\r\n        if (!nextToLastItem) {\r\n            return null;\r\n        }\r\n        if (!nextToLastItem.row) {\r\n            return null;\r\n        }\r\n        return nextToLastItem.row.domNode;\r\n    }\r\n    getElementDomId(index) {\r\n        return `${this.domId}_${index}`;\r\n    }\r\n    // Dispose\r\n    dispose() {\r\n        if (this.items) {\r\n            for (const item of this.items) {\r\n                if (item.row) {\r\n                    const renderer = this.renderers.get(item.row.templateId);\r\n                    if (renderer) {\r\n                        if (renderer.disposeElement) {\r\n                            renderer.disposeElement(item.element, -1, item.row.templateData, undefined);\r\n                        }\r\n                        renderer.disposeTemplate(item.row.templateData);\r\n                    }\r\n                }\r\n            }\r\n            this.items = [];\r\n        }\r\n        if (this.domNode && this.domNode.parentNode) {\r\n            this.domNode.parentNode.removeChild(this.domNode);\r\n        }\r\n        dispose(this.disposables);\r\n    }\r\n}\r\nListView.InstanceCount = 0;\r\n__decorate([\r\n    memoize\r\n], ListView.prototype, \"onMouseClick\", null);\r\n__decorate([\r\n    memoize\r\n], ListView.prototype, \"onMouseDblClick\", null);\r\n__decorate([\r\n    memoize\r\n], ListView.prototype, \"onMouseMiddleClick\", null);\r\n__decorate([\r\n    memoize\r\n], ListView.prototype, \"onMouseDown\", null);\r\n__decorate([\r\n    memoize\r\n], ListView.prototype, \"onContextMenu\", null);\r\n__decorate([\r\n    memoize\r\n], ListView.prototype, \"onTouchStart\", null);\r\n__decorate([\r\n    memoize\r\n], ListView.prototype, \"onTap\", null);\r\n"]},"metadata":{},"sourceType":"module"}