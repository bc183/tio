{"ast":null,"code":"import _classCallCheck from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _get from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/get\";\nimport _inherits from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\n/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\nimport './contextview.css';\nimport * as DOM from '../../dom.js';\nimport * as platform from '../../../common/platform.js';\nimport { toDisposable, Disposable, DisposableStore } from '../../../common/lifecycle.js';\nimport { Range } from '../../../common/range.js';\nimport { BrowserFeatures } from '../../canIUse.js';\nexport var LayoutAnchorMode;\n\n(function (LayoutAnchorMode) {\n  LayoutAnchorMode[LayoutAnchorMode[\"AVOID\"] = 0] = \"AVOID\";\n  LayoutAnchorMode[LayoutAnchorMode[\"ALIGN\"] = 1] = \"ALIGN\";\n})(LayoutAnchorMode || (LayoutAnchorMode = {}));\n/**\r\n * Lays out a one dimensional view next to an anchor in a viewport.\r\n *\r\n * @returns The view offset within the viewport.\r\n */\n\n\nexport function layout(viewportSize, viewSize, anchor) {\n  var layoutAfterAnchorBoundary = anchor.mode === LayoutAnchorMode.ALIGN ? anchor.offset : anchor.offset + anchor.size;\n  var layoutBeforeAnchorBoundary = anchor.mode === LayoutAnchorMode.ALIGN ? anchor.offset + anchor.size : anchor.offset;\n\n  if (anchor.position === 0\n  /* Before */\n  ) {\n      if (viewSize <= viewportSize - layoutAfterAnchorBoundary) {\n        return layoutAfterAnchorBoundary; // happy case, lay it out after the anchor\n      }\n\n      if (viewSize <= layoutBeforeAnchorBoundary) {\n        return layoutBeforeAnchorBoundary - viewSize; // ok case, lay it out before the anchor\n      }\n\n      return Math.max(viewportSize - viewSize, 0); // sad case, lay it over the anchor\n    } else {\n    if (viewSize <= layoutBeforeAnchorBoundary) {\n      return layoutBeforeAnchorBoundary - viewSize; // happy case, lay it out before the anchor\n    }\n\n    if (viewSize <= viewportSize - layoutAfterAnchorBoundary) {\n      return layoutAfterAnchorBoundary; // ok case, lay it out after the anchor\n    }\n\n    return 0; // sad case, lay it over the anchor\n  }\n}\nexport var ContextView = /*#__PURE__*/function (_Disposable) {\n  _inherits(ContextView, _Disposable);\n\n  var _super = _createSuper(ContextView);\n\n  function ContextView(container, domPosition) {\n    var _this;\n\n    _classCallCheck(this, ContextView);\n\n    _this = _super.call(this);\n    _this.container = null;\n    _this.delegate = null;\n    _this.toDisposeOnClean = Disposable.None;\n    _this.toDisposeOnSetContainer = Disposable.None;\n    _this.shadowRoot = null;\n    _this.shadowRootHostElement = null;\n    _this.view = DOM.$('.context-view');\n    _this.useFixedPosition = false;\n    _this.useShadowDOM = false;\n    DOM.hide(_this.view);\n\n    _this.setContainer(container, domPosition);\n\n    _this._register(toDisposable(function () {\n      return _this.setContainer(null, 1\n      /* ABSOLUTE */\n      );\n    }));\n\n    return _this;\n  }\n\n  _createClass(ContextView, [{\n    key: \"setContainer\",\n    value: function setContainer(container, domPosition) {\n      var _this2 = this;\n\n      var _a;\n\n      if (this.container) {\n        this.toDisposeOnSetContainer.dispose();\n\n        if (this.shadowRoot) {\n          this.shadowRoot.removeChild(this.view);\n          this.shadowRoot = null;\n          (_a = this.shadowRootHostElement) === null || _a === void 0 ? void 0 : _a.remove();\n          this.shadowRootHostElement = null;\n        } else {\n          this.container.removeChild(this.view);\n        }\n\n        this.container = null;\n      }\n\n      if (container) {\n        this.container = container;\n        this.useFixedPosition = domPosition !== 1\n        /* ABSOLUTE */\n        ;\n        this.useShadowDOM = domPosition === 3\n        /* FIXED_SHADOW */\n        ;\n\n        if (this.useShadowDOM) {\n          this.shadowRootHostElement = DOM.$('.shadow-root-host');\n          this.container.appendChild(this.shadowRootHostElement);\n          this.shadowRoot = this.shadowRootHostElement.attachShadow({\n            mode: 'open'\n          });\n          var style = document.createElement('style');\n          style.textContent = SHADOW_ROOT_CSS;\n          this.shadowRoot.appendChild(style);\n          this.shadowRoot.appendChild(this.view);\n          this.shadowRoot.appendChild(DOM.$('slot'));\n        } else {\n          this.container.appendChild(this.view);\n        }\n\n        var toDisposeOnSetContainer = new DisposableStore();\n        ContextView.BUBBLE_UP_EVENTS.forEach(function (event) {\n          toDisposeOnSetContainer.add(DOM.addStandardDisposableListener(_this2.container, event, function (e) {\n            _this2.onDOMEvent(e, false);\n          }));\n        });\n        ContextView.BUBBLE_DOWN_EVENTS.forEach(function (event) {\n          toDisposeOnSetContainer.add(DOM.addStandardDisposableListener(_this2.container, event, function (e) {\n            _this2.onDOMEvent(e, true);\n          }, true));\n        });\n        this.toDisposeOnSetContainer = toDisposeOnSetContainer;\n      }\n    }\n  }, {\n    key: \"show\",\n    value: function show(delegate) {\n      if (this.isVisible()) {\n        this.hide();\n      } // Show static box\n\n\n      DOM.clearNode(this.view);\n      this.view.className = 'context-view';\n      this.view.style.top = '0px';\n      this.view.style.left = '0px';\n      this.view.style.zIndex = '2500';\n      this.view.style.position = this.useFixedPosition ? 'fixed' : 'absolute';\n      DOM.show(this.view); // Render content\n\n      this.toDisposeOnClean = delegate.render(this.view) || Disposable.None; // Set active delegate\n\n      this.delegate = delegate; // Layout\n\n      this.doLayout(); // Focus\n\n      if (this.delegate.focus) {\n        this.delegate.focus();\n      }\n    }\n  }, {\n    key: \"getViewElement\",\n    value: function getViewElement() {\n      return this.view;\n    }\n  }, {\n    key: \"layout\",\n    value: function layout() {\n      if (!this.isVisible()) {\n        return;\n      }\n\n      if (this.delegate.canRelayout === false && !(platform.isIOS && BrowserFeatures.pointerEvents)) {\n        this.hide();\n        return;\n      }\n\n      if (this.delegate.layout) {\n        this.delegate.layout();\n      }\n\n      this.doLayout();\n    }\n  }, {\n    key: \"doLayout\",\n    value: function doLayout() {\n      // Check that we still have a delegate - this.delegate.layout may have hidden\n      if (!this.isVisible()) {\n        return;\n      } // Get anchor\n\n\n      var anchor = this.delegate.getAnchor(); // Compute around\n\n      var around; // Get the element's position and size (to anchor the view)\n\n      if (DOM.isHTMLElement(anchor)) {\n        var elementPosition = DOM.getDomNodePagePosition(anchor);\n        around = {\n          top: elementPosition.top,\n          left: elementPosition.left,\n          width: elementPosition.width,\n          height: elementPosition.height\n        };\n      } else {\n        around = {\n          top: anchor.y,\n          left: anchor.x,\n          width: anchor.width || 1,\n          height: anchor.height || 2\n        };\n      }\n\n      var viewSizeWidth = DOM.getTotalWidth(this.view);\n      var viewSizeHeight = DOM.getTotalHeight(this.view);\n      var anchorPosition = this.delegate.anchorPosition || 0\n      /* BELOW */\n      ;\n      var anchorAlignment = this.delegate.anchorAlignment || 0\n      /* LEFT */\n      ;\n      var anchorAxisAlignment = this.delegate.anchorAxisAlignment || 0\n      /* VERTICAL */\n      ;\n      var top;\n      var left;\n\n      if (anchorAxisAlignment === 0\n      /* VERTICAL */\n      ) {\n          var verticalAnchor = {\n            offset: around.top - window.pageYOffset,\n            size: around.height,\n            position: anchorPosition === 0\n            /* BELOW */\n            ? 0\n            /* Before */\n            : 1\n            /* After */\n\n          };\n          var horizontalAnchor = {\n            offset: around.left,\n            size: around.width,\n            position: anchorAlignment === 0\n            /* LEFT */\n            ? 0\n            /* Before */\n            : 1\n            /* After */\n            ,\n            mode: LayoutAnchorMode.ALIGN\n          };\n          top = layout(window.innerHeight, viewSizeHeight, verticalAnchor) + window.pageYOffset; // if view intersects vertically with anchor,  we must avoid the anchor\n\n          if (Range.intersects({\n            start: top,\n            end: top + viewSizeHeight\n          }, {\n            start: verticalAnchor.offset,\n            end: verticalAnchor.offset + verticalAnchor.size\n          })) {\n            horizontalAnchor.mode = LayoutAnchorMode.AVOID;\n          }\n\n          left = layout(window.innerWidth, viewSizeWidth, horizontalAnchor);\n        } else {\n        var _horizontalAnchor = {\n          offset: around.left,\n          size: around.width,\n          position: anchorAlignment === 0\n          /* LEFT */\n          ? 0\n          /* Before */\n          : 1\n          /* After */\n\n        };\n        var _verticalAnchor = {\n          offset: around.top,\n          size: around.height,\n          position: anchorPosition === 0\n          /* BELOW */\n          ? 0\n          /* Before */\n          : 1\n          /* After */\n          ,\n          mode: LayoutAnchorMode.ALIGN\n        };\n        left = layout(window.innerWidth, viewSizeWidth, _horizontalAnchor); // if view intersects horizontally with anchor, we must avoid the anchor\n\n        if (Range.intersects({\n          start: left,\n          end: left + viewSizeWidth\n        }, {\n          start: _horizontalAnchor.offset,\n          end: _horizontalAnchor.offset + _horizontalAnchor.size\n        })) {\n          _verticalAnchor.mode = LayoutAnchorMode.AVOID;\n        }\n\n        top = layout(window.innerHeight, viewSizeHeight, _verticalAnchor) + window.pageYOffset;\n      }\n\n      this.view.classList.remove('top', 'bottom', 'left', 'right');\n      this.view.classList.add(anchorPosition === 0\n      /* BELOW */\n      ? 'bottom' : 'top');\n      this.view.classList.add(anchorAlignment === 0\n      /* LEFT */\n      ? 'left' : 'right');\n      this.view.classList.toggle('fixed', this.useFixedPosition);\n      var containerPosition = DOM.getDomNodePagePosition(this.container);\n      this.view.style.top = \"\".concat(top - (this.useFixedPosition ? DOM.getDomNodePagePosition(this.view).top : containerPosition.top), \"px\");\n      this.view.style.left = \"\".concat(left - (this.useFixedPosition ? DOM.getDomNodePagePosition(this.view).left : containerPosition.left), \"px\");\n      this.view.style.width = 'initial';\n    }\n  }, {\n    key: \"hide\",\n    value: function hide(data) {\n      var delegate = this.delegate;\n      this.delegate = null;\n\n      if (delegate === null || delegate === void 0 ? void 0 : delegate.onHide) {\n        delegate.onHide(data);\n      }\n\n      this.toDisposeOnClean.dispose();\n      DOM.hide(this.view);\n    }\n  }, {\n    key: \"isVisible\",\n    value: function isVisible() {\n      return !!this.delegate;\n    }\n  }, {\n    key: \"onDOMEvent\",\n    value: function onDOMEvent(e, onCapture) {\n      if (this.delegate) {\n        if (this.delegate.onDOMEvent) {\n          this.delegate.onDOMEvent(e, document.activeElement);\n        } else if (onCapture && !DOM.isAncestor(e.target, this.container)) {\n          this.hide();\n        }\n      }\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      this.hide();\n\n      _get(_getPrototypeOf(ContextView.prototype), \"dispose\", this).call(this);\n    }\n  }]);\n\n  return ContextView;\n}(Disposable);\nContextView.BUBBLE_UP_EVENTS = ['click', 'keydown', 'focus', 'blur'];\nContextView.BUBBLE_DOWN_EVENTS = ['click'];\nvar SHADOW_ROOT_CSS =\n/* css */\n\"\\n\\t:host {\\n\\t\\tall: initial; /* 1st rule so subsequent properties are reset. */\\n\\t}\\n\\n\\t@font-face {\\n\\t\\tfont-family: \\\"codicon\\\";\\n\\t\\tsrc: url(\\\"./codicon.ttf?5d4d76ab2ce5108968ad644d591a16a6\\\") format(\\\"truetype\\\");\\n\\t}\\n\\n\\t.codicon[class*='codicon-'] {\\n\\t\\tfont: normal normal normal 16px/1 codicon;\\n\\t\\tdisplay: inline-block;\\n\\t\\ttext-decoration: none;\\n\\t\\ttext-rendering: auto;\\n\\t\\ttext-align: center;\\n\\t\\t-webkit-font-smoothing: antialiased;\\n\\t\\t-moz-osx-font-smoothing: grayscale;\\n\\t\\tuser-select: none;\\n\\t\\t-webkit-user-select: none;\\n\\t\\t-ms-user-select: none;\\n\\t}\\n\\n\\t:host {\\n\\t\\tfont-family: -apple-system, BlinkMacSystemFont, \\\"Segoe WPC\\\", \\\"Segoe UI\\\", \\\"HelveticaNeue-Light\\\", system-ui, \\\"Ubuntu\\\", \\\"Droid Sans\\\", sans-serif;\\n\\t}\\n\\n\\t:host-context(.mac) { font-family: -apple-system, BlinkMacSystemFont, sans-serif; }\\n\\t:host-context(.mac:lang(zh-Hans)) { font-family: -apple-system, BlinkMacSystemFont, \\\"PingFang SC\\\", \\\"Hiragino Sans GB\\\", sans-serif; }\\n\\t:host-context(.mac:lang(zh-Hant)) { font-family: -apple-system, BlinkMacSystemFont, \\\"PingFang TC\\\", sans-serif; }\\n\\t:host-context(.mac:lang(ja)) { font-family: -apple-system, BlinkMacSystemFont, \\\"Hiragino Kaku Gothic Pro\\\", sans-serif; }\\n\\t:host-context(.mac:lang(ko)) { font-family: -apple-system, BlinkMacSystemFont, \\\"Nanum Gothic\\\", \\\"Apple SD Gothic Neo\\\", \\\"AppleGothic\\\", sans-serif; }\\n\\n\\t:host-context(.windows) { font-family: \\\"Segoe WPC\\\", \\\"Segoe UI\\\", sans-serif; }\\n\\t:host-context(.windows:lang(zh-Hans)) { font-family: \\\"Segoe WPC\\\", \\\"Segoe UI\\\", \\\"Microsoft YaHei\\\", sans-serif; }\\n\\t:host-context(.windows:lang(zh-Hant)) { font-family: \\\"Segoe WPC\\\", \\\"Segoe UI\\\", \\\"Microsoft Jhenghei\\\", sans-serif; }\\n\\t:host-context(.windows:lang(ja)) { font-family: \\\"Segoe WPC\\\", \\\"Segoe UI\\\", \\\"Yu Gothic UI\\\", \\\"Meiryo UI\\\", sans-serif; }\\n\\t:host-context(.windows:lang(ko)) { font-family: \\\"Segoe WPC\\\", \\\"Segoe UI\\\", \\\"Malgun Gothic\\\", \\\"Dotom\\\", sans-serif; }\\n\\n\\t:host-context(.linux) { font-family: system-ui, \\\"Ubuntu\\\", \\\"Droid Sans\\\", sans-serif; }\\n\\t:host-context(.linux:lang(zh-Hans)) { font-family: system-ui, \\\"Ubuntu\\\", \\\"Droid Sans\\\", \\\"Source Han Sans SC\\\", \\\"Source Han Sans CN\\\", \\\"Source Han Sans\\\", sans-serif; }\\n\\t:host-context(.linux:lang(zh-Hant)) { font-family: system-ui, \\\"Ubuntu\\\", \\\"Droid Sans\\\", \\\"Source Han Sans TC\\\", \\\"Source Han Sans TW\\\", \\\"Source Han Sans\\\", sans-serif; }\\n\\t:host-context(.linux:lang(ja)) { font-family: system-ui, \\\"Ubuntu\\\", \\\"Droid Sans\\\", \\\"Source Han Sans J\\\", \\\"Source Han Sans JP\\\", \\\"Source Han Sans\\\", sans-serif; }\\n\\t:host-context(.linux:lang(ko)) { font-family: system-ui, \\\"Ubuntu\\\", \\\"Droid Sans\\\", \\\"Source Han Sans K\\\", \\\"Source Han Sans JR\\\", \\\"Source Han Sans\\\", \\\"UnDotum\\\", \\\"FBaekmuk Gulim\\\", sans-serif; }\\n\";","map":{"version":3,"sources":["/home/bar007/Desktop/projects/tio/client/node_modules/monaco-editor/esm/vs/base/browser/ui/contextview/contextview.js"],"names":["DOM","platform","toDisposable","Disposable","DisposableStore","Range","BrowserFeatures","LayoutAnchorMode","layout","viewportSize","viewSize","anchor","layoutAfterAnchorBoundary","mode","ALIGN","offset","size","layoutBeforeAnchorBoundary","position","Math","max","ContextView","container","domPosition","delegate","toDisposeOnClean","None","toDisposeOnSetContainer","shadowRoot","shadowRootHostElement","view","$","useFixedPosition","useShadowDOM","hide","setContainer","_register","_a","dispose","removeChild","remove","appendChild","attachShadow","style","document","createElement","textContent","SHADOW_ROOT_CSS","BUBBLE_UP_EVENTS","forEach","event","add","addStandardDisposableListener","e","onDOMEvent","BUBBLE_DOWN_EVENTS","isVisible","clearNode","className","top","left","zIndex","show","render","doLayout","focus","canRelayout","isIOS","pointerEvents","getAnchor","around","isHTMLElement","elementPosition","getDomNodePagePosition","width","height","y","x","viewSizeWidth","getTotalWidth","viewSizeHeight","getTotalHeight","anchorPosition","anchorAlignment","anchorAxisAlignment","verticalAnchor","window","pageYOffset","horizontalAnchor","innerHeight","intersects","start","end","AVOID","innerWidth","classList","toggle","containerPosition","data","onHide","onCapture","activeElement","isAncestor","target"],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\r\n *  Copyright (c) Microsoft Corporation. All rights reserved.\r\n *  Licensed under the MIT License. See License.txt in the project root for license information.\r\n *--------------------------------------------------------------------------------------------*/\r\nimport './contextview.css';\r\nimport * as DOM from '../../dom.js';\r\nimport * as platform from '../../../common/platform.js';\r\nimport { toDisposable, Disposable, DisposableStore } from '../../../common/lifecycle.js';\r\nimport { Range } from '../../../common/range.js';\r\nimport { BrowserFeatures } from '../../canIUse.js';\r\nexport var LayoutAnchorMode;\r\n(function (LayoutAnchorMode) {\r\n    LayoutAnchorMode[LayoutAnchorMode[\"AVOID\"] = 0] = \"AVOID\";\r\n    LayoutAnchorMode[LayoutAnchorMode[\"ALIGN\"] = 1] = \"ALIGN\";\r\n})(LayoutAnchorMode || (LayoutAnchorMode = {}));\r\n/**\r\n * Lays out a one dimensional view next to an anchor in a viewport.\r\n *\r\n * @returns The view offset within the viewport.\r\n */\r\nexport function layout(viewportSize, viewSize, anchor) {\r\n    const layoutAfterAnchorBoundary = anchor.mode === LayoutAnchorMode.ALIGN ? anchor.offset : anchor.offset + anchor.size;\r\n    const layoutBeforeAnchorBoundary = anchor.mode === LayoutAnchorMode.ALIGN ? anchor.offset + anchor.size : anchor.offset;\r\n    if (anchor.position === 0 /* Before */) {\r\n        if (viewSize <= viewportSize - layoutAfterAnchorBoundary) {\r\n            return layoutAfterAnchorBoundary; // happy case, lay it out after the anchor\r\n        }\r\n        if (viewSize <= layoutBeforeAnchorBoundary) {\r\n            return layoutBeforeAnchorBoundary - viewSize; // ok case, lay it out before the anchor\r\n        }\r\n        return Math.max(viewportSize - viewSize, 0); // sad case, lay it over the anchor\r\n    }\r\n    else {\r\n        if (viewSize <= layoutBeforeAnchorBoundary) {\r\n            return layoutBeforeAnchorBoundary - viewSize; // happy case, lay it out before the anchor\r\n        }\r\n        if (viewSize <= viewportSize - layoutAfterAnchorBoundary) {\r\n            return layoutAfterAnchorBoundary; // ok case, lay it out after the anchor\r\n        }\r\n        return 0; // sad case, lay it over the anchor\r\n    }\r\n}\r\nexport class ContextView extends Disposable {\r\n    constructor(container, domPosition) {\r\n        super();\r\n        this.container = null;\r\n        this.delegate = null;\r\n        this.toDisposeOnClean = Disposable.None;\r\n        this.toDisposeOnSetContainer = Disposable.None;\r\n        this.shadowRoot = null;\r\n        this.shadowRootHostElement = null;\r\n        this.view = DOM.$('.context-view');\r\n        this.useFixedPosition = false;\r\n        this.useShadowDOM = false;\r\n        DOM.hide(this.view);\r\n        this.setContainer(container, domPosition);\r\n        this._register(toDisposable(() => this.setContainer(null, 1 /* ABSOLUTE */)));\r\n    }\r\n    setContainer(container, domPosition) {\r\n        var _a;\r\n        if (this.container) {\r\n            this.toDisposeOnSetContainer.dispose();\r\n            if (this.shadowRoot) {\r\n                this.shadowRoot.removeChild(this.view);\r\n                this.shadowRoot = null;\r\n                (_a = this.shadowRootHostElement) === null || _a === void 0 ? void 0 : _a.remove();\r\n                this.shadowRootHostElement = null;\r\n            }\r\n            else {\r\n                this.container.removeChild(this.view);\r\n            }\r\n            this.container = null;\r\n        }\r\n        if (container) {\r\n            this.container = container;\r\n            this.useFixedPosition = domPosition !== 1 /* ABSOLUTE */;\r\n            this.useShadowDOM = domPosition === 3 /* FIXED_SHADOW */;\r\n            if (this.useShadowDOM) {\r\n                this.shadowRootHostElement = DOM.$('.shadow-root-host');\r\n                this.container.appendChild(this.shadowRootHostElement);\r\n                this.shadowRoot = this.shadowRootHostElement.attachShadow({ mode: 'open' });\r\n                const style = document.createElement('style');\r\n                style.textContent = SHADOW_ROOT_CSS;\r\n                this.shadowRoot.appendChild(style);\r\n                this.shadowRoot.appendChild(this.view);\r\n                this.shadowRoot.appendChild(DOM.$('slot'));\r\n            }\r\n            else {\r\n                this.container.appendChild(this.view);\r\n            }\r\n            const toDisposeOnSetContainer = new DisposableStore();\r\n            ContextView.BUBBLE_UP_EVENTS.forEach(event => {\r\n                toDisposeOnSetContainer.add(DOM.addStandardDisposableListener(this.container, event, (e) => {\r\n                    this.onDOMEvent(e, false);\r\n                }));\r\n            });\r\n            ContextView.BUBBLE_DOWN_EVENTS.forEach(event => {\r\n                toDisposeOnSetContainer.add(DOM.addStandardDisposableListener(this.container, event, (e) => {\r\n                    this.onDOMEvent(e, true);\r\n                }, true));\r\n            });\r\n            this.toDisposeOnSetContainer = toDisposeOnSetContainer;\r\n        }\r\n    }\r\n    show(delegate) {\r\n        if (this.isVisible()) {\r\n            this.hide();\r\n        }\r\n        // Show static box\r\n        DOM.clearNode(this.view);\r\n        this.view.className = 'context-view';\r\n        this.view.style.top = '0px';\r\n        this.view.style.left = '0px';\r\n        this.view.style.zIndex = '2500';\r\n        this.view.style.position = this.useFixedPosition ? 'fixed' : 'absolute';\r\n        DOM.show(this.view);\r\n        // Render content\r\n        this.toDisposeOnClean = delegate.render(this.view) || Disposable.None;\r\n        // Set active delegate\r\n        this.delegate = delegate;\r\n        // Layout\r\n        this.doLayout();\r\n        // Focus\r\n        if (this.delegate.focus) {\r\n            this.delegate.focus();\r\n        }\r\n    }\r\n    getViewElement() {\r\n        return this.view;\r\n    }\r\n    layout() {\r\n        if (!this.isVisible()) {\r\n            return;\r\n        }\r\n        if (this.delegate.canRelayout === false && !(platform.isIOS && BrowserFeatures.pointerEvents)) {\r\n            this.hide();\r\n            return;\r\n        }\r\n        if (this.delegate.layout) {\r\n            this.delegate.layout();\r\n        }\r\n        this.doLayout();\r\n    }\r\n    doLayout() {\r\n        // Check that we still have a delegate - this.delegate.layout may have hidden\r\n        if (!this.isVisible()) {\r\n            return;\r\n        }\r\n        // Get anchor\r\n        let anchor = this.delegate.getAnchor();\r\n        // Compute around\r\n        let around;\r\n        // Get the element's position and size (to anchor the view)\r\n        if (DOM.isHTMLElement(anchor)) {\r\n            let elementPosition = DOM.getDomNodePagePosition(anchor);\r\n            around = {\r\n                top: elementPosition.top,\r\n                left: elementPosition.left,\r\n                width: elementPosition.width,\r\n                height: elementPosition.height\r\n            };\r\n        }\r\n        else {\r\n            around = {\r\n                top: anchor.y,\r\n                left: anchor.x,\r\n                width: anchor.width || 1,\r\n                height: anchor.height || 2\r\n            };\r\n        }\r\n        const viewSizeWidth = DOM.getTotalWidth(this.view);\r\n        const viewSizeHeight = DOM.getTotalHeight(this.view);\r\n        const anchorPosition = this.delegate.anchorPosition || 0 /* BELOW */;\r\n        const anchorAlignment = this.delegate.anchorAlignment || 0 /* LEFT */;\r\n        const anchorAxisAlignment = this.delegate.anchorAxisAlignment || 0 /* VERTICAL */;\r\n        let top;\r\n        let left;\r\n        if (anchorAxisAlignment === 0 /* VERTICAL */) {\r\n            const verticalAnchor = { offset: around.top - window.pageYOffset, size: around.height, position: anchorPosition === 0 /* BELOW */ ? 0 /* Before */ : 1 /* After */ };\r\n            const horizontalAnchor = { offset: around.left, size: around.width, position: anchorAlignment === 0 /* LEFT */ ? 0 /* Before */ : 1 /* After */, mode: LayoutAnchorMode.ALIGN };\r\n            top = layout(window.innerHeight, viewSizeHeight, verticalAnchor) + window.pageYOffset;\r\n            // if view intersects vertically with anchor,  we must avoid the anchor\r\n            if (Range.intersects({ start: top, end: top + viewSizeHeight }, { start: verticalAnchor.offset, end: verticalAnchor.offset + verticalAnchor.size })) {\r\n                horizontalAnchor.mode = LayoutAnchorMode.AVOID;\r\n            }\r\n            left = layout(window.innerWidth, viewSizeWidth, horizontalAnchor);\r\n        }\r\n        else {\r\n            const horizontalAnchor = { offset: around.left, size: around.width, position: anchorAlignment === 0 /* LEFT */ ? 0 /* Before */ : 1 /* After */ };\r\n            const verticalAnchor = { offset: around.top, size: around.height, position: anchorPosition === 0 /* BELOW */ ? 0 /* Before */ : 1 /* After */, mode: LayoutAnchorMode.ALIGN };\r\n            left = layout(window.innerWidth, viewSizeWidth, horizontalAnchor);\r\n            // if view intersects horizontally with anchor, we must avoid the anchor\r\n            if (Range.intersects({ start: left, end: left + viewSizeWidth }, { start: horizontalAnchor.offset, end: horizontalAnchor.offset + horizontalAnchor.size })) {\r\n                verticalAnchor.mode = LayoutAnchorMode.AVOID;\r\n            }\r\n            top = layout(window.innerHeight, viewSizeHeight, verticalAnchor) + window.pageYOffset;\r\n        }\r\n        this.view.classList.remove('top', 'bottom', 'left', 'right');\r\n        this.view.classList.add(anchorPosition === 0 /* BELOW */ ? 'bottom' : 'top');\r\n        this.view.classList.add(anchorAlignment === 0 /* LEFT */ ? 'left' : 'right');\r\n        this.view.classList.toggle('fixed', this.useFixedPosition);\r\n        const containerPosition = DOM.getDomNodePagePosition(this.container);\r\n        this.view.style.top = `${top - (this.useFixedPosition ? DOM.getDomNodePagePosition(this.view).top : containerPosition.top)}px`;\r\n        this.view.style.left = `${left - (this.useFixedPosition ? DOM.getDomNodePagePosition(this.view).left : containerPosition.left)}px`;\r\n        this.view.style.width = 'initial';\r\n    }\r\n    hide(data) {\r\n        const delegate = this.delegate;\r\n        this.delegate = null;\r\n        if (delegate === null || delegate === void 0 ? void 0 : delegate.onHide) {\r\n            delegate.onHide(data);\r\n        }\r\n        this.toDisposeOnClean.dispose();\r\n        DOM.hide(this.view);\r\n    }\r\n    isVisible() {\r\n        return !!this.delegate;\r\n    }\r\n    onDOMEvent(e, onCapture) {\r\n        if (this.delegate) {\r\n            if (this.delegate.onDOMEvent) {\r\n                this.delegate.onDOMEvent(e, document.activeElement);\r\n            }\r\n            else if (onCapture && !DOM.isAncestor(e.target, this.container)) {\r\n                this.hide();\r\n            }\r\n        }\r\n    }\r\n    dispose() {\r\n        this.hide();\r\n        super.dispose();\r\n    }\r\n}\r\nContextView.BUBBLE_UP_EVENTS = ['click', 'keydown', 'focus', 'blur'];\r\nContextView.BUBBLE_DOWN_EVENTS = ['click'];\r\nlet SHADOW_ROOT_CSS = /* css */ `\n\t:host {\n\t\tall: initial; /* 1st rule so subsequent properties are reset. */\n\t}\n\n\t@font-face {\n\t\tfont-family: \"codicon\";\n\t\tsrc: url(\"./codicon.ttf?5d4d76ab2ce5108968ad644d591a16a6\") format(\"truetype\");\n\t}\n\n\t.codicon[class*='codicon-'] {\n\t\tfont: normal normal normal 16px/1 codicon;\n\t\tdisplay: inline-block;\n\t\ttext-decoration: none;\n\t\ttext-rendering: auto;\n\t\ttext-align: center;\n\t\t-webkit-font-smoothing: antialiased;\n\t\t-moz-osx-font-smoothing: grayscale;\n\t\tuser-select: none;\n\t\t-webkit-user-select: none;\n\t\t-ms-user-select: none;\n\t}\n\n\t:host {\n\t\tfont-family: -apple-system, BlinkMacSystemFont, \"Segoe WPC\", \"Segoe UI\", \"HelveticaNeue-Light\", system-ui, \"Ubuntu\", \"Droid Sans\", sans-serif;\n\t}\n\n\t:host-context(.mac) { font-family: -apple-system, BlinkMacSystemFont, sans-serif; }\n\t:host-context(.mac:lang(zh-Hans)) { font-family: -apple-system, BlinkMacSystemFont, \"PingFang SC\", \"Hiragino Sans GB\", sans-serif; }\n\t:host-context(.mac:lang(zh-Hant)) { font-family: -apple-system, BlinkMacSystemFont, \"PingFang TC\", sans-serif; }\n\t:host-context(.mac:lang(ja)) { font-family: -apple-system, BlinkMacSystemFont, \"Hiragino Kaku Gothic Pro\", sans-serif; }\n\t:host-context(.mac:lang(ko)) { font-family: -apple-system, BlinkMacSystemFont, \"Nanum Gothic\", \"Apple SD Gothic Neo\", \"AppleGothic\", sans-serif; }\n\n\t:host-context(.windows) { font-family: \"Segoe WPC\", \"Segoe UI\", sans-serif; }\n\t:host-context(.windows:lang(zh-Hans)) { font-family: \"Segoe WPC\", \"Segoe UI\", \"Microsoft YaHei\", sans-serif; }\n\t:host-context(.windows:lang(zh-Hant)) { font-family: \"Segoe WPC\", \"Segoe UI\", \"Microsoft Jhenghei\", sans-serif; }\n\t:host-context(.windows:lang(ja)) { font-family: \"Segoe WPC\", \"Segoe UI\", \"Yu Gothic UI\", \"Meiryo UI\", sans-serif; }\n\t:host-context(.windows:lang(ko)) { font-family: \"Segoe WPC\", \"Segoe UI\", \"Malgun Gothic\", \"Dotom\", sans-serif; }\n\n\t:host-context(.linux) { font-family: system-ui, \"Ubuntu\", \"Droid Sans\", sans-serif; }\n\t:host-context(.linux:lang(zh-Hans)) { font-family: system-ui, \"Ubuntu\", \"Droid Sans\", \"Source Han Sans SC\", \"Source Han Sans CN\", \"Source Han Sans\", sans-serif; }\n\t:host-context(.linux:lang(zh-Hant)) { font-family: system-ui, \"Ubuntu\", \"Droid Sans\", \"Source Han Sans TC\", \"Source Han Sans TW\", \"Source Han Sans\", sans-serif; }\n\t:host-context(.linux:lang(ja)) { font-family: system-ui, \"Ubuntu\", \"Droid Sans\", \"Source Han Sans J\", \"Source Han Sans JP\", \"Source Han Sans\", sans-serif; }\n\t:host-context(.linux:lang(ko)) { font-family: system-ui, \"Ubuntu\", \"Droid Sans\", \"Source Han Sans K\", \"Source Han Sans JR\", \"Source Han Sans\", \"UnDotum\", \"FBaekmuk Gulim\", sans-serif; }\n`;\r\n"]},"metadata":{},"sourceType":"module"}