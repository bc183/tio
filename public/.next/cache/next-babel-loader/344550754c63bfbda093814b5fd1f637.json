{"ast":null,"code":"import _regeneratorRuntime from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/bar007/Desktop/projects/tio/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport Head from 'next/head';\nimport { useRouter } from 'next/router';\nimport React, { createRef, Fragment, useEffect, useState } from 'react';\nimport useSWR from 'swr';\nimport PostCard from '../../components/PostCard';\nimport SideBar from '../../components/SideBar';\nimport Image from 'next/image';\nimport { useAuthState } from '../../context/auth';\nimport classNames from 'classnames';\nimport Axios from 'axios';\nimport Link from 'next/link';\nexport default function SubPage() {\n  var _useState = useState(null),\n      ownSub = _useState[0],\n      setOwnSub = _useState[1];\n\n  var router = useRouter();\n\n  var _useAuthState = useAuthState(),\n      authenticated = _useAuthState.authenticated,\n      user = _useAuthState.user;\n\n  var fileInputRef = /*#__PURE__*/createRef();\n  var subName = router.query.sub;\n\n  var _useSWR = useSWR(subName ? \"/subs/\".concat(subName) : null),\n      sub = _useSWR.data,\n      error = _useSWR.error,\n      revalidate = _useSWR.revalidate; //console.log(sub);\n\n\n  useEffect(function () {\n    if (!sub) {\n      return;\n    }\n\n    setOwnSub(authenticated && user.username === sub.username);\n  }, [sub]);\n\n  var openFileInput = function openFileInput(type) {\n    if (!ownSub) {\n      return;\n    }\n\n    fileInputRef.current.name = type;\n    fileInputRef.current.click();\n  };\n\n  var uploadImage = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      var file, formData;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              file = event.target.files[0];\n              formData = new FormData();\n              formData.append('file', file);\n              formData.append('type', fileInputRef.current.name);\n              _context.prev = 4;\n              _context.next = 7;\n              return Axios.post(\"/subs/\".concat(sub.name, \"/image\"), formData, {\n                headers: {\n                  'Content-Type': 'multipart/form-data'\n                }\n              });\n\n            case 7:\n              revalidate();\n              _context.next = 13;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](4);\n              console.log(_context.t0);\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[4, 10]]);\n    }));\n\n    return function uploadImage(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  if (error) router.push('/');\n  var postsMarkup;\n\n  if (!sub) {\n    postsMarkup = /*#__PURE__*/_jsx(\"p\", {\n      className: \"text-lg text-center\",\n      children: \"Loading..\"\n    });\n  } else if (sub.posts.length === 0) {\n    postsMarkup = /*#__PURE__*/_jsx(\"p\", {\n      className: \"text-lg text-center\",\n      children: \"No posts submitted yet\"\n    });\n  } else {\n    postsMarkup = sub.posts.map(function (post) {\n      return /*#__PURE__*/_jsx(PostCard, {\n        post: post,\n        revalidate: revalidate\n      }, post.identifier);\n    });\n  }\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsx(Head, {\n      children: /*#__PURE__*/_jsx(\"title\", {\n        children: sub === null || sub === void 0 ? void 0 : sub.title\n      })\n    }), sub && /*#__PURE__*/_jsxs(Fragment, {\n      children: [/*#__PURE__*/_jsx(\"input\", {\n        type: \"file\",\n        hidden: true,\n        ref: fileInputRef,\n        onChange: uploadImage\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: classNames(\"bg-blue-500\", {\n            'cursor-pointer': ownSub\n          }),\n          onClick: function onClick() {\n            return openFileInput('banner');\n          },\n          children: sub.bannerUrl ? /*#__PURE__*/_jsx(\"div\", {\n            className: \"h-56 bg-blue-500\",\n            style: {\n              backgroundImage: \"url(\".concat(sub.bannerUrl, \")\"),\n              backgroundRepeat: 'no-repeat',\n              backgroundSize: 'cover',\n              backgroundPosition: 'center'\n            }\n          }) : /*#__PURE__*/_jsx(\"div\", {\n            className: \"h-20 bg-blue-500\"\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"h-20 bg-white\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"container relative flex\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"absolute\",\n              style: {\n                top: -15\n              },\n              children: /*#__PURE__*/_jsx(Image, {\n                src: sub.imageUrl,\n                alt: \"sub image\",\n                className: classNames(\"rounded-full\", {\n                  'cursor-pointer': ownSub\n                }),\n                width: 70,\n                height: 70,\n                onClick: function onClick() {\n                  return openFileInput('image');\n                }\n              })\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"pt-1 pl-24\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"flex items-center\",\n                children: /*#__PURE__*/_jsx(\"h1\", {\n                  className: \"mb-1 text-3xl font-bold\",\n                  children: sub.title\n                })\n              }), /*#__PURE__*/_jsxs(\"p\", {\n                className: \"text-sm font-bold text-gray-500\",\n                children: [\"/r/\", sub.name, \" . \", sub.subOfCommunity ? \"Sub community of \".concat(sub.subOfCommunity) : '']\n              })]\n            })]\n          })\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"container flex pt-5\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"w-160\",\n          children: postsMarkup\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex flex-col\",\n          children: [/*#__PURE__*/_jsx(SideBar, {\n            sub: sub\n          }), sub.subOfCommunity === null && /*#__PURE__*/_jsx(\"div\", {\n            className: \"w-40 m-6 md:w-80\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"bg-white rounded\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"p-3 bg-blue-500 rounded-t\",\n                children: /*#__PURE__*/_jsx(\"p\", {\n                  className: \"font-semibold text-white\",\n                  children: \"Sub Communities\"\n                })\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"p-3\",\n                children: [sub.subCommunities.length === 0 ? 'No sub Communities' : sub.subCommunities.map(function (subCommunity) {\n                  return (\n                    /*#__PURE__*/\n                    //console.log(subCommunity)\n                    _jsx(Link, {\n                      href: \"/r/\".concat(subCommunity.name),\n                      children: /*#__PURE__*/_jsx(\"p\", {\n                        className: \"mb-3 text-md hover:bg-gray-300 hover:cursor-pointer\",\n                        children: subCommunity.name\n                      })\n                    }, subCommunity.name)\n                  );\n                }), authenticated && ownSub && /*#__PURE__*/_jsx(Link, {\n                  href: \"/r/\".concat(sub.name, \"/subCommunity\"),\n                  children: /*#__PURE__*/_jsx(\"a\", {\n                    className: \"w-full py-1 text-sm blue button\",\n                    children: \"Create Sub community\"\n                  })\n                })]\n              })]\n            })\n          })]\n        })]\n      })]\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}