{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/bar007/Desktop/projects/tio/client/pages/r/[sub].tsx\";\nimport Head from 'next/head';\nimport { useRouter } from 'next/router';\nimport { createRef, Fragment, useEffect, useState } from 'react';\nimport useSWR from 'swr';\nimport PostCard from '../../components/PostCard';\nimport SideBar from '../../components/SideBar';\nimport Image from 'next/image';\nimport { useAuthState } from '../../context/auth';\nimport classNames from 'classnames';\nimport Axios from 'axios';\nexport default function SubPage() {\n  const {\n    0: ownSub,\n    1: setOwnSub\n  } = useState(null);\n  const router = useRouter();\n  const {\n    authenticated,\n    user\n  } = useAuthState();\n  const fileInputRef = /*#__PURE__*/createRef();\n  const subName = router.query.sub;\n  const {\n    data: sub,\n    error,\n    revalidate\n  } = useSWR(subName ? `/subs/${subName}` : null);\n  useEffect(() => {\n    if (!sub) {\n      return;\n    }\n\n    setOwnSub(authenticated && user.username === sub.username);\n  }, [sub]);\n\n  const openFileInput = type => {\n    if (!ownSub) {\n      return;\n    }\n\n    fileInputRef.current.name = type;\n    fileInputRef.current.click();\n  };\n\n  const uploadImage = async event => {\n    const file = event.target.files[0];\n    const formData = new FormData();\n    formData.append('file', file);\n    formData.append('type', fileInputRef.current.name);\n\n    try {\n      await Axios.post(`/subs/${sub.name}/image`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n      revalidate();\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  if (error) router.push('/');\n  let postsMarkup;\n\n  if (!sub) {\n    postsMarkup = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-lg text-center\",\n      children: \"Loading..\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 19\n    }, this);\n  } else if (sub.posts.length === 0) {\n    postsMarkup = /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-lg text-center\",\n      children: \"No posts submitted yet\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 19\n    }, this);\n  } else {\n    postsMarkup = sub.posts.map(post => /*#__PURE__*/_jsxDEV(PostCard, {\n      post: post,\n      revalidate: revalidate\n    }, post.identifier, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 7\n    }, this));\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Head, {\n      children: /*#__PURE__*/_jsxDEV(\"title\", {\n        children: sub === null || sub === void 0 ? void 0 : sub.title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 7\n    }, this), sub && /*#__PURE__*/_jsxDEV(Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        hidden: true,\n        ref: fileInputRef,\n        onChange: uploadImage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: classNames(\"bg-blue-500\", {\n            'cursor-pointer': ownSub\n          }),\n          onClick: () => openFileInput('banner'),\n          children: sub.bannerUrl ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"h-56 bg-blue-500\",\n            style: {\n              backgroundImage: `url(${sub.bannerUrl})`,\n              backgroundRepeat: 'no-repeat',\n              backgroundSize: 'cover',\n              backgroundPosition: 'center'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"h-20 bg-blue-500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"h-20 bg-white\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"container relative flex\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"absolute\",\n              style: {\n                top: -15\n              },\n              children: /*#__PURE__*/_jsxDEV(Image, {\n                src: sub.imageUrl,\n                alt: \"sub image\",\n                className: classNames(\"rounded-full\", {\n                  'cursor-pointer': ownSub\n                }),\n                width: 70,\n                height: 70,\n                onClick: () => openFileInput('image')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 101,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 100,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pt-1 pl-24\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center\",\n                children: /*#__PURE__*/_jsxDEV(\"h1\", {\n                  className: \"mb-1 text-3xl font-bold\",\n                  children: sub.title\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 115,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 114,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-sm font-bold text-gray-500\",\n                children: [\"/r/\", sub.name]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 119,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 113,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"container flex pt-5\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-160\",\n          children: postsMarkup\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(SideBar, {\n          sub: sub\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 18\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 73,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["/home/bar007/Desktop/projects/tio/client/pages/r/[sub].tsx"],"names":["Head","useRouter","createRef","Fragment","useEffect","useState","useSWR","PostCard","SideBar","Image","useAuthState","classNames","Axios","SubPage","ownSub","setOwnSub","router","authenticated","user","fileInputRef","subName","query","sub","data","error","revalidate","username","openFileInput","type","current","name","click","uploadImage","event","file","target","files","formData","FormData","append","post","headers","console","log","push","postsMarkup","posts","length","map","identifier","title","bannerUrl","backgroundImage","backgroundRepeat","backgroundSize","backgroundPosition","top","imageUrl"],"mappings":"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","sourcesContent":["import Head from 'next/head'\nimport { useRouter } from 'next/router'\nimport { ChangeEvent, createRef, Fragment, useEffect, useState } from 'react'\nimport useSWR from 'swr'\nimport PostCard from '../../components/PostCard'\nimport SideBar from '../../components/SideBar';\nimport { Sub } from '../../types';\nimport Image from 'next/image';\nimport { useAuthState } from '../../context/auth'\nimport classNames from 'classnames';\nimport Axios from 'axios'\n\nexport default function SubPage() {\n  const [ownSub, setOwnSub] = useState(null);\n  const router = useRouter();\n  const { authenticated, user } = useAuthState();\n\n  const fileInputRef = createRef<HTMLInputElement>();\n\n  const subName = router.query.sub;\n\n  const { data: sub, error, revalidate } = useSWR<Sub>(subName ? `/subs/${subName}` : null)\n\n  useEffect(() => {\n    if(!sub) {\n      return;\n    }\n    setOwnSub(authenticated && user.username === sub.username)\n  }, [sub]);\n\n  const openFileInput = (type: string) => {\n    if(!ownSub) {\n      return;\n    }\n    fileInputRef.current.name = type;\n    fileInputRef.current.click();\n  }\n\n  const uploadImage = async (event: ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files[0];\n    const formData = new FormData();\n    formData.append('file', file);\n    formData.append('type', fileInputRef.current.name);\n\n    try {\n      await Axios.post<Sub>(`/subs/${sub.name}/image`, formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n          }\n      });\n      revalidate();\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  if (error) router.push('/')\n\n  let postsMarkup\n  if (!sub) {\n    postsMarkup = <p className=\"text-lg text-center\">Loading..</p>\n  } else if (sub.posts.length === 0) {\n    postsMarkup = <p className=\"text-lg text-center\">No posts submitted yet</p>\n  } else {\n    postsMarkup = sub.posts.map((post) => (\n      <PostCard key={post.identifier} post={post} revalidate={revalidate} />\n    ))\n  }\n\n\n\n  return (\n    <div>\n      <Head>  \n        <title>{sub?.title}</title>\n      </Head>\n        {sub && (<Fragment>\n          <input type=\"file\" hidden={true} ref={fileInputRef} onChange={uploadImage}/>\n          <div>\n            <div className={classNames(\"bg-blue-500\", {\n              'cursor-pointer': ownSub\n            })}\n            onClick={() => openFileInput('banner')}\n            >\n              {sub.bannerUrl? (\n                <div className=\"h-56 bg-blue-500\" style={{\n                  backgroundImage: `url(${sub.bannerUrl})`,\n                  backgroundRepeat: 'no-repeat',\n                  backgroundSize: 'cover',\n                  backgroundPosition: 'center'\n                }}>\n\n                </div>\n              ): (\n                <div className=\"h-20 bg-blue-500\"></div>\n              )}\n            </div>\n            <div className=\"h-20 bg-white\">\n              <div className=\"container relative flex\">\n                <div className=\"absolute\" style={{top:-15}}>\n                  <Image \n                    src={sub.imageUrl}\n                    alt=\"sub image\"\n                    className={classNames(\"rounded-full\", {\n                      'cursor-pointer': ownSub\n                    })}\n                    width={70}\n                    height={70}\n                    onClick={() => openFileInput('image')}\n                    >\n                  </Image>\n                </div>\n                <div className=\"pt-1 pl-24\">\n                  <div className=\"flex items-center\">\n                    <h1 className=\"mb-1 text-3xl font-bold\">\n                      {sub.title}\n                    </h1>\n                  </div>\n                  <p className=\"text-sm font-bold text-gray-500\">\n                    /r/{sub.name}\n                  </p>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div className=\"container flex pt-5\">\n            <div className=\"w-160\">{postsMarkup}</div>\n            <SideBar sub={sub} />\n          </div>\n        </Fragment>)}\n    </div>  \n  )\n}"]},"metadata":{},"sourceType":"module"}