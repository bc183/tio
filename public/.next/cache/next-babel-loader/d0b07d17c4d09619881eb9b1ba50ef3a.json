{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport Axios from \"axios\";\nimport Head from \"next/head\";\nimport { useRouter } from \"next/router\";\nimport { createRef, useState } from \"react\";\nimport useSWR from \"swr\";\nimport SideBar from \"../../../components/SideBar\";\nexport default function submit() {\n  const router = useRouter();\n  const fileInputRef = /*#__PURE__*/createRef();\n  const {\n    sub: subName\n  } = router.query;\n  const {\n    data: sub,\n    error\n  } = useSWR(subName ? `/subs/${subName}` : null);\n\n  if (error) {\n    router.push('/');\n  }\n\n  const {\n    0: title,\n    1: setTitle\n  } = useState(\"\");\n  const {\n    0: body,\n    1: setBody\n  } = useState(\"\");\n  const {\n    0: image,\n    1: setImage\n  } = useState(null);\n\n  const openFileInput = type => {\n    fileInputRef.current.name = type;\n    fileInputRef.current.click();\n  };\n\n  const changeImage = event => {\n    const file = event.target.files[0];\n    setImage(file);\n  };\n\n  const uploadImageAndSubmit = async event => {\n    event.preventDefault();\n    const formData = new FormData();\n    formData.append('file', image);\n    formData.append('title', title);\n    formData.append('body', body);\n    formData.append('sub', sub.name);\n\n    try {\n      const {\n        data: post\n      } = await Axios.post('/posts', formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n      router.push(`/r/${sub.name}/${post.identifier}/${post.slug}`);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"container flex pt-5\",\n    children: [/*#__PURE__*/_jsx(Head, {\n      children: /*#__PURE__*/_jsx(\"title\", {\n        children: \"Submit to TIO\"\n      })\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"w-160\",\n      children: [/*#__PURE__*/_jsx(\"input\", {\n        type: \"file\",\n        hidden: true,\n        ref: fileInputRef,\n        onChange: changeImage\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"p-4 bg-white rounded\",\n        children: [/*#__PURE__*/_jsxs(\"h1\", {\n          className: \"mb-3 text-lg\",\n          children: [\"Submit a post to /r/\", subName]\n        }), /*#__PURE__*/_jsxs(\"form\", {\n          onSubmit: uploadImageAndSubmit,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"relative mb-2\",\n            children: [/*#__PURE__*/_jsx(\"input\", {\n              type: \"text\",\n              className: \"w-full px-3 py-3 border border-gray-300 rounded focus:outline-none focus:border-gray-600\",\n              placeholder: \"Title\",\n              maxLength: 300,\n              value: title,\n              onChange: e => setTitle(e.target.value)\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"absolute mb-2 text-sm text-gray-500 select-none\",\n              style: {\n                top: 11,\n                right: 10\n              },\n              children: [title.trim().length, \" / 300\"]\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            children: [/*#__PURE__*/_jsx(\"span\", {\n              onClick: () => openFileInput('file'),\n              className: \"mb-2 fa fa-plus hover:bg-gray-200\"\n            }), /*#__PURE__*/_jsx(\"span\", {\n              className: \"m-2\",\n              children: \"Add Photo\"\n            })]\n          }), /*#__PURE__*/_jsx(\"img\", {\n            src: image || \"\"\n          }), /*#__PURE__*/_jsx(\"textarea\", {\n            className: \"w-full p-3 border border-gray-300 rounded focus:outline-none focus:border-gray-600\",\n            value: body,\n            placeholder: \"Text (optional)\",\n            rows: 4,\n            onChange: e => setBody(e.target.value)\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"flex justify-end\",\n            children: /*#__PURE__*/_jsx(\"button\", {\n              className: \"px-3 py-1 blue button\",\n              type: \"submit\",\n              disabled: title.trim().length === 0,\n              children: \"Submit\"\n            })\n          })]\n        })]\n      })]\n    }), sub && /*#__PURE__*/_jsx(SideBar, {\n      sub: sub\n    })]\n  });\n}\nexport const getServerSideProps = async ({\n  req,\n  res\n}) => {\n  try {\n    const cookie = req.headers.cookie;\n\n    if (!cookie) {\n      throw new Error('Missing cookie');\n    }\n\n    await Axios.get('/auth/me', {\n      headers: {\n        cookie\n      }\n    });\n    return {\n      props: {\n        message: 'Message'\n      }\n    };\n  } catch (error) {\n    res.writeHead(307, {\n      Location: '/login'\n    }).end();\n  }\n};","map":null,"metadata":{},"sourceType":"module"}